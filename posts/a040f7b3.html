<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png"><link rel="icon" type="image/png" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="John Doe"><meta name="keywords" content=""><title>Iptables 常用命令,选项,参数及实例整理收集 - Largesse&#39;s blog</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css"><link rel="stylesheet" href="/css/main.css"><script src="/js/utils.js"></script><meta name="generator" content="Hexo 4.2.1"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a></li></ul></div></div></nav><div class="view intro-2" id="background" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container text-center white-text fadeInUp"><span class="h2" id="subtitle"></span><div class="mt-3 post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-06-05 23:25">2020年6月5日 晚上</time></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.5k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 44 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><div class="post-content mx-auto" id="post"><article class="markdown-body"><h1 id="Iptables-常用命令-选项-参数及实例整理收集"><a href="#Iptables-常用命令-选项-参数及实例整理收集" class="headerlink" title="Iptables 常用命令,选项,参数及实例整理收集"></a>Iptables 常用命令,选项,参数及实例整理收集</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文整理收集了 iptables 的常用命令,参数,选项及实例以备不时之需.</p><p>iptables 是运行在使用者空间的应用软体,通过控制 Linux 内核 netfilter 模组,来管理网路封包的处理和转发.目前 iptables 已内置在各 Linux 发行版中.本文将收集整理其命令,选项,参数及实例以备不时之需.</p><p>本文转载于<a href="https://wangchujiang.com/linux-command/c/iptables.html" target="_blank" rel="noopener"> 原文 </a>,经测试,整理发布.如需转载请联系<strong>原作者</strong>获得授权,并注明转载地址.</p><hr><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="查询当前防火墙状态"><a href="#查询当前防火墙状态" class="headerlink" title="查询当前防火墙状态"></a>查询当前防火墙状态</h3><pre><code class="hljs shell">systemctl status iptables
<span class="hljs-meta">#</span><span class="bash"> 检查 iptables 是否安装</span>
systemctl status firewalld
<span class="hljs-meta">#</span><span class="bash"> 检查 firewall 是否安装</span></code></pre><h3 id="停止并禁用firewalld"><a href="#停止并禁用firewalld" class="headerlink" title="停止并禁用firewalld"></a>停止并禁用firewalld</h3><pre><code class="hljs shell">systemctl stop firewalld
<span class="hljs-meta">#</span><span class="bash"> 停止 firewalld 服务</span>
systemctl disable firewalld
<span class="hljs-meta">#</span><span class="bash"> 禁用 firewalld 服务</span></code></pre><h3 id="安装iptables"><a href="#安装iptables" class="headerlink" title="安装iptables"></a>安装iptables</h3><pre><code class="hljs shell">yum install -y iptables
<span class="hljs-meta">#</span><span class="bash"> 安装 iptables</span>
yum install -y iptables-services
<span class="hljs-meta">#</span><span class="bash"> 安装 iptables-services</span></code></pre><h3 id="启动命令"><a href="#启动命令" class="headerlink" title="启动命令"></a>启动命令</h3><pre><code class="hljs shell">systemctl start iptables
systemctl enable iptables
systemctl stop iptables
systemctl restart iptables
systemctl reload iptables</code></pre><h3 id="保存配置"><a href="#保存配置" class="headerlink" title="保存配置"></a>保存配置</h3><pre><code class="hljs shell">service iptables save
<span class="hljs-meta">#</span><span class="bash"> 手动修改</span>
vi /etc/sysconfig/iptables</code></pre><h2 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h2><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><pre><code class="hljs shell">iptables -t 表名 &lt;-A/I/D/R&gt; 规则链名 [规则号] &lt;-i/o 网卡名&gt; -p 协议名 &lt;-s 源IP/源子网&gt; --sport 源端口 &lt;-d 目标IP/目标子网&gt; --dport 目标端口 -j 动作</code></pre><h3 id="工作机制"><a href="#工作机制" class="headerlink" title="工作机制"></a>工作机制</h3><p>规则链名包括「也被称为五个钩子函数(hook functions)」：</p><ul><li><strong>INPUT链</strong> ：处理输入数据包。</li><li><strong>OUTPUT链</strong> ：处理输出数据包。</li><li><strong>FORWARD链</strong> ：处理转发数据包。</li><li><strong>PREROUTING链</strong> ：用于目标地址转换（DNAT）。</li><li><strong>POSTOUTING链</strong> ：用于源地址转换（SNAT）。</li></ul><h3 id="防火墙的策略"><a href="#防火墙的策略" class="headerlink" title="防火墙的策略"></a>防火墙的策略</h3><p>防火墙策略一般分为两种，一种叫通策略，一种叫堵策略，通策略，默认门是关着的，必须要定义谁能进。堵策略则是，大门是洞开的，但是你必须有身份认证，否则不能进。所以我们要定义，让进来的进来，让出去的出去，所以通，是要全通，而堵，则是要选择。当我们定义的策略的时候，要分别定义多条功能，其中：定义数据包中允许或者不允许的策略，filter过滤的功能，而定义地址转换的功能的则是nat选项。为了让这些功能交替工作，我们制定出了“表”这个定义，来定义、区分各种不同的工作功能和处理方式。</p><p><strong>我们现在用的比较多个功能有3个：</strong></p><ol><li>filter 定义允许或者不允许的，只能做在3个链上：INPUT ，FORWARD ，OUTPUT</li><li>nat 定义地址转换的，也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING</li><li>mangle功能:修改报文原数据，是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</li></ol><p>我们修改报文原数据就是来修改TTL的。能够实现将数据包的元数据拆开，在里面做标记/修改内容的。而防火墙标记，其实就是靠mangle来实现的。</p><p><strong>小扩展:</strong></p><ul><li>对于filter来讲一般只能做在3个链上：INPUT ，FORWARD ，OUTPUT</li><li>对于nat来讲一般也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING</li><li>而mangle则是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</li></ul><p>iptables/netfilter（这款软件）是工作在用户空间的，它可以让规则进行生效的，本身不是一种服务，而且规则是立即生效的。而我们iptables现在被做成了一个服务，可以进行启动，停止的。启动，则将规则直接生效，停止，则将规则撤销。</p><p>iptables还支持自己定义链。但是自己定义的链，必须是跟某种特定的链关联起来的。在一个关卡设定，指定当有数据的时候专门去找某个特定的链来处理，当那个链处理完之后，再返回。接着在特定的链中继续检查。</p><p><strong>注意：规则的次序非常关键，谁的规则越严格，应该放的越靠前，而检查规则的时候，是按照从上往下的方式进行检查的。</strong></p><p>表名包括：</p><ul><li><strong>raw</strong> ：高级功能，如：网址过滤。</li><li><strong>mangle</strong> ：数据包修改（QOS），用于实现服务质量。</li><li><strong>nat</strong> ：地址转换，用于网关路由器。</li><li><strong>filter</strong> ：包过滤，用于防火墙规则。</li></ul><p>动作包括：</p><ul><li><strong>ACCEPT</strong> ：接收数据包。</li><li><strong>DROP</strong> ：丢弃数据包。</li><li><strong>REDIRECT</strong> ：重定向、映射、透明代理。</li><li><strong>SNAT</strong> ：源地址转换。</li><li><strong>DNAT</strong> ：目标地址转换。</li><li><strong>MASQUERADE</strong> ：IP伪装（NAT），用于ADSL。</li><li><strong>LOG</strong> ：日志记录。</li></ul><h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><pre><code class="hljs shell">-t, --table table 对指定的表 table 进行操作， table 必须是 raw， nat，filter，mangle 中的一个。如果不指定此选项，默认的是 filter 表。
<span class="hljs-meta">#</span><span class="bash"> 通用匹配：源地址目标地址的匹配</span>
-p：指定要匹配的数据包协议类型；
-s, --source [!] address[/mask] ：把指定的一个／一组地址作为源地址，按此规则进行过滤。当后面没有 mask 时，address 是一个地址，比如：192.168.1.1；当 mask 指定时，可以表示一组范围内的地址，比如：192.168.1.0/255.255.255.0。
-d, --destination [!] address[/mask] ：地址格式同上，但这里是指定地址为目的地址，按此进行过滤。
-i, --in-interface [!] &lt;网络接口name&gt; ：指定数据包的来自来自网络接口，比如最常见的 eth0 。注意：它只对 INPUT，FORWARD，PREROUTING 这三个链起作用。如果没有指定此选项， 说明可以来自任何一个网络接口。同前面类似，"!" 表示取反。
-o, --out-interface [!] &lt;网络接口name&gt; ：指定数据包出去的网络接口。只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。
<span class="hljs-meta">#</span><span class="bash"> 查看管理命令</span>
-L, --list [chain] 列出链 chain 上面的所有规则，如果没有指定链，列出表上所有链的所有规则。
<span class="hljs-meta">#</span><span class="bash"> 规则管理命令</span>
-A, --append chain rule-specification 在指定链 chain 的末尾插入指定的规则，也就是说，这条规则会被放到最后，最后才会被执行。规则是由后面的匹配来指定。
-I, --insert chain [rulenum] rule-specification 在链 chain 中的指定位置插入一条或多条规则。如果指定的规则号是1，则在链的头部插入。这也是默认的情况，如果没有指定规则号。
-D, --delete chain rule-specification -D, --delete chain rulenum 在指定的链 chain 中删除一个或多个指定规则。
-R num：Replays替换/修改第几条规则
<span class="hljs-meta">#</span><span class="bash"> 链管理命令（这都是立即生效的）</span>
-P, --policy chain target ：为指定的链 chain 设置策略 target。注意，只有内置的链才允许有策略，用户自定义的是不允许的。
-F, --flush [chain] 清空指定链 chain 上面的所有规则。如果没有指定链，清空该表上所有链的所有规则。
-N, --new-chain chain 用指定的名字创建一个新的链。
-X, --delete-chain [chain] ：删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。如果没有指定链名，则会删除该表中所有非内置的链。
-E, --rename-chain old-chain new-chain ：用指定的新名字去重命名指定的链。这并不会对链内部造成任何影响。
-Z, --zero [chain] ：把指定链，或者表中的所有链上的所有计数器清零。
-j, --jump target &lt;指定目标&gt; ：即满足某条件时该执行什么样的动作。target 可以是内置的目标，比如 ACCEPT，也可以是用户自定义的链。
-h：显示帮助信息；</code></pre><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><div class="table-container"><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">-P</td><td style="text-align:left">设置默认策略:iptables -P INPUT (DROP)</td></tr><tr><td style="text-align:left">-F</td><td style="text-align:left">清空规则链</td></tr><tr><td style="text-align:left">-L</td><td style="text-align:left">查看规则链</td></tr><tr><td style="text-align:left">-A</td><td style="text-align:left">在规则链的末尾加入新规则</td></tr><tr><td style="text-align:left">-I</td><td style="text-align:left">num 在规则链的头部加入新规则</td></tr><tr><td style="text-align:left">-D</td><td style="text-align:left">num 删除某一条规则</td></tr><tr><td style="text-align:left">-s</td><td style="text-align:left">匹配来源地址IP/MASK，加叹号”!”表示除这个IP外。</td></tr><tr><td style="text-align:left">-d</td><td style="text-align:left">匹配目标地址</td></tr><tr><td style="text-align:left">-i</td><td style="text-align:left">网卡名称 匹配从这块网卡流入的数据</td></tr><tr><td style="text-align:left">-o</td><td style="text-align:left">网卡名称 匹配从这块网卡流出的数据</td></tr><tr><td style="text-align:left">-p</td><td style="text-align:left">匹配协议,如tcp,udp,icmp</td></tr><tr><td style="text-align:left">—dport num</td><td style="text-align:left">匹配目标端口号</td></tr><tr><td style="text-align:left">—sport num</td><td style="text-align:left">匹配来源端口号</td></tr></tbody></table></div><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><h3 id="空当前的所有规则和计数"><a href="#空当前的所有规则和计数" class="headerlink" title="空当前的所有规则和计数"></a>空当前的所有规则和计数</h3><pre><code class="hljs shell">iptables -F  # 清空所有的防火墙规则
iptables -X  # 删除用户自定义的空链
iptables -Z  # 清空计数</code></pre><h3 id="配置允许ssh端口连接"><a href="#配置允许ssh端口连接" class="headerlink" title="配置允许ssh端口连接"></a>配置允许ssh端口连接</h3><pre><code class="hljs shell">iptables -A INPUT -s 192.168.1.0/24 -p tcp --dport 22 -j ACCEPT
<span class="hljs-meta">#</span><span class="bash"> 22为你的ssh端口， -s 192.168.1.0/24表示允许这个网段的机器来连接，其它网段的ip地址是登陆不了你的机器的。 -j ACCEPT表示接受这样的请求</span></code></pre><h3 id="允许本地回环地址可以正常使用"><a href="#允许本地回环地址可以正常使用" class="headerlink" title="允许本地回环地址可以正常使用"></a>允许本地回环地址可以正常使用</h3><pre><code class="hljs shell">iptables -A INPUT -i lo -j ACCEPT
<span class="hljs-meta">#</span><span class="bash"> 本地圆环地址就是那个127.0.0.1，是本机上使用的,它进与出都设置为允许</span>
iptables -A OUTPUT -o lo -j ACCEPT</code></pre><h3 id="设置默认的规则"><a href="#设置默认的规则" class="headerlink" title="设置默认的规则"></a>设置默认的规则</h3><pre><code class="hljs shell">iptables -P INPUT DROP # 配置默认的不让进
iptables -P FORWARD DROP # 默认的不允许转发
iptables -P OUTPUT ACCEPT # 默认的可以出去</code></pre><h3 id="配置白名单"><a href="#配置白名单" class="headerlink" title="配置白名单"></a>配置白名单</h3><pre><code class="hljs shell">iptables -A INPUT -p all -s 192.168.1.0/24 -j ACCEPT  # 允许机房内网机器可以访问
iptables -A INPUT -p all -s 192.168.140.0/24 -j ACCEPT  # 允许机房内网机器可以访问
iptables -A INPUT -p tcp -s 183.121.3.7 --dport 3380 -j ACCEPT # 允许183.121.3.7访问本机的3380端口</code></pre><h3 id="开启相应的服务端口"><a href="#开启相应的服务端口" class="headerlink" title="开启相应的服务端口"></a>开启相应的服务端口</h3><pre><code class="hljs shell">iptables -A INPUT -p tcp --dport 80 -j ACCEPT # 开启80端口，因为web对外都是这个端口
iptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT # 允许被ping
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT # 已经建立的连接得让它进来</code></pre><h3 id="保存规则到配置文件中"><a href="#保存规则到配置文件中" class="headerlink" title="保存规则到配置文件中"></a>保存规则到配置文件中</h3><pre><code class="hljs shell">cp /etc/sysconfig/iptables /etc/sysconfig/iptables.bak # 任何改动之前先备份，请保持这一优秀的习惯
iptables-save &gt; /etc/sysconfig/iptables
cat /etc/sysconfig/iptables</code></pre><h3 id="列出已设置的规则"><a href="#列出已设置的规则" class="headerlink" title="列出已设置的规则"></a>列出已设置的规则</h3><pre><code class="hljs shell">iptables -L [-t 表名] [链名]</code></pre><ul><li>四个表名 raw，nat，filter，mangle</li><li>五个规则链名 INPUT、OUTPUT、FORWARD、PREROUTING、POSTROUTING</li><li>filter表包含INPUT、OUTPUT、FORWARD三个规则链</li></ul><pre><code class="hljs shell">iptables -L -t nat                  # 列出 nat 上面的所有规则
<span class="hljs-meta">#</span><span class="bash">            ^ -t 参数指定，必须是 raw， nat，filter，mangle 中的一个</span>
iptables -L -t nat  --line-numbers  # 规则带编号
iptables -L INPUT
iptables -L -nv  # 查看，这个列表看起来更详细</code></pre><h3 id="清除已有规则"><a href="#清除已有规则" class="headerlink" title="清除已有规则"></a>清除已有规则</h3><pre><code class="hljs shell">iptables -F INPUT  # 清空指定链 INPUT 上面的所有规则
iptables -X INPUT  # 删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。
                   # 如果没有指定链名，则会删除该表中所有非内置的链。
iptables -Z INPUT  # 把指定链，或者表中的所有链上的所有计数器清零。</code></pre><h3 id="删除已添加的规则"><a href="#删除已添加的规则" class="headerlink" title="删除已添加的规则"></a>删除已添加的规则</h3><pre><code class="hljs shell">iptables -A INPUT -s 192.168.1.5 -j DROP
<span class="hljs-meta">#</span><span class="bash"> 添加一条规则</span></code></pre><p>将所有iptables以序号标记显示，执行：</p><pre><code class="hljs shell">iptables -L -n --line-numbers</code></pre><p>比如要删除INPUT里序号为8的规则，执行：</p><pre><code class="hljs shell">iptables -D INPUT 8</code></pre><h3 id="开放指定的端口"><a href="#开放指定的端口" class="headerlink" title="开放指定的端口"></a>开放指定的端口</h3><pre><code class="hljs shell">iptables -A INPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT               #允许本地回环接口(即运行本机访问本机)
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT    #允许已建立的或相关连的通行
iptables -A OUTPUT -j ACCEPT      # 允许所有本机向外的访问
iptables -A INPUT -p tcp --dport 22 -j ACCEPT    # 允许访问22端口
iptables -A INPUT -p tcp --dport 80 -j ACCEPT    # 允许访问80端口
iptables -A INPUT -p tcp --dport 21 -j ACCEPT    # 允许ftp服务的21端口
iptables -A INPUT -p tcp --dport 20 -j ACCEPT    # 允许FTP服务的20端口
iptables -A INPUT -j reject       # 禁止其他未允许的规则访问
iptables -A FORWARD -j REJECT     # 禁止其他未允许的规则访问</code></pre><h3 id="屏蔽端口"><a href="#屏蔽端口" class="headerlink" title="屏蔽端口"></a>屏蔽端口</h3><pre><code class="hljs shell">iptables -A INPUT -p tcp --dport 12345 -j DROP
<span class="hljs-meta">#</span><span class="bash"> 屏蔽访问 12345 端口</span></code></pre><h3 id="屏蔽域名"><a href="#屏蔽域名" class="headerlink" title="屏蔽域名"></a>屏蔽域名</h3><pre><code class="hljs shell">iptables -A OUTPUT -m string --string "ysp8.cc" --algo bm --to 65535 -j DROP
<span class="hljs-meta">#</span><span class="bash"> 屏蔽服务器内域名访问</span></code></pre><h3 id="屏蔽IP"><a href="#屏蔽IP" class="headerlink" title="屏蔽IP"></a>屏蔽IP</h3><pre><code class="hljs shell">iptables -A INPUT -p tcp -m tcp -s 192.168.0.8 -j DROP  # 屏蔽恶意主机（比如，192.168.0.8
iptables -I INPUT -s 123.45.6.7 -j DROP       # 屏蔽单个IP的命令
iptables -I INPUT -s 123.0.0.0/8 -j DROP      # 封整个段即从123.0.0.1到123.255.255.254的命令
iptables -I INPUT -s 124.45.0.0/16 -j DROP    # 封IP段即从123.45.0.1到123.45.255.254的命令
iptables -I INPUT -s 123.45.6.0/24 -j DROP    # 封IP段即从123.45.6.1到123.45.6.254的命令是</code></pre><h3 id="指定数据包出去的网络接口"><a href="#指定数据包出去的网络接口" class="headerlink" title="指定数据包出去的网络接口"></a>指定数据包出去的网络接口</h3><p>只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。</p><pre><code class="hljs shell">iptables -A FORWARD -o eth0</code></pre><h3 id="查看已添加的规则"><a href="#查看已添加的规则" class="headerlink" title="查看已添加的规则"></a>查看已添加的规则</h3><pre><code class="hljs shell">iptables -L -n -v
Chain INPUT (policy DROP 48106 packets, 2690K bytes)
 pkts bytes target     prot opt in     out     source               destination
 5075  589K ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0
 191K   90M ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp dpt:22
1499K  133M ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp dpt:80
4364K 6351M ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED
 6256  327K ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 3382K packets, 1819M bytes)
 pkts bytes target     prot opt in     out     source               destination
 5075  589K ACCEPT     all  --  *      lo      0.0.0.0/0            0.0.0.0/0</code></pre><h3 id="启动网络转发规则"><a href="#启动网络转发规则" class="headerlink" title="启动网络转发规则"></a>启动网络转发规则</h3><p>公网210.14.67.7让内网192.168.188.0/24上网</p><pre><code class="hljs shell">iptables -t nat -A POSTROUTING -s 192.168.188.0/24 -j SNAT --to-source 210.14.67.127</code></pre><h3 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h3><p>本机的 2222 端口映射到内网 虚拟机的22 端口</p><pre><code class="hljs shell">iptables -t nat -A PREROUTING -d 210.14.67.127 -p tcp --dport 2222  -j DNAT --to-dest 192.168.188.115:22</code></pre><h3 id="字符串匹配"><a href="#字符串匹配" class="headerlink" title="字符串匹配"></a>字符串匹配</h3><p>比如，我们要过滤所有TCP连接中的字符串test，一旦出现它我们就终止这个连接，我们可以这么做：</p><pre><code class="hljs shell">iptables -A INPUT -p tcp -m string --algo kmp --string "test" -j REJECT --reject-with tcp-reset
iptables -L

<span class="hljs-meta">#</span><span class="bash"> Chain INPUT (policy ACCEPT)</span>
<span class="hljs-meta">#</span><span class="bash"> target     prot opt <span class="hljs-built_in">source</span>               destination</span>
<span class="hljs-meta">#</span><span class="bash"> REJECT     tcp  --  anywhere             anywhere            STRING match <span class="hljs-string">"test"</span> ALGO name kmp TO 65535 reject-with tcp-reset</span>
<span class="hljs-meta">#</span>
<span class="hljs-meta">#</span><span class="bash"> Chain FORWARD (policy ACCEPT)</span>
<span class="hljs-meta">#</span><span class="bash"> target     prot opt <span class="hljs-built_in">source</span>               destination</span>
<span class="hljs-meta">#</span>
<span class="hljs-meta">#</span><span class="bash"> Chain OUTPUT (policy ACCEPT)</span>
<span class="hljs-meta">#</span><span class="bash"> target     prot opt <span class="hljs-built_in">source</span>               destination</span></code></pre><h3 id="阻止Windows蠕虫的攻击"><a href="#阻止Windows蠕虫的攻击" class="headerlink" title="阻止Windows蠕虫的攻击"></a>阻止Windows蠕虫的攻击</h3><pre><code class="hljs shell">iptables -I INPUT -j DROP -p tcp -s 0.0.0.0/0 -m string --algo kmp --string "cmd.exe"</code></pre><h3 id="防止SYN洪水攻击"><a href="#防止SYN洪水攻击" class="headerlink" title="防止SYN洪水攻击"></a>防止SYN洪水攻击</h3><pre><code class="hljs shell">iptables -A INPUT -p tcp --syn -m limit --limit 5/second -j ACCEPT</code></pre><hr><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>本文主要为 iptables 常用命令信息整理以便使用.后期会根据使用经验增加实例参考</p></article><hr><div><div class="post-metas mb-3"></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext row"><div class="post-prev col-6"><a href="/posts/306655cb.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Hexo Fluid 主题教程</span> <span class="visible-mobile">上一篇</span></a></div><div class="post-next col-6"><a href="/posts/437a2cee.html"><span class="hidden-mobile">Telegram 的 CJK 字体设置</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></div></div></div></div></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div><div><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("06/06/2020 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站安全运行&nbsp"+dnum+"&nbsp天",document.getElementById("times").innerHTML=hnum+"&nbsp小时&nbsp"+mnum+"&nbsp分&nbsp"+snum+"&nbsp秒"}setInterval("createtime()",250)</script></div><p id="hitokoto">:D 获取中...</p><script>fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      const hitokoto = document.getElementById('hitokoto')
      hitokoto.innerText = data.hitokoto
      })
      .catch(console.error)</script></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"article.markdown-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:0,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Iptables 常用命令,选项,参数及实例整理收集&nbsp;"],cursorChar:"_",typeSpeed:70,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script></body></html>