<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Hexo Fluid主题 添加自定义字体</title>
    <link href="/posts/3c2a5351.html"/>
    <url>/posts/3c2a5351.html</url>
    
    <content type="html"><![CDATA[<h2 id="建立目录"><a href="#建立目录" class="headerlink" title="建立目录"></a>建立目录</h2><ul><li>目录在hexo根目录(非theme目录)找到 <strong>source/fonts</strong> 文件(没有就创建一个)</li><li>在<strong>\themes\fluid\source\css</strong>下新建<strong>custom.css</strong>文件</li><li>在fluid主题对应的<strong>_config.yml</strong>找到<strong>custom_css:</strong>，添加/css/custom.css</li></ul><h2 id="寻找字体"><a href="#寻找字体" class="headerlink" title="寻找字体"></a>寻找字体</h2><ul><li>到下载字体的网站<a href="https://google-webfonts-helper.herokuapp.com/" target="_blank" rel="noopener">google-webfonts-helper</a>,搜索思源宋体—Noto Serif SC</li></ul><p><img src="http://lymlair.com/2019/11/04/blogFont/downloadFont.png" srcset="/img/loading.gif" alt="1572872036230"></p><ul><li><p>这里要注意，第一项中默认的字符集是latin，由于我寻找的中文字符集，所以需要将选项修改为chinese-simplified，再将原latin去掉</p><p><a href="http://lymlair.com/2019/11/04/blogFont/selectLanguage.png" target="_blank" rel="noopener"><img src="http://lymlair.com/2019/11/04/blogFont/selectLanguage.png" srcset="/img/loading.gif" alt="1572872228423"></a></p><p>下载完之后将对应的woff文件放到相应的<strong>fonts</strong>文件夹中，再将网页自动生成的@font-face定义放到<strong>/css/custom.css</strong>中，就可以了。</p></li></ul><p><img src="https://raw.githubusercontent.com/anonymous12357/fitness/master/20200607232041.png" srcset="/img/loading.gif" alt="image-20200607232041125"></p><ul><li>到<strong>\themes\fluid\source\css_variables\base.styl</strong>添加”Noto Serif SC”，如下图后保存<br><img src="https://raw.githubusercontent.com/anonymous12357/fitness/master/20200607232414.png" srcset="/img/loading.gif" alt="image-20200607232414536"></li></ul><h2 id="查看效果"><a href="#查看效果" class="headerlink" title="查看效果"></a>查看效果</h2><p>最后执行以下命令部署，查看网页效果，如果无效要删除多余的font-family字段，应当至少添加一个通用的字体族名（如 serif，具体见<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-family" target="_blank" rel="noopener">链接文章</a>）。</p><div class="hljs"><pre><code class="hljs bash">hexo cleanhexo generatehexo deploy</code></pre></div><p>以后添加自定义字体都可以采用这种方法</p>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hexo Fluid 主题教程</title>
    <link href="/posts/306655cb.html"/>
    <url>/posts/306655cb.html</url>
    
    <content type="html"><![CDATA[<h2 id="1-安装Hexo"><a href="#1-安装Hexo" class="headerlink" title="1 安装Hexo"></a>1 安装Hexo</h2><h4 id="安装Node-js"><a href="#安装Node-js" class="headerlink" title="安装Node.js"></a>安装Node.js</h4><p>首先下载稳定版 <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a></p><p>安装选项全部默认，一路点击<code>Next</code>。最后安装好之后，按<code>Win+R</code>打开命令提示符，输入<code>node -v</code>和<code>npm -v</code>，如果出现版本号，那么就安装成功了。</p><h4 id="添加国内镜像源"><a href="#添加国内镜像源" class="headerlink" title="添加国内镜像源"></a>添加国内镜像源</h4><div class="hljs"><pre><code class="hljs bash">npm config <span class="hljs-built_in">set</span> registry https://registry.npm.taobao.org</code></pre></div><h4 id="安装Git"><a href="#安装Git" class="headerlink" title="安装Git"></a>安装Git</h4><p>为了把本地的网页文件上传到github上面去，我们需要用到分布式版本控制工具</p><p><a href="https://git-scm.com/download/win" target="_blank" rel="noopener">Git - Downloading Packagegit-scm.com</a></p><p>安装选项还是全部默认，只不过最后一步添加路径时选择<code>Use Git from the Windows Command Prompt</code>，这样我们就可以直接在命令提示符里打开git了。</p><p>安装完成后在命令提示符中输入<code>git --version</code>验证是否安装成功。</p><p>连接Github步骤参考网上教程</p><h2 id="2-搭建"><a href="#2-搭建" class="headerlink" title="2 搭建"></a>2 搭建</h2><h4 id="全局安装-hexo"><a href="#全局安装-hexo" class="headerlink" title="全局安装 hexo"></a>全局安装 hexo</h4><div class="hljs"><pre><code class="hljs bash"><span class="hljs-comment"># 如果 npm 安装缓慢可以使用淘宝镜像加速：npm config set registry https://registry.npm.taobao.org</span>npm install -g hexo</code></pre></div><p>安装以后命令行终端输入 <code>hexo -v</code>，如果显示 hexo 信息，则安装成功。</p><p>接下来初始化 hexo，在空文件夹（不能有任何文件，包括隐藏文件）执行命令 <code>hexo init</code>。成功后的目录结构：</p><div class="hljs"><pre><code class="hljs text">│  .gitignore│  package.json│  yarn.lock│  _config.yml├─node_modules├─scaffolds│     draft.md│     page.md│     post.md├─source│  └─_posts│       hello-world.md└─themes</code></pre></div><h4 id="安装-fluid-主题"><a href="#安装-fluid-主题" class="headerlink" title="安装 fluid 主题"></a>安装 fluid 主题</h4><p>下载<a href="https://github.com/fluid-dev/hexo-theme-fluid/releases" target="_blank" rel="noopener">最新版</a>并解压到 themes 目录下，重命名为 fluid，然后在博客 _config.yml 设置如下：</p><div class="hljs"><pre><code class="hljs yml"><span class="hljs-comment"># Extensions</span><span class="hljs-comment">## Plugins: https://hexo.io/plugins/</span><span class="hljs-comment">## Themes: https://hexo.io/themes/</span><span class="hljs-attr">theme:</span> <span class="hljs-string">fluid</span></code></pre></div><h2 id="3-配置"><a href="#3-配置" class="headerlink" title="3 配置"></a>3 配置</h2><p>推荐使用<a href="https://hexo.fluid-dev.com/docs/guide/#覆盖配置" target="_blank" rel="noopener">覆盖设置</a>功能，可以在主题目录之外自定义 config，不用担心更新主题时丢失配置。</p><p>在博客 source 目录中新建 <code>_data</code> 目录（不是主题的 source），再新建两个配置文件：</p><div class="hljs"><pre><code class="hljs text">fluid_config.yml    # 主题配置在这里修改fluid_static_prefix.yml # 静态资源配置在这里修改</code></pre></div><p>这样主题就会有两个配置文件：</p><ol><li>/source/_data/fluid_config.yml</li><li>/themes/fluid/_config.yml</li></ol><p>1 的优先级高于 2，即 1 中的配置会覆盖掉 2 中同名配置项。</p><h3 id="本地调试"><a href="#本地调试" class="headerlink" title="本地调试"></a>本地调试</h3><p>第一次运行应用先要安装依赖</p><div class="hljs"><pre><code class="hljs yml"><span class="hljs-comment"># 下面二选一</span><span class="hljs-string">npm</span> <span class="hljs-string">install</span><span class="hljs-string">yarn</span> <span class="hljs-string">install</span></code></pre></div><p>（演示将以 yarn 作为安装工具，可自行替换为 npm）启动服务，用于调试</p><div class="hljs"><pre><code class="hljs bash"><span class="hljs-comment"># 三选一</span>npm run serveryarn run serverhexo s <span class="hljs-comment"># hexo server 的简写</span></code></pre></div><h3 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h3><div class="hljs"><pre><code class="hljs bash">hexo clean &amp;&amp; hexo g</code></pre></div><h3 id="压缩（可选）"><a href="#压缩（可选）" class="headerlink" title="压缩（可选）"></a>压缩（可选）</h3><p>可以使用 <a href="https://github.com/chenzhutian/hexo-all-minifier" target="_blank" rel="noopener">hexo-all-minifier</a> 插件对生成的文件和图片进行压缩，大致步骤：</p><p>先安装插件：</p><div class="hljs"><pre><code class="hljs bash">npm i hexo-all-minifier --save<span class="hljs-comment"># Mac 系统还需要额外安装</span>brew install libtool automake autoconf nasm</code></pre></div><p>然后在博客配置中加入：</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">all_minifier:</span> <span class="hljs-literal">true</span></code></pre></div><p>这样即可快速使用。</p><p>具体的细节配置可参考<a href="https://github.com/chenzhutian/hexo-all-minifier" target="_blank" rel="noopener">官方文档</a></p><h3 id="使用-jsDelivr-服务（可选）"><a href="#使用-jsDelivr-服务（可选）" class="headerlink" title="使用 jsDelivr 服务（可选）"></a>使用 jsDelivr 服务（可选）</h3><p>插入来自 Github 仓库的图片，由于网络情况可能会出现加载慢和无法加载的情况，我们可以使用 <a href="https://www.jsdelivr.com/" target="_blank" rel="noopener">jsDelivr</a> 来加速图片文件等媒体文件的加载。</p><p>通常情况下，可以新建一个仓库来存放这些文件，目前已知的有图片、视频和引用的相关文件可以使用，Github 仓库最大上传文件为 25M，请注意文件大小。</p><p>使用方法（文件的绝对地址）</p><div class="hljs"><pre><code class="hljs text">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;user&#x2F;repo@version&#x2F;file</code></pre></div><p>相关实例（博客仓库下 master 分支里 favicon 图片文件）</p><div class="hljs"><pre><code class="hljs text">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;fluid-dev&#x2F;hexo-theme-fluid@master&#x2F;source&#x2F;img&#x2F;favicon.png</code></pre></div><h2 id="4-部署"><a href="#4-部署" class="headerlink" title="4 部署"></a>4 部署</h2><p>这里演示如何部署到 GitHub Pages 中。</p><p>在博客配置中设置部署仓库，参考如下：</p><div class="hljs"><pre><code class="hljs yml"><span class="hljs-comment"># Deployment</span><span class="hljs-comment">## Docs: https://hexo.io/docs/deployment.html</span><span class="hljs-attr">deploy:</span>  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">git</span>    <span class="hljs-attr">repo:</span> <span class="hljs-string">git@github.com:username/username.github.io.git</span>    <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span></code></pre></div><p>将你的 ssh 密钥上传到远程仓库，如果未设置则需要手工输入用户名和密码。然在终端命令行：</p><div class="hljs"><pre><code class="hljs bash">hexo d</code></pre></div><h2 id="5-更新主题"><a href="#5-更新主题" class="headerlink" title="5 更新主题"></a>5 更新主题</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>TIP</p><p>适用于没有自行修改任何代码的情况（配置文件除外）</p><ol><li>将自己的配置文件备份（如果完整使用<a href="https://hexo.fluid-dev.com/docs/guide/#覆盖配置" target="_blank" rel="noopener">覆盖配置</a>功能可忽略此步骤）</li><li>将 fluid 文件夹全部删除，重新下载 <a href="https://github.com/fluid-dev/hexo-theme-fluid/releases" target="_blank" rel="noopener">release</a> 并解压</li><li>如果某些配置发生了变化（改名或弃用），release 的说明里会特别提示，同步修改原配置文件即可。</li></ol><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>TIP</p><p>适用于自定义了一些代码，或想体验 master 分支的情况</p><ol><li>确定自己的 fluid 目录已经开启 git，并且所有改动都已 commit</li><li>把 fluid 仓库的 master 分支拉取到自己的分支上（可新建一个分支再拉取）</li></ol><div class="hljs"><pre><code class="hljs bash">git pull https://github.com/fluid-dev/hexo-theme-fluid.git master</code></pre></div><ol><li>解决代码冲突，保留自己修改的部分（如何解决冲突可自行搜索）</li></ol><h2 id="5-加快网页加载"><a href="#5-加快网页加载" class="headerlink" title="5 加快网页加载"></a>5 加快网页加载</h2><ul><li>对于所有用户，将各种第三方库配置公共 CDN 是最有效的方式，可以通过配置 <code>_static_prefix.yml</code> 来链接（默认已经使用 staticfile CDN，国内用户可不做改动）；</li><li>如果你的域名已备案，可以使用<a href="https://portal.qiniu.com/signup?code=1hlwhx3ztjz2q" target="_blank" rel="noopener">七牛云</a>、阿里云、腾讯云等大厂的 OSS 服务并绑定域名，将生成后的 public 目录下全部上传到 OSS，然后你不仅可以无服务器部署博客，加载速度也将无可比拟；</li><li>没有备案，也可以通过香港及海外地区的云，或者私有 CDN 等方式进行加速，推荐一份 <a href="https://www.julydate.com/post/60859300" target="_blank" rel="noopener">CDN 使用指南</a>。</li><li>如果图片是存在 source 目录中，建议搭配 <a href="https://github.com/chenzhutian/hexo-all-minifier" target="_blank" rel="noopener">hexo-all-minifier</a> 插件，可自动对图片进行压缩；</li><li>如果是存放在外部的图片，建议先使用 <a href="https://tinypng.com/" target="_blank" rel="noopener">tinypng</a> 进行压缩。</li></ul><h2 id="6-改造更多功能"><a href="#6-改造更多功能" class="headerlink" title="6 改造更多功能"></a>6 改造更多功能</h2><p>TIP</p><p>部分功能需要修改主题源代码，可能对今后更新造成困扰，请根据自己需求使用，并检查是否有冲突，建议提前做好备份</p><h3 id="网站运行时间统计"><a href="#网站运行时间统计" class="headerlink" title="网站运行时间统计"></a>网站运行时间统计</h3><p>本段代码来源于<a href="http://www.liangz.org/245.html" target="_blank" rel="noopener">网络</a>。在主题目录 <code>fluid/layout/_partial/footer.ejs</code> 文件中对应位置添加相关代码。</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"timeDate"</span>&gt;</span>载入天数...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"times"</span>&gt;</span>载入时分秒...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();</span><span class="actionscript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createtime</span><span class="hljs-params">()</span></span>&#123;</span><span class="javascript">      <span class="hljs-keyword">var</span> grt= <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">"02/14/2017 00:00:00"</span>);<span class="hljs-comment">//此处修改你的建站时间或者网站上线时间</span></span>      now.setTime(now.getTime()+250);      days = (now - grt ) / 1000 / 60 / 60 / 24;<span class="javascript">      dnum = <span class="hljs-built_in">Math</span>.floor(days);</span>      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);<span class="javascript">      hnum = <span class="hljs-built_in">Math</span>.floor(hours);</span><span class="javascript">      <span class="hljs-keyword">if</span>(<span class="hljs-built_in">String</span>(hnum).length ==<span class="hljs-number">1</span> )&#123;</span><span class="actionscript">          hnum = <span class="hljs-string">"0"</span> + hnum;</span>      &#125;      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);<span class="javascript">      mnum = <span class="hljs-built_in">Math</span>.floor(minutes);</span><span class="javascript">      <span class="hljs-keyword">if</span>(<span class="hljs-built_in">String</span>(mnum).length ==<span class="hljs-number">1</span> )&#123;</span><span class="actionscript">                mnum = <span class="hljs-string">"0"</span> + mnum;</span>      &#125;      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);<span class="javascript">      snum = <span class="hljs-built_in">Math</span>.round(seconds);</span><span class="javascript">      <span class="hljs-keyword">if</span>(<span class="hljs-built_in">String</span>(snum).length ==<span class="hljs-number">1</span> )&#123;</span><span class="actionscript">                snum = <span class="hljs-string">"0"</span> + snum;</span>      &#125;<span class="javascript">      <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"timeDate"</span>).innerHTML = <span class="hljs-string">"本站安全运行&amp;nbsp"</span>+dnum+<span class="hljs-string">"&amp;nbsp天"</span>;</span><span class="javascript">      <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"times"</span>).innerHTML = hnum + <span class="hljs-string">"&amp;nbsp小时&amp;nbsp"</span> + mnum + <span class="hljs-string">"&amp;nbsp分&amp;nbsp"</span> + snum + <span class="hljs-string">"&amp;nbsp秒"</span>;</span>  &#125;<span class="actionscript">  setInterval(<span class="hljs-string">"createtime()"</span>,<span class="hljs-number">250</span>);</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><h3 id="一言"><a href="#一言" class="headerlink" title="一言"></a>一言</h3><p>一言在博客网站中非常常见，正如它所说，用代码表达言语的魅力。在页面中，使用直接添加添加如下代码即可。在主题目录 <code>fluid/layout/_partial/footer.ejs</code> 文件中对应位置添加相关代码。以下代码为默认使用示例，如需要定制，请到 <a href="https://developer.hitokoto.cn/" target="_blank" rel="noopener">hitokoto developer</a> 中查看详情。</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hitokoto"</span>&gt;</span>:D 获取中...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript">  fetch(<span class="hljs-string">'https://v1.hitokoto.cn'</span>)</span><span class="javascript">    .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.json())</span><span class="javascript">    .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;</span><span class="javascript">      <span class="hljs-keyword">const</span> hitokoto = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'hitokoto'</span>)</span>      hitokoto.innerText = data.hitokoto      &#125;)<span class="javascript">      .catch(<span class="hljs-built_in">console</span>.error)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><h3 id="在新建页面添加评论"><a href="#在新建页面添加评论" class="headerlink" title="在新建页面添加评论"></a>在新建页面添加评论</h3><p>目前，主题配置文件只能在文章页面添加评论，如果需要在新建的页面添加评论插件，请在打开评论插件的情况下，在文章页面查看评论插件对应的 HTML 代码，并添加到页面的 Markdown 文件中。</p><h2 id="7-Front-matter概念"><a href="#7-Front-matter概念" class="headerlink" title="7 Front-matter概念"></a>7 Front-matter概念</h2><p><strong>来源于<a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/</a></strong></p><p>Front-matter 是文件最上方以 <code>---</code> 分隔的区域，用于指定个别文件的变量，举例来说：</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><span class="hljs-attr">title:</span> <span class="hljs-string">Hello</span> <span class="hljs-string">World</span><span class="hljs-attr">date:</span> <span class="hljs-number">2013</span><span class="hljs-string">/7/13</span> <span class="hljs-number">20</span><span class="hljs-string">:46:25</span><span class="hljs-meta">---</span></code></pre></div><p>以下是预先定义的参数，您可在模板中使用这些参数值并加以利用。</p><div class="table-container"><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th><th style="text-align:left">默认值</th></tr></thead><tbody><tr><td style="text-align:left"><code>layout</code></td><td style="text-align:left">布局</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>title</code></td><td style="text-align:left">标题</td><td style="text-align:left">文章的文件名</td></tr><tr><td style="text-align:left"><code>date</code></td><td style="text-align:left">建立日期</td><td style="text-align:left">文件建立日期</td></tr><tr><td style="text-align:left"><code>updated</code></td><td style="text-align:left">更新日期</td><td style="text-align:left">文件更新日期</td></tr><tr><td style="text-align:left"><code>comments</code></td><td style="text-align:left">开启文章的评论功能</td><td style="text-align:left">true</td></tr><tr><td style="text-align:left"><code>tags</code></td><td style="text-align:left">标签（不适用于分页）</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>categories</code></td><td style="text-align:left">分类（不适用于分页）</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>permalink</code></td><td style="text-align:left">覆盖文章网址</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>keywords</code></td><td style="text-align:left">仅用于 meta 标签和 Open Graph 的关键词（不推荐使用）</td></tr></tbody></table></div><h3 id="分类和标签"><a href="#分类和标签" class="headerlink" title="分类和标签"></a>分类和标签</h3><p>只有文章支持分类和标签，您可以在 Front-matter 中设置。在其他系统中，分类和标签听起来很接近，但是在 Hexo 中两者有着明显的差别：分类具有顺序性和层次性，也就是说 <code>Foo, Bar</code> 不等于 <code>Bar, Foo</code>；而标签没有顺序和层次。</p><div class="hljs"><pre><code class="hljs subunit">categories:- Diary<span class="hljs-keyword">tags:</span>- PS3- Games</code></pre></div><blockquote><p>分类方法的分歧</p><p>如果您有过使用 WordPress 的经验，就很容易误解 Hexo 的分类方式。WordPress 支持对一篇文章设置多个分类，而且这些分类可以是同级的，也可以是父子分类。但是 Hexo 不支持指定多个同级分类。下面的指定方法：</p><div class="hljs"><pre><code class="hljs markdown">categories:<span class="hljs-bullet">  - </span>Diary<span class="hljs-bullet">  - </span>Life</code></pre></div><p>会使分类<code>Life</code>成为<code>Diary</code>的子分类，而不是并列分类。因此，有必要为您的文章选择尽可能准确的分类。</p><p>如果你需要为文章添加多个分类，可以尝试以下 list 中的方法。</p><div class="hljs"><pre><code class="hljs asciidoc">categories:<span class="hljs-bullet">- </span>[Diary, PlayStation]<span class="hljs-bullet">- </span>[Diary, Games]<span class="hljs-bullet">- </span>[Life]</code></pre></div><p>此时这篇文章同时包括三个分类： <code>PlayStation</code> 和 <code>Games</code> 分别都是父分类 <code>Diary</code> 的子分类，同时 <code>Life</code> 是一个没有子分类的分类。</p></blockquote><h2 id="8-主题设置节选"><a href="#8-主题设置节选" class="headerlink" title="8 主题设置节选"></a>8 主题设置节选</h2><p><strong>来源：<a href="https://hexo.fluid-dev.com/docs/guide/" target="_blank" rel="noopener">https://hexo.fluid-dev.com/docs/guide/</a></strong></p><h3 id="文章页"><a href="#文章页" class="headerlink" title="文章页"></a>文章页</h3><h4 id="文章在首页的略缩图"><a href="#文章在首页的略缩图" class="headerlink" title="文章在首页的略缩图"></a>文章在首页的略缩图</h4><p>在文章开头 <a href="https://hexo.io/zh-cn/docs/front-matter" target="_blank" rel="noopener">Front-matter</a> 中配置 <code>index_img</code> 属性。</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><span class="hljs-attr">title:</span> <span class="hljs-string">文章标题</span><span class="hljs-attr">tags:</span> <span class="hljs-string">[Hexo,</span> <span class="hljs-string">Fluid]</span><span class="hljs-attr">index_img:</span> <span class="hljs-string">/img/example.jpg</span><span class="hljs-attr">date:</span> <span class="hljs-number">2019</span><span class="hljs-number">-10</span><span class="hljs-number">-10</span> <span class="hljs-number">10</span><span class="hljs-string">:00:00</span><span class="hljs-meta">---</span><span class="hljs-string">以下是文章内容</span></code></pre></div><p>和 Banner 配置相同，<code>/img/example.jpg</code> 对应的是存放在 <code>/source/img/example.jpg</code> 目录下的图片（目录也可自定义，但必须在 source 目录下）。</p><p>也可以使用外链 Url 的绝对路径。</p><h4 id="文章页顶部大图"><a href="#文章页顶部大图" class="headerlink" title="文章页顶部大图"></a>文章页顶部大图</h4><p>默认显示<strong>主题配置</strong>中的 <code>post.banner_img</code>，如需要设置单个文章的 Banner，在 <a href="https://hexo.io/zh-cn/docs/front-matter" target="_blank" rel="noopener">Front-matter</a> 中指定 banner_img 属性。</p><p>本地图片存放位置同上。</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><span class="hljs-attr">title:</span> <span class="hljs-string">文章标题</span><span class="hljs-attr">tags:</span> <span class="hljs-string">[Hexo,</span> <span class="hljs-string">Fluid]</span><span class="hljs-attr">index_img:</span> <span class="hljs-string">/img/example.jpg</span><span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/post_banner.jpg</span><span class="hljs-attr">date:</span> <span class="hljs-number">2019</span><span class="hljs-number">-10</span><span class="hljs-number">-10</span> <span class="hljs-number">10</span><span class="hljs-string">:00:00</span><span class="hljs-meta">---</span><span class="hljs-string">以下是文章内容</span></code></pre></div><h4 id="文章内容图片"><a href="#文章内容图片" class="headerlink" title="文章内容图片"></a>文章内容图片</h4><p>本地图片存放位置同上。</p><div class="hljs"><pre><code class="hljs markdown">![](/img/example.jpg)</code></pre></div>]]></content>
    
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Iptables 常用命令,选项,参数及实例整理收集</title>
    <link href="/posts/a040f7b3.html"/>
    <url>/posts/a040f7b3.html</url>
    
    <content type="html"><![CDATA[<h1 id="Iptables-常用命令-选项-参数及实例整理收集"><a href="#Iptables-常用命令-选项-参数及实例整理收集" class="headerlink" title="Iptables 常用命令,选项,参数及实例整理收集"></a>Iptables 常用命令,选项,参数及实例整理收集</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文整理收集了 iptables 的常用命令,参数,选项及实例以备不时之需.</p><p>iptables 是运行在使用者空间的应用软体,通过控制 Linux 内核 netfilter 模组,来管理网路封包的处理和转发.目前 iptables 已内置在各 Linux 发行版中.本文将收集整理其命令,选项,参数及实例以备不时之需.</p><p>本文转载于<a href="https://wangchujiang.com/linux-command/c/iptables.html" target="_blank" rel="noopener"> 原文 </a>,经测试,整理发布.如需转载请联系<strong>原作者</strong>获得授权,并注明转载地址.</p><hr><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="查询当前防火墙状态"><a href="#查询当前防火墙状态" class="headerlink" title="查询当前防火墙状态"></a>查询当前防火墙状态</h3><div class="hljs"><pre><code class="hljs shell">systemctl status iptables<span class="hljs-meta">#</span><span class="bash"> 检查 iptables 是否安装</span>systemctl status firewalld<span class="hljs-meta">#</span><span class="bash"> 检查 firewall 是否安装</span></code></pre></div><h3 id="停止并禁用firewalld"><a href="#停止并禁用firewalld" class="headerlink" title="停止并禁用firewalld"></a>停止并禁用firewalld</h3><div class="hljs"><pre><code class="hljs shell">systemctl stop firewalld<span class="hljs-meta">#</span><span class="bash"> 停止 firewalld 服务</span>systemctl disable firewalld<span class="hljs-meta">#</span><span class="bash"> 禁用 firewalld 服务</span></code></pre></div><h3 id="安装iptables"><a href="#安装iptables" class="headerlink" title="安装iptables"></a>安装iptables</h3><div class="hljs"><pre><code class="hljs shell">yum install -y iptables<span class="hljs-meta">#</span><span class="bash"> 安装 iptables</span>yum install -y iptables-services<span class="hljs-meta">#</span><span class="bash"> 安装 iptables-services</span></code></pre></div><h3 id="启动命令"><a href="#启动命令" class="headerlink" title="启动命令"></a>启动命令</h3><div class="hljs"><pre><code class="hljs shell">systemctl start iptablessystemctl enable iptablessystemctl stop iptablessystemctl restart iptablessystemctl reload iptables</code></pre></div><h3 id="保存配置"><a href="#保存配置" class="headerlink" title="保存配置"></a>保存配置</h3><div class="hljs"><pre><code class="hljs shell">service iptables save<span class="hljs-meta">#</span><span class="bash"> 手动修改</span>vi /etc/sysconfig/iptables</code></pre></div><h2 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h2><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><div class="hljs"><pre><code class="hljs shell">iptables -t 表名 &lt;-A/I/D/R&gt; 规则链名 [规则号] &lt;-i/o 网卡名&gt; -p 协议名 &lt;-s 源IP/源子网&gt; --sport 源端口 &lt;-d 目标IP/目标子网&gt; --dport 目标端口 -j 动作</code></pre></div><h3 id="工作机制"><a href="#工作机制" class="headerlink" title="工作机制"></a>工作机制</h3><p>规则链名包括「也被称为五个钩子函数(hook functions)」：</p><ul><li><strong>INPUT链</strong> ：处理输入数据包。</li><li><strong>OUTPUT链</strong> ：处理输出数据包。</li><li><strong>FORWARD链</strong> ：处理转发数据包。</li><li><strong>PREROUTING链</strong> ：用于目标地址转换（DNAT）。</li><li><strong>POSTOUTING链</strong> ：用于源地址转换（SNAT）。</li></ul><h3 id="防火墙的策略"><a href="#防火墙的策略" class="headerlink" title="防火墙的策略"></a>防火墙的策略</h3><p>防火墙策略一般分为两种，一种叫通策略，一种叫堵策略，通策略，默认门是关着的，必须要定义谁能进。堵策略则是，大门是洞开的，但是你必须有身份认证，否则不能进。所以我们要定义，让进来的进来，让出去的出去，所以通，是要全通，而堵，则是要选择。当我们定义的策略的时候，要分别定义多条功能，其中：定义数据包中允许或者不允许的策略，filter过滤的功能，而定义地址转换的功能的则是nat选项。为了让这些功能交替工作，我们制定出了“表”这个定义，来定义、区分各种不同的工作功能和处理方式。</p><p><strong>我们现在用的比较多个功能有3个：</strong></p><ol><li>filter 定义允许或者不允许的，只能做在3个链上：INPUT ，FORWARD ，OUTPUT</li><li>nat 定义地址转换的，也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING</li><li>mangle功能:修改报文原数据，是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</li></ol><p>我们修改报文原数据就是来修改TTL的。能够实现将数据包的元数据拆开，在里面做标记/修改内容的。而防火墙标记，其实就是靠mangle来实现的。</p><p><strong>小扩展:</strong></p><ul><li>对于filter来讲一般只能做在3个链上：INPUT ，FORWARD ，OUTPUT</li><li>对于nat来讲一般也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING</li><li>而mangle则是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</li></ul><p>iptables/netfilter（这款软件）是工作在用户空间的，它可以让规则进行生效的，本身不是一种服务，而且规则是立即生效的。而我们iptables现在被做成了一个服务，可以进行启动，停止的。启动，则将规则直接生效，停止，则将规则撤销。</p><p>iptables还支持自己定义链。但是自己定义的链，必须是跟某种特定的链关联起来的。在一个关卡设定，指定当有数据的时候专门去找某个特定的链来处理，当那个链处理完之后，再返回。接着在特定的链中继续检查。</p><p><strong>注意：规则的次序非常关键，谁的规则越严格，应该放的越靠前，而检查规则的时候，是按照从上往下的方式进行检查的。</strong></p><p>表名包括：</p><ul><li><strong>raw</strong> ：高级功能，如：网址过滤。</li><li><strong>mangle</strong> ：数据包修改（QOS），用于实现服务质量。</li><li><strong>nat</strong> ：地址转换，用于网关路由器。</li><li><strong>filter</strong> ：包过滤，用于防火墙规则。</li></ul><p>动作包括：</p><ul><li><strong>ACCEPT</strong> ：接收数据包。</li><li><strong>DROP</strong> ：丢弃数据包。</li><li><strong>REDIRECT</strong> ：重定向、映射、透明代理。</li><li><strong>SNAT</strong> ：源地址转换。</li><li><strong>DNAT</strong> ：目标地址转换。</li><li><strong>MASQUERADE</strong> ：IP伪装（NAT），用于ADSL。</li><li><strong>LOG</strong> ：日志记录。</li></ul><h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><div class="hljs"><pre><code class="hljs shell">-t, --table table 对指定的表 table 进行操作， table 必须是 raw， nat，filter，mangle 中的一个。如果不指定此选项，默认的是 filter 表。<span class="hljs-meta">#</span><span class="bash"> 通用匹配：源地址目标地址的匹配</span>-p：指定要匹配的数据包协议类型；-s, --source [!] address[/mask] ：把指定的一个／一组地址作为源地址，按此规则进行过滤。当后面没有 mask 时，address 是一个地址，比如：192.168.1.1；当 mask 指定时，可以表示一组范围内的地址，比如：192.168.1.0/255.255.255.0。-d, --destination [!] address[/mask] ：地址格式同上，但这里是指定地址为目的地址，按此进行过滤。-i, --in-interface [!] &lt;网络接口name&gt; ：指定数据包的来自来自网络接口，比如最常见的 eth0 。注意：它只对 INPUT，FORWARD，PREROUTING 这三个链起作用。如果没有指定此选项， 说明可以来自任何一个网络接口。同前面类似，"!" 表示取反。-o, --out-interface [!] &lt;网络接口name&gt; ：指定数据包出去的网络接口。只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。<span class="hljs-meta">#</span><span class="bash"> 查看管理命令</span>-L, --list [chain] 列出链 chain 上面的所有规则，如果没有指定链，列出表上所有链的所有规则。<span class="hljs-meta">#</span><span class="bash"> 规则管理命令</span>-A, --append chain rule-specification 在指定链 chain 的末尾插入指定的规则，也就是说，这条规则会被放到最后，最后才会被执行。规则是由后面的匹配来指定。-I, --insert chain [rulenum] rule-specification 在链 chain 中的指定位置插入一条或多条规则。如果指定的规则号是1，则在链的头部插入。这也是默认的情况，如果没有指定规则号。-D, --delete chain rule-specification -D, --delete chain rulenum 在指定的链 chain 中删除一个或多个指定规则。-R num：Replays替换/修改第几条规则<span class="hljs-meta">#</span><span class="bash"> 链管理命令（这都是立即生效的）</span>-P, --policy chain target ：为指定的链 chain 设置策略 target。注意，只有内置的链才允许有策略，用户自定义的是不允许的。-F, --flush [chain] 清空指定链 chain 上面的所有规则。如果没有指定链，清空该表上所有链的所有规则。-N, --new-chain chain 用指定的名字创建一个新的链。-X, --delete-chain [chain] ：删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。如果没有指定链名，则会删除该表中所有非内置的链。-E, --rename-chain old-chain new-chain ：用指定的新名字去重命名指定的链。这并不会对链内部造成任何影响。-Z, --zero [chain] ：把指定链，或者表中的所有链上的所有计数器清零。-j, --jump target &lt;指定目标&gt; ：即满足某条件时该执行什么样的动作。target 可以是内置的目标，比如 ACCEPT，也可以是用户自定义的链。-h：显示帮助信息；</code></pre></div><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><div class="table-container"><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">-P</td><td style="text-align:left">设置默认策略:iptables -P INPUT (DROP)</td></tr><tr><td style="text-align:left">-F</td><td style="text-align:left">清空规则链</td></tr><tr><td style="text-align:left">-L</td><td style="text-align:left">查看规则链</td></tr><tr><td style="text-align:left">-A</td><td style="text-align:left">在规则链的末尾加入新规则</td></tr><tr><td style="text-align:left">-I</td><td style="text-align:left">num 在规则链的头部加入新规则</td></tr><tr><td style="text-align:left">-D</td><td style="text-align:left">num 删除某一条规则</td></tr><tr><td style="text-align:left">-s</td><td style="text-align:left">匹配来源地址IP/MASK，加叹号”!”表示除这个IP外。</td></tr><tr><td style="text-align:left">-d</td><td style="text-align:left">匹配目标地址</td></tr><tr><td style="text-align:left">-i</td><td style="text-align:left">网卡名称 匹配从这块网卡流入的数据</td></tr><tr><td style="text-align:left">-o</td><td style="text-align:left">网卡名称 匹配从这块网卡流出的数据</td></tr><tr><td style="text-align:left">-p</td><td style="text-align:left">匹配协议,如tcp,udp,icmp</td></tr><tr><td style="text-align:left">—dport num</td><td style="text-align:left">匹配目标端口号</td></tr><tr><td style="text-align:left">—sport num</td><td style="text-align:left">匹配来源端口号</td></tr></tbody></table></div><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><h3 id="空当前的所有规则和计数"><a href="#空当前的所有规则和计数" class="headerlink" title="空当前的所有规则和计数"></a>空当前的所有规则和计数</h3><div class="hljs"><pre><code class="hljs shell">iptables -F  # 清空所有的防火墙规则iptables -X  # 删除用户自定义的空链iptables -Z  # 清空计数</code></pre></div><h3 id="配置允许ssh端口连接"><a href="#配置允许ssh端口连接" class="headerlink" title="配置允许ssh端口连接"></a>配置允许ssh端口连接</h3><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -s 192.168.1.0/24 -p tcp --dport 22 -j ACCEPT<span class="hljs-meta">#</span><span class="bash"> 22为你的ssh端口， -s 192.168.1.0/24表示允许这个网段的机器来连接，其它网段的ip地址是登陆不了你的机器的。 -j ACCEPT表示接受这样的请求</span></code></pre></div><h3 id="允许本地回环地址可以正常使用"><a href="#允许本地回环地址可以正常使用" class="headerlink" title="允许本地回环地址可以正常使用"></a>允许本地回环地址可以正常使用</h3><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -i lo -j ACCEPT<span class="hljs-meta">#</span><span class="bash"> 本地圆环地址就是那个127.0.0.1，是本机上使用的,它进与出都设置为允许</span>iptables -A OUTPUT -o lo -j ACCEPT</code></pre></div><h3 id="设置默认的规则"><a href="#设置默认的规则" class="headerlink" title="设置默认的规则"></a>设置默认的规则</h3><div class="hljs"><pre><code class="hljs shell">iptables -P INPUT DROP # 配置默认的不让进iptables -P FORWARD DROP # 默认的不允许转发iptables -P OUTPUT ACCEPT # 默认的可以出去</code></pre></div><h3 id="配置白名单"><a href="#配置白名单" class="headerlink" title="配置白名单"></a>配置白名单</h3><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -p all -s 192.168.1.0/24 -j ACCEPT  # 允许机房内网机器可以访问iptables -A INPUT -p all -s 192.168.140.0/24 -j ACCEPT  # 允许机房内网机器可以访问iptables -A INPUT -p tcp -s 183.121.3.7 --dport 3380 -j ACCEPT # 允许183.121.3.7访问本机的3380端口</code></pre></div><h3 id="开启相应的服务端口"><a href="#开启相应的服务端口" class="headerlink" title="开启相应的服务端口"></a>开启相应的服务端口</h3><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -p tcp --dport 80 -j ACCEPT # 开启80端口，因为web对外都是这个端口iptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT # 允许被pingiptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT # 已经建立的连接得让它进来</code></pre></div><h3 id="保存规则到配置文件中"><a href="#保存规则到配置文件中" class="headerlink" title="保存规则到配置文件中"></a>保存规则到配置文件中</h3><div class="hljs"><pre><code class="hljs shell">cp /etc/sysconfig/iptables /etc/sysconfig/iptables.bak # 任何改动之前先备份，请保持这一优秀的习惯iptables-save &gt; /etc/sysconfig/iptablescat /etc/sysconfig/iptables</code></pre></div><h3 id="列出已设置的规则"><a href="#列出已设置的规则" class="headerlink" title="列出已设置的规则"></a>列出已设置的规则</h3><div class="hljs"><pre><code class="hljs shell">iptables -L [-t 表名] [链名]</code></pre></div><ul><li>四个表名 raw，nat，filter，mangle</li><li>五个规则链名 INPUT、OUTPUT、FORWARD、PREROUTING、POSTROUTING</li><li>filter表包含INPUT、OUTPUT、FORWARD三个规则链</li></ul><div class="hljs"><pre><code class="hljs shell">iptables -L -t nat                  # 列出 nat 上面的所有规则<span class="hljs-meta">#</span><span class="bash">            ^ -t 参数指定，必须是 raw， nat，filter，mangle 中的一个</span>iptables -L -t nat  --line-numbers  # 规则带编号iptables -L INPUTiptables -L -nv  # 查看，这个列表看起来更详细</code></pre></div><h3 id="清除已有规则"><a href="#清除已有规则" class="headerlink" title="清除已有规则"></a>清除已有规则</h3><div class="hljs"><pre><code class="hljs shell">iptables -F INPUT  # 清空指定链 INPUT 上面的所有规则iptables -X INPUT  # 删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。                   # 如果没有指定链名，则会删除该表中所有非内置的链。iptables -Z INPUT  # 把指定链，或者表中的所有链上的所有计数器清零。</code></pre></div><h3 id="删除已添加的规则"><a href="#删除已添加的规则" class="headerlink" title="删除已添加的规则"></a>删除已添加的规则</h3><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -s 192.168.1.5 -j DROP<span class="hljs-meta">#</span><span class="bash"> 添加一条规则</span></code></pre></div><p>将所有iptables以序号标记显示，执行：</p><div class="hljs"><pre><code class="hljs shell">iptables -L -n --line-numbers</code></pre></div><p>比如要删除INPUT里序号为8的规则，执行：</p><div class="hljs"><pre><code class="hljs shell">iptables -D INPUT 8</code></pre></div><h3 id="开放指定的端口"><a href="#开放指定的端口" class="headerlink" title="开放指定的端口"></a>开放指定的端口</h3><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -s 127.0.0.1 -d 127.0.0.1 -j ACCEPT               #允许本地回环接口(即运行本机访问本机)iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT    #允许已建立的或相关连的通行iptables -A OUTPUT -j ACCEPT      # 允许所有本机向外的访问iptables -A INPUT -p tcp --dport 22 -j ACCEPT    # 允许访问22端口iptables -A INPUT -p tcp --dport 80 -j ACCEPT    # 允许访问80端口iptables -A INPUT -p tcp --dport 21 -j ACCEPT    # 允许ftp服务的21端口iptables -A INPUT -p tcp --dport 20 -j ACCEPT    # 允许FTP服务的20端口iptables -A INPUT -j reject       # 禁止其他未允许的规则访问iptables -A FORWARD -j REJECT     # 禁止其他未允许的规则访问</code></pre></div><h3 id="屏蔽端口"><a href="#屏蔽端口" class="headerlink" title="屏蔽端口"></a>屏蔽端口</h3><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -p tcp --dport 12345 -j DROP<span class="hljs-meta">#</span><span class="bash"> 屏蔽访问 12345 端口</span></code></pre></div><h3 id="屏蔽域名"><a href="#屏蔽域名" class="headerlink" title="屏蔽域名"></a>屏蔽域名</h3><div class="hljs"><pre><code class="hljs shell">iptables -A OUTPUT -m string --string "ysp8.cc" --algo bm --to 65535 -j DROP<span class="hljs-meta">#</span><span class="bash"> 屏蔽服务器内域名访问</span></code></pre></div><h3 id="屏蔽IP"><a href="#屏蔽IP" class="headerlink" title="屏蔽IP"></a>屏蔽IP</h3><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -p tcp -m tcp -s 192.168.0.8 -j DROP  # 屏蔽恶意主机（比如，192.168.0.8iptables -I INPUT -s 123.45.6.7 -j DROP       # 屏蔽单个IP的命令iptables -I INPUT -s 123.0.0.0/8 -j DROP      # 封整个段即从123.0.0.1到123.255.255.254的命令iptables -I INPUT -s 124.45.0.0/16 -j DROP    # 封IP段即从123.45.0.1到123.45.255.254的命令iptables -I INPUT -s 123.45.6.0/24 -j DROP    # 封IP段即从123.45.6.1到123.45.6.254的命令是</code></pre></div><h3 id="指定数据包出去的网络接口"><a href="#指定数据包出去的网络接口" class="headerlink" title="指定数据包出去的网络接口"></a>指定数据包出去的网络接口</h3><p>只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。</p><div class="hljs"><pre><code class="hljs shell">iptables -A FORWARD -o eth0</code></pre></div><h3 id="查看已添加的规则"><a href="#查看已添加的规则" class="headerlink" title="查看已添加的规则"></a>查看已添加的规则</h3><div class="hljs"><pre><code class="hljs shell">iptables -L -n -vChain INPUT (policy DROP 48106 packets, 2690K bytes) pkts bytes target     prot opt in     out     source               destination 5075  589K ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0 191K   90M ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp dpt:221499K  133M ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp dpt:804364K 6351M ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED 6256  327K ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0Chain FORWARD (policy ACCEPT 0 packets, 0 bytes) pkts bytes target     prot opt in     out     source               destinationChain OUTPUT (policy ACCEPT 3382K packets, 1819M bytes) pkts bytes target     prot opt in     out     source               destination 5075  589K ACCEPT     all  --  *      lo      0.0.0.0/0            0.0.0.0/0</code></pre></div><h3 id="启动网络转发规则"><a href="#启动网络转发规则" class="headerlink" title="启动网络转发规则"></a>启动网络转发规则</h3><p>公网210.14.67.7让内网192.168.188.0/24上网</p><div class="hljs"><pre><code class="hljs shell">iptables -t nat -A POSTROUTING -s 192.168.188.0/24 -j SNAT --to-source 210.14.67.127</code></pre></div><h3 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h3><p>本机的 2222 端口映射到内网 虚拟机的22 端口</p><div class="hljs"><pre><code class="hljs shell">iptables -t nat -A PREROUTING -d 210.14.67.127 -p tcp --dport 2222  -j DNAT --to-dest 192.168.188.115:22</code></pre></div><h3 id="字符串匹配"><a href="#字符串匹配" class="headerlink" title="字符串匹配"></a>字符串匹配</h3><p>比如，我们要过滤所有TCP连接中的字符串test，一旦出现它我们就终止这个连接，我们可以这么做：</p><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -p tcp -m string --algo kmp --string "test" -j REJECT --reject-with tcp-resetiptables -L<span class="hljs-meta">#</span><span class="bash"> Chain INPUT (policy ACCEPT)</span><span class="hljs-meta">#</span><span class="bash"> target     prot opt <span class="hljs-built_in">source</span>               destination</span><span class="hljs-meta">#</span><span class="bash"> REJECT     tcp  --  anywhere             anywhere            STRING match <span class="hljs-string">"test"</span> ALGO name kmp TO 65535 reject-with tcp-reset</span><span class="hljs-meta">#</span><span class="hljs-meta">#</span><span class="bash"> Chain FORWARD (policy ACCEPT)</span><span class="hljs-meta">#</span><span class="bash"> target     prot opt <span class="hljs-built_in">source</span>               destination</span><span class="hljs-meta">#</span><span class="hljs-meta">#</span><span class="bash"> Chain OUTPUT (policy ACCEPT)</span><span class="hljs-meta">#</span><span class="bash"> target     prot opt <span class="hljs-built_in">source</span>               destination</span></code></pre></div><h3 id="阻止Windows蠕虫的攻击"><a href="#阻止Windows蠕虫的攻击" class="headerlink" title="阻止Windows蠕虫的攻击"></a>阻止Windows蠕虫的攻击</h3><div class="hljs"><pre><code class="hljs shell">iptables -I INPUT -j DROP -p tcp -s 0.0.0.0/0 -m string --algo kmp --string "cmd.exe"</code></pre></div><h3 id="防止SYN洪水攻击"><a href="#防止SYN洪水攻击" class="headerlink" title="防止SYN洪水攻击"></a>防止SYN洪水攻击</h3><div class="hljs"><pre><code class="hljs shell">iptables -A INPUT -p tcp --syn -m limit --limit 5/second -j ACCEPT</code></pre></div><hr><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>本文主要为 iptables 常用命令信息整理以便使用.后期会根据使用经验增加实例参考</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Telegram 的 CJK 字体设置</title>
    <link href="/posts/437a2cee.html"/>
    <url>/posts/437a2cee.html</url>
    
    <content type="html"><![CDATA[<h2 id="FontMod-是什么？"><a href="#FontMod-是什么？" class="headerlink" title="FontMod 是什么？"></a>FontMod 是什么？</h2><p><a href="https://github.com/ysc3839/FontMod" target="_blank" rel="noopener">ysc3839/FontMod</a> 是由 <a href="https://blog.ysc3839.com/" target="_blank" rel="noopener">@ysc3839</a> 开发的一个小玩意，可以注入一些 Win32 程序（主要是 Telegram）用以替换掉默认的字体 fallback。通过把原本的 <code>SimSun</code> 替换为微软雅黑，Telegram 的观感一下子提升了不少，对于使用界面缩放的用户也有用。</p><p>在这个 Telegram 版本更新以前，喜欢折腾和讨厌难看宋体的用户就是用它来改善 Telegram 的中文观感。FontMod 默认配置使用起来也很简单，下载后放入 Telegram Desktop 目录，把 dll 改名为 <code>winmm.dll</code> 就可以了。</p><p>此时，字体规则和刚才所述一致，宋体被替换为微软雅黑等。也就是说，如果你更新到了 Telegram Desktop 2.6.1 版本，且你对于现在的字体感到满意，你可以拿走 FontMod 也不影响字体显示了。</p><h2 id="用什么字体呢？"><a href="#用什么字体呢？" class="headerlink" title="用什么字体呢？"></a>用什么字体呢？</h2><p>微软雅黑在代码编辑器 / shell 里用都很合适，也是我测试比较了之后个人认为用在 Telegram 上效果也很好的一款字体。</p><h2 id="具体配置"><a href="#具体配置" class="headerlink" title="具体配置"></a>具体配置</h2><p>这是我的 <code>FontMod.yaml</code> 配置。</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-comment"># tg 2.1.6</span><span class="hljs-comment"># FontMod 2.0.0.0</span><span class="hljs-comment"># 多 style 配置，增加灵活性</span><span class="hljs-comment"># 聊天、设置(未加粗)、对话的最后一条消息、任务栏未读消息计数</span><span class="hljs-attr">style1:</span> <span class="hljs-meta">&amp;style1</span>  <span class="hljs-attr">size:</span> <span class="hljs-number">20</span>  <span class="hljs-comment"># weight: 400</span><span class="hljs-comment"># 输入时格式化成斜体</span><span class="hljs-attr">style2:</span> <span class="hljs-meta">&amp;style2</span>  <span class="hljs-attr">size:</span> <span class="hljs-number">20</span>  <span class="hljs-comment"># weight: 400</span><span class="hljs-comment"># UI 中加粗显示的字体、如：列表中好友、群、频道名称；文件夹分类启用后的字体等</span><span class="hljs-attr">style3:</span> <span class="hljs-meta">&amp;style3</span>  <span class="hljs-attr">size:</span> <span class="hljs-number">19</span>  <span class="hljs-comment"># weight: 600</span><span class="hljs-attr">fonts:</span><span class="hljs-comment"># style1</span><span class="hljs-comment"># 聊天、设置、最后一条消息、任务栏未读消息</span>  <span class="hljs-attr">DAOpenSansRegular:</span> <span class="hljs-string">&amp;zh-cn-font</span> <span class="hljs-comment"># Chinese (Simplified) fallback font</span>    <span class="hljs-comment"># replace: PingFangSC-Regular</span>    <span class="hljs-attr">replace:</span> <span class="hljs-string">Microsoft</span> <span class="hljs-string">YaHei</span>    <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*style1</span><span class="hljs-comment"># style2</span><span class="hljs-comment"># 输入时格式化成斜体</span>  <span class="hljs-attr">DAOpenSansRegularItalic:</span> <span class="hljs-string">&amp;zh-cn-font</span> <span class="hljs-comment"># Chinese (Simplified) fallback font</span>    <span class="hljs-comment"># replace: PingFangSC-Regular</span>    <span class="hljs-attr">replace:</span> <span class="hljs-string">Microsoft</span> <span class="hljs-string">YaHei</span>    <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*style2</span><span class="hljs-comment"># style3</span><span class="hljs-comment">#  UI 中加粗显示的字体、如：列表中好友、群、频道名称；文件夹分类启用后的字体等</span>  <span class="hljs-attr">DAOpenSansSemibold:</span> <span class="hljs-string">&amp;zh-cn-font</span> <span class="hljs-comment"># Chinese (Simplified) fallback font</span>    <span class="hljs-comment"># replace: PingFangSC-Regular</span>    <span class="hljs-attr">replace:</span> <span class="hljs-string">Microsoft</span> <span class="hljs-string">YaHei</span>    <span class="hljs-string">&lt;&lt;:</span> <span class="hljs-meta">*style3</span><span class="hljs-comment"># 不知道是 UI 哪些部位的字体</span>  <span class="hljs-comment"># DAVazirRegular: &amp;zh-cn-font # Chinese (Simplified) fallback font</span>  <span class="hljs-comment">#   replace: Sarasa Mono SC</span>  <span class="hljs-comment">#   # replace: Source Han Sans CN</span>  <span class="hljs-comment">#   &lt;&lt;: *style</span><span class="hljs-comment"># 不知道是 UI 哪些部位的字体</span>  <span class="hljs-comment"># DAVazirMedium: &amp;zh-cn-font # Chinese (Simplified) fallback font</span>  <span class="hljs-comment">#   replace: STCaiyun</span>  <span class="hljs-comment">#   # replace: Source Han Sans CN</span>  <span class="hljs-comment">#   &lt;&lt;: *style</span><span class="hljs-comment"># 不知道是 UI 哪些部位的字体</span>  <span class="hljs-comment"># DAOpenSansSemiboldItalic: &amp;zh-cn-font # Chinese (Simplified) fallback font</span>  <span class="hljs-comment">#   replace: Sarasa Mono SC</span>  <span class="hljs-comment">#   # replace: Source Han Sans CN</span>  <span class="hljs-comment">#   &lt;&lt;: *style</span><span class="hljs-attr">fixGSOFont:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># true is to use system UI font</span><span class="hljs-comment">#fixGSOFont: *zh-cn-font # Or replace with user defined font</span><span class="hljs-attr">debug:</span> <span class="hljs-literal">false</span></code></pre></div><h3 id="微软雅黑"><a href="#微软雅黑" class="headerlink" title="微软雅黑"></a>微软雅黑</h3><p>如果不考虑等距字体的问题，微软雅黑本身也是支持粗体的。那么，我也可以通过修改 FontMod 来提供中文的粗体支持。只是，我测试了一下，微软雅黑的粗体表现在 Telegram 的字号下简直惨不忍睹：</p><p><a href="https://ikevin.in/images/008/100-MSYHB.png" target="_blank" rel="noopener"><img src="https://ikevin.in/images/008/100-MSYHB.png" srcset="/img/loading.gif" alt="100% 缩放，微软雅黑粗体"></a></p><p>100% 缩放，微软雅黑粗体</p><p>这已经可以说是粗得不成样子了，糊到一片很难看。</p><p>另外，图上还有一个严重的问题：<strong>微软雅黑没有韩文的覆盖</strong>（至少我的参测版本 Windows 1909 字体 v6.25 没有），韩文实际上 fallback 到了另外一个字体，显示效果炸裂。</p><h3 id="思源黑体"><a href="#思源黑体" class="headerlink" title="思源黑体"></a>思源黑体</h3><p>那么，同样是 CJK 字体且名声在外的思源黑体呢？思源黑体同样有等宽家族，可以全部解决问题。但是我的测试结论是：如果你有界面缩放，那么还可以用；如果没有，即 100%，那还是算了吧。看图：</p><p><a href="https://ikevin.in/images/008/100-SHSM.png" target="_blank" rel="noopener"><img src="https://ikevin.in/images/008/100-SHSM.png" srcset="/img/loading.gif" alt="100% 缩放，思源黑体 Medium"></a></p><p>100% 缩放，思源黑体 Medium</p><p>可以看到 100% 缩放时字体很「虚」，笔画已经模糊不清，严重影响了观感。</p><p>这样一对比，高下自判。</p><p>但是，说到底，建议买块更好的屏幕（4K + 200% 缩放真香！）。</p>]]></content>
    
    
    <categories>
      
      <category>Telegram</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Telegram</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>五线谱 唱名 记录</title>
    <link href="/posts/cc3cc25b.html"/>
    <url>/posts/cc3cc25b.html</url>
    
    <content type="html"><![CDATA[<div class="table-container"><table><thead><tr><th>音名</th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th></tr></thead><tbody><tr><td>唱名</td><td>La 6</td><td>Si 7</td><td>Do 1</td><td>Re 2</td><td>Mi 3</td><td>Fa 4</td><td>So 5</td></tr></tbody></table></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>快速删除 Google Drive 所有文件</title>
    <link href="/posts/5b5c96e4.html"/>
    <url>/posts/5b5c96e4.html</url>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>Google drive根目录下存在大量文件（数万同类型文件），手动删除极其耗时，同时连接Google drive需要科学上网，一旦断线就需要重新刷新。所以，介绍一种采用google colab读取Google drive内容，并管理文件的方法。</p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>打开 <a href="https://colab.research.google.com/notebooks/" target="_blank" rel="noopener">https://colab.research.google.com/notebooks/</a> google colab直连google谷歌各个服务，所以无须担心速度稳定性。</p><ul><li><p>登录google账号（与Google Drive一致），新建文档</p></li><li><p>输入Python代码如下，并执行等待（来源和修改自<a href="https://colab.research.google.com/notebooks/io.ipynb#scrollTo=7taylj9wpsA2）：" target="_blank" rel="noopener">https://colab.research.google.com/notebooks/io.ipynb#scrollTo=7taylj9wpsA2）：</a></p><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment"># Import PyDrive and associated libraries.</span><span class="hljs-comment"># This only needs to be done once per notebook.</span><span class="hljs-keyword">from</span> pydrive.auth <span class="hljs-keyword">import</span> GoogleAuth<span class="hljs-keyword">from</span> pydrive.drive <span class="hljs-keyword">import</span> GoogleDrive<span class="hljs-keyword">from</span> google.colab <span class="hljs-keyword">import</span> auth<span class="hljs-keyword">from</span> oauth2client.client <span class="hljs-keyword">import</span> GoogleCredentials<span class="hljs-comment"># Authenticate and create the PyDrive client.</span><span class="hljs-comment"># This only needs to be done once per notebook.</span>auth.authenticate_user()gauth = GoogleAuth()gauth.credentials = GoogleCredentials.get_application_default()drive = GoogleDrive(gauth)<span class="hljs-comment"># List .txt files in the root.</span><span class="hljs-comment">#</span><span class="hljs-comment"># Search query reference:</span><span class="hljs-comment"># https://developers.google.com/drive/v2/web/search-parameters</span>listed = drive.ListFile(&#123;<span class="hljs-string">'q'</span>: <span class="hljs-string">"title contains '.txt' and 'root' in parents"</span>&#125;).GetList()<span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> listed:  file.Delete()</code></pre></div><p>上面代码中’.txt’可以修改为其他类型或者其他搜索条件，具体参考官方举例<br><a href="https://colab.research.google.com/notebooks/snippets/drive.ipynb" target="_blank" rel="noopener">https://colab.research.google.com/notebooks/snippets/drive.ipynb</a></p></li><li><p>检查Google drive文件是否被删除，pydrive好像无法长期运行，大概30mins</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Google Drive</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>零基础入门CV - Task5 模型集成</title>
    <link href="/posts/1e52eb39.html"/>
    <url>/posts/1e52eb39.html</url>
    
    <content type="html"><![CDATA[<h3 id="1-1-学习目标"><a href="#1-1-学习目标" class="headerlink" title="1.1 学习目标"></a>1.1 学习目标</h3><ul><li>学习集成学习方法以及交叉验证情况下的模型集成</li><li>学会使用深度学习模型的集成学习</li></ul><h3 id="2-2-集成学习方法"><a href="#2-2-集成学习方法" class="headerlink" title="2.2 集成学习方法"></a>2.2 集成学习方法</h3><p>在机器学习中的集成学习可以在一定程度上提高预测精度，常见的集成学习方法有Stacking、Bagging和Boosting，同时这些集成学习方法与具体验证集划分联系紧密。</p><p>由于深度学习模型一般需要较长的训练周期，如果硬件设备不允许建议选取留出法，如果需要追求精度可以使用交叉验证的方法。</p><p>下面假设构建了10折交叉验证，训练得到10个CNN模型。<br><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task05/交叉验证.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task05/%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81.png" srcset="/img/loading.gif" alt="IMG"></a></p><p>那么在10个CNN模型可以使用如下方式进行集成：</p><ul><li>对预测的结果的概率值进行平均，然后解码为具体字符；</li><li>对预测的字符进行投票，得到最终字符。</li></ul><h3 id="2-3-深度学习中的集成学习"><a href="#2-3-深度学习中的集成学习" class="headerlink" title="2.3 深度学习中的集成学习"></a>2.3 深度学习中的集成学习</h3><p>此外在深度学习中本身还有一些集成学习思路的做法，值得借鉴学习：</p><h4><a href="#" class="headerlink"></a></h4><h4 id="2-3-1-Dropout"><a href="#2-3-1-Dropout" class="headerlink" title="2.3.1 Dropout"></a>2.3.1 Dropout</h4><p>Dropout可以作为训练深度神经网络的一种技巧。在每个训练批次中，通过随机让一部分的节点停止工作。同时在预测的过程中让所有的节点都其作用。<br><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task05/Droopout.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task05/Droopout.png" srcset="/img/loading.gif" alt="IMG"></a></p><p>Dropout经常出现在在先有的CNN网络中，可以有效的缓解模型过拟合的情况，也可以在预测时增加模型的精度。</p><p>加入Dropout后的网络结构如下：</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-comment"># 定义模型</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SVHN_Model1</span><span class="hljs-params">(nn.Module)</span>:</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>        super(SVHN_Model1, self).__init__()        <span class="hljs-comment"># CNN提取特征模块</span>        self.cnn = nn.Sequential(            nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">16</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), stride=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),            nn.ReLU(),            nn.Dropout(<span class="hljs-number">0.25</span>),            nn.MaxPool2d(<span class="hljs-number">2</span>),            nn.Conv2d(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>, kernel_size=(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), stride=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),            nn.ReLU(),             nn.Dropout(<span class="hljs-number">0.25</span>),            nn.MaxPool2d(<span class="hljs-number">2</span>),        )        <span class="hljs-comment"># </span>        self.fc1 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc2 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc3 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc4 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc5 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        self.fc6 = nn.Linear(<span class="hljs-number">32</span>*<span class="hljs-number">3</span>*<span class="hljs-number">7</span>, <span class="hljs-number">11</span>)        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(self, img)</span>:</span>                feat = self.cnn(img)        feat = feat.view(feat.shape[<span class="hljs-number">0</span>], <span class="hljs-number">-1</span>)        c1 = self.fc1(feat)        c2 = self.fc2(feat)        c3 = self.fc3(feat)        c4 = self.fc4(feat)        c5 = self.fc5(feat)        c6 = self.fc6(feat)        <span class="hljs-keyword">return</span> c1, c2, c3, c4, c5, c6</code></pre></div><h4 id="2-3-2-TTA"><a href="#2-3-2-TTA" class="headerlink" title="2.3.2 TTA"></a>2.3.2 TTA</h4><p>测试集数据扩增（Test Time Augmentation，简称TTA）也是常用的集成学习技巧，数据扩增不仅可以在训练时候用，而且可以同样在预测时候进行数据扩增，对同一个样本预测三次，然后对三次结果进行平均。</p><script src="https://gist.github.com/anonymous12357/7d4743cebd30381bc9b8f3cae92afd3b.js"></script>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>零基础入门CV - Task4 模型训练与验证</title>
    <link href="/posts/8a2bae63.html"/>
    <url>/posts/8a2bae63.html</url>
    
    <content type="html"><![CDATA[<p>一个成熟合格的深度学习训练流程至少具备以下功能：</p><ul><li>在训练集上进行训练，并在验证集上进行验证；</li><li>模型可以保存最优的权重，并读取权重；</li><li>记录下训练集和验证集的精度，便于调参。</li></ul><h3 id="4-1-学习目标"><a href="#4-1-学习目标" class="headerlink" title="4.1 学习目标"></a>4.1 学习目标</h3><ul><li>理解验证集的作用，并使用训练集和验证集完成训练</li><li>学会使用Pytorch环境下的模型读取和加载，并了解调参流程</li></ul><p>模型过拟合的情况有很多种原因，其中最为常见的情况是模型复杂度（Model Complexity ）太高，导致模型学习到了训练数据的方方面面，学习到了一些细枝末节的规律。</p><p>解决上述问题最好的解决方法：构建一个与测试集尽可能分布一致的样本集（可称为验证集），在训练过程中不断验证模型在验证集上的精度，并以此控制模型的训练。</p><ul><li>训练集（Train Set）：模型用于训练和调整模型参数；</li><li>验证集（Validation Set）：用来验证模型精度和调整模型超参数；</li><li>测试集（Test Set）：验证模型的泛化能力。</li></ul><p><strong>那么如何划分本地验证集？</strong></p><p><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task04/%E9%AA%8C%E8%AF%81%E9%9B%86%E6%9E%84%E9%80%A0.png" srcset="/img/loading.gif" alt="IMG"></p><ul><li>留出法（Hold-Out）</li></ul><p>直接将训练集划分成两部分，新的训练集和验证集。这种划分方式的优点是最为直接简单；缺点是只得到了一份验证集，有可能导致模型在验证集上过拟合。留出法应用场景是数据量比较大的情况。</p><ul><li>交叉验证法（Cross Validation，CV）</li></ul><p>将训练集划分成K份，将其中的K-1份作为训练集，剩余的1份作为验证集，循环K训练。这种划分方式是所有的训练集都是验证集，最终模型验证精度是K份平均得到。这种方式的优点是验证集精度比较可靠，训练K次可以得到K个有多样性差异的模型；CV验证的缺点是需要训练K次，不适合数据量很大的情况。</p><ul><li>自助采样法（BootStrap）</li></ul><p>通过有放回的采样方式得到新的训练集和验证集，每次的训练集和验证集都是有区别的。这种划分方式一般适用于数据量较小的情况。</p><p>在本次赛题中已经划分为验证集，因此选手可以直接使用训练集进行训练，并使用验证集进行验证精度（当然你也可以合并训练集和验证集，自行划分验证集）。</p><h3 id="4-2-模型训练与验证"><a href="#4-2-模型训练与验证" class="headerlink" title="4.2 模型训练与验证"></a>4.2 模型训练与验证</h3><p>在本节我们目标使用Pytorch来完成CNN的训练和验证过程，CNN网络结构与之前的章节中保持一致。我们需要完成的逻辑结构如下：</p><ul><li>构造训练集和验证集；</li><li>每轮进行训练和验证，并根据最优验证集精度保存模型。</li></ul><p><strong>注意</strong>：Google colab 最好将文件放到/home/目录下，否认直接读取google driver文件速度很慢，取决于网络I/O</p><script src="https://gist.github.com/anonymous12357/d2e2b00bc87d8d8bcd30db4fe30f8eec.js"></script><p><strong>模型调参流程</strong></p><p>深度学习原理少但实践性非常强，基本上很多的模型的验证只能通过训练来完成。同时深度学习有众多的网络结构和超参数，因此需要反复尝试。训练深度学习模型需要GPU的硬件支持，也需要较多的训练时间，如何有效的训练深度学习模型逐渐成为了一门学问。</p><p>深度学习有众多的训练技巧，比较推荐的阅读链接有：</p><div class="hljs"><pre><code>http://lamda.nju.edu.cn/weixs/project/CNNTricks/CNNTricks.htmlhttp://karpathy.github.io/2019/04/25/recipe/</code></pre></div><p>本节挑选了常见的一些技巧来讲解，并针对本次赛题进行具体分析。与传统的机器学习模型不同，深度学习模型的精度与模型的复杂度、数据量、正则化、数据扩增等因素直接相关。所以当深度学习模型处于不同的阶段（欠拟合、过拟合和完美拟合）的情况下，大家可以知道可以什么角度来继续优化模型。</p><p>在参加本次比赛的过程中，我建议大家以如下逻辑完成：</p><div class="hljs"><pre><code>1.初步构建简单的CNN模型，不用特别复杂，跑通训练、验证和预测的流程；2.简单CNN模型的损失会比较大，尝试增加模型复杂度，并观察验证集精度；3.在增加模型复杂度的同时增加数据扩增方法，直至验证集精度不变。</code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>零基础入门CV - Task3 字符识别模型</title>
    <link href="/posts/4b02d627.html"/>
    <url>/posts/4b02d627.html</url>
    
    <content type="html"><![CDATA[<h3 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h3><ul><li>学习CNN基础和原理</li><li>使用Pytorch框架构建CNN模型，并完成训练</li></ul><h3 id="1-字符识别模型"><a href="#1-字符识别模型" class="headerlink" title="1 字符识别模型"></a>1 字符识别模型</h3><p>CNN是一种层次模型，输入的是原始的像素数据。CNN通过卷积（convolution）、池化（pooling）、非线性激活函数（non-linear activation function）和全连接层（fully connected layer）构成。</p><p><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task03/%E5%8D%B7%E7%A7%AF.png" srcset="/img/loading.gif" alt="IMG"></p><p>通过多次卷积和池化，CNN的最后一层将输入的图像像素映射为具体的输出。如在分类任务中会转换为不同类别的概率输出，然后计算真实标签与CNN模型的预测结果的差异，并通过反向传播更新每层的参数，并在更新完成后再次前向传播，如此反复直到训练完成 。与传统机器学习模型相比，CNN具有一种端到端（End to End）的思路。在CNN训练的过程中是直接从图像像素到最终的输出，并不涉及到具体的特征提取和构建模型的过程，也不需要人工的参与。</p><h3 id="2-Pytorch构建CNN模型"><a href="#2-Pytorch构建CNN模型" class="headerlink" title="2 Pytorch构建CNN模型"></a>2 Pytorch构建CNN模型</h3><p>构建一个非常简单的CNN，然后进行训练。这个CNN模型包括两个卷积层，最后并联6个全连接层进行分类。</p><iframe src="https://nbviewer.jupyter.org/github/anonymous12357/crawler-8th/blob/master/task3.ipynb" width="800" height="2000"></iframe>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>零基础入门CV - Task2 数据读取与数据扩增</title>
    <link href="/posts/f7421d0b.html"/>
    <url>/posts/f7421d0b.html</url>
    
    <content type="html"><![CDATA[<h3 id="1-解题思路"><a href="#1-解题思路" class="headerlink" title="1 解题思路"></a>1 解题思路</h3><p>读取数据、构建模型、预训练模型、验证模型：</p><p><img src="https://raw.githubusercontent.com/anonymous12357/fitness/master/20200523214221.png" srcset="/img/loading.gif" alt="image-20200523214221527"></p><p>定长字符知识点：<br><img src="https://raw.githubusercontent.com/anonymous12357/fitness/master/20200523214237.png" srcset="/img/loading.gif" alt=""></p><h2 id="2-数据读取与数据扩增"><a href="#2-数据读取与数据扩增" class="headerlink" title="2 数据读取与数据扩增"></a>2 数据读取与数据扩增</h2><p>主要内容为数据读取、数据扩增方法和Pytorch读取赛题数据三个部分组成</p><h4 id="2-1-图像读取"><a href="#2-1-图像读取" class="headerlink" title="2.1 图像读取"></a>2.1 图像读取</h4><h5 id="2-2-1-Pillow"><a href="#2-2-1-Pillow" class="headerlink" title="2.2.1 Pillow"></a>2.2.1 Pillow</h5><p>Pillow是Python图像处理函式库(PIL）的一个分支。Pillow提供了常见的图像读取和处理的操作，而且可以与ipython notebook无缝集成，是应用比较广泛的库。</p><p>例子：</p><p><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task02/Pillow%E8%AF%BB%E5%8F%96%E5%8E%9F%E5%9B%BE.png" srcset="/img/loading.gif" alt="IMG"></p><div class="hljs"><pre><code class="hljs bash">conda activate pytorch_gpujupyter-notebook<span class="hljs-comment">#启动环境，打开jupyter</span></code></pre></div><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image, ImageFilterim =Image.open(<span class="hljs-string">'./cat.png'</span>)im2 = im.filter(ImageFilter.BLUR)im2.save(<span class="hljs-string">'blur.jpg'</span>, <span class="hljs-string">'jpeg'</span>)               w, h = im.size <span class="hljs-comment"># 获得图像尺寸</span>im.thumbnail((w//<span class="hljs-number">2</span>, h//<span class="hljs-number">2</span>))im.save(<span class="hljs-string">'thumbnail.jpg'</span>, <span class="hljs-string">'jpeg'</span>)</code></pre></div><h5 id="2-2-2-OpenCV"><a href="#2-2-2-OpenCV" class="headerlink" title="2.2.2 OpenCV"></a>2.2.2 OpenCV</h5><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<span class="hljs-comment"># 导入Opencv库</span>img = cv2.imread(<span class="hljs-string">'./cat.png'</span>)<span class="hljs-comment"># Opencv默认颜色通道顺序是BRG，转换一下</span>img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)cv2.imshow(<span class="hljs-string">"Image"</span>, img)cv2.waitKey()cv2.destroyAllWindows()img2 = cv2.imread(<span class="hljs-string">'./cat.png'</span>)img2 = cv2.cvtColor(img2, cv2.COLOR_BGR2GRAY)cv2.imshow(<span class="hljs-string">"Image"</span>, img2)cv2.waitKey()cv2.destroyAllWindows()img3 = cv2.imread(<span class="hljs-string">'./cat.png'</span>)img3 =cv2.cvtColor(img3, cv2.COLOR_BGR2GRAY)<span class="hljs-comment"># 转换为灰度图</span><span class="hljs-comment"># Canny边缘检测</span>edges = cv2.Canny(img3, <span class="hljs-number">30</span>, <span class="hljs-number">70</span>)cv2.imwrite(<span class="hljs-string">'canny.jpg'</span>, edges)</code></pre></div><h4 id="2-3-数据扩增方法"><a href="#2-3-数据扩增方法" class="headerlink" title="2.3 数据扩增方法"></a>2.3 数据扩增方法</h4><h5 id="2-3-1-数据扩增介绍"><a href="#2-3-1-数据扩增介绍" class="headerlink" title="2.3.1 数据扩增介绍"></a>2.3.1 数据扩增介绍</h5><p>在深度学习中数据扩增方法非常重要，数据扩增可以增加训练集的样本，同时也可以有效缓解模型过拟合的情况，也可以给模型带来的更强的泛化能力。</p><p><strong>有哪些数据扩增方法？</strong></p><p>数据扩增方法有很多：从颜色空间、尺度空间到样本空间，同时根据不同任务数据扩增都有相应的区别。<br>对于图像分类，数据扩增一般不会改变标签；对于物体检测，数据扩增会改变物体坐标位置；对于图像分割，数据扩增会改变像素标签。</p><h5 id="2-3-2-常见的数据扩增方法"><a href="#2-3-2-常见的数据扩增方法" class="headerlink" title="2.3.2 常见的数据扩增方法"></a>2.3.2 常见的数据扩增方法</h5><p>在常见的数据扩增方法中，一般会从图像颜色、尺寸、形态、空间和像素等角度进行变换。当然不同的数据扩增方法可以自由进行组合，得到更加丰富的数据扩增方法。</p><p>以torchvision为例，常见的数据扩增方法包括：</p><p>transforms.CenterCrop 对图片中心进行裁剪</p><p>transforms.ColorJitter 对图像颜色的对比度、饱和度和零度进行变换</p><p>transforms.FiveCrop 对图像四个角和中心进行裁剪得到五分图像</p><p>transforms.Grayscale 对图像进行灰度变换</p><p>transforms.Pad 使用固定值进行像素填充</p><p>transforms.RandomAffine 随机仿射变换</p><p>transforms.RandomCrop 随机区域裁剪</p><p>transforms.RandomHorizontalFlip 随机水平翻转</p><p>transforms.RandomRotation 随机旋转</p><p>transforms.RandomVerticalFlip 随机垂直翻转</p><h5 id="2-3-3-常用的数据扩增库"><a href="#2-3-3-常用的数据扩增库" class="headerlink" title="2.3.3 常用的数据扩增库"></a>2.3.3 常用的数据扩增库</h5><p>torchvision</p><p><a href="https://github.com/pytorch/vision" target="_blank" rel="noopener">https://github.com/pytorch/vision</a><br>pytorch官方提供的数据扩增库，提供了基本的数据数据扩增方法，可以无缝与torch进行集成；但数据扩增方法种类较少，且速度中等；</p><p>imgaug</p><p><a href="https://github.com/aleju/imgaug" target="_blank" rel="noopener">https://github.com/aleju/imgaug</a><br>imgaug是常用的第三方数据扩增库，提供了多样的数据扩增方法，且组合起来非常方便，速度较快；</p><p>albumentations</p><p><a href="https://albumentations.readthedocs.io" target="_blank" rel="noopener">https://albumentations.readthedocs.io</a><br>是常用的第三方数据扩增库，提供了多样的数据扩增方法，对图像分类、语义分割、物体检测和关键点检测都支持，速度较快。</p><h4 id="2-4-Pytorch读取数据"><a href="#2-4-Pytorch读取数据" class="headerlink" title="2.4 Pytorch读取数据"></a>2.4 Pytorch读取数据</h4><p>由于本次赛题我们使用Pytorch框架讲解具体的解决方案，接下来将是解决赛题的第一步使用Pytorch读取赛题数据。<br>在Pytorch中数据是通过Dataset进行封装，并通过DataLoder进行并行读取。所以我们只需要重载一下数据读取的逻辑就可以完成数据的读取。</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os, sys, glob, shutil, json<span class="hljs-keyword">import</span> cv2<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<span class="hljs-keyword">import</span> torch<span class="hljs-keyword">from</span> torch.utils.data.dataset <span class="hljs-keyword">import</span> Dataset<span class="hljs-keyword">import</span> torchvision.transforms <span class="hljs-keyword">as</span> transforms<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SVHNDataset</span><span class="hljs-params">(Dataset)</span>:</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, img_path, img_label, transform=None)</span>:</span>        self.img_path = img_path        self.img_label = img_label         <span class="hljs-keyword">if</span> transform <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:            self.transform = transform        <span class="hljs-keyword">else</span>:            self.transform = <span class="hljs-literal">None</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span><span class="hljs-params">(self, index)</span>:</span>        img = Image.open(self.img_path[index]).convert(<span class="hljs-string">'RGB'</span>)        <span class="hljs-keyword">if</span> self.transform <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:            img = self.transform(img)                <span class="hljs-comment"># 原始SVHN (Street View House Numbers)中类别10为数字0,数字1～9对应标签1～9，而“0”的标签则为10</span>        lbl = np.array(self.img_label[index], dtype=np.int)        lbl = list(lbl)  + (<span class="hljs-number">5</span> - len(lbl)) * [<span class="hljs-number">10</span>]                <span class="hljs-keyword">return</span> img, torch.from_numpy(np.array(lbl[:<span class="hljs-number">5</span>]))    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span><span class="hljs-params">(self)</span>:</span>        <span class="hljs-keyword">return</span> len(self.img_path)train_path = glob.glob(<span class="hljs-string">'./mchar_train/*.png'</span>)train_path.sort()train_json = json.load(open(<span class="hljs-string">'./mchar_train.json'</span>))train_label = [train_json[x][<span class="hljs-string">'label'</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> train_json]data=SVHNDataset(train_path, train_label,                transforms.Compose([                    transforms.Resize((<span class="hljs-number">64</span>, <span class="hljs-number">128</span>)),                    transforms.RandomCrop((<span class="hljs-number">60</span>, <span class="hljs-number">120</span>)),                    transforms.ColorJitter(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.2</span>),                    transforms.RandomRotation(<span class="hljs-number">10</span>),                    transforms.ToTensor(),                    transforms.Normalize([<span class="hljs-number">0.485</span>, <span class="hljs-number">0.456</span>, <span class="hljs-number">0.406</span>], [<span class="hljs-number">0.229</span>, <span class="hljs-number">0.224</span>, <span class="hljs-number">0.225</span>])    ]))</code></pre></div><p>代码说明：</p><div class="hljs"><pre><code class="hljs python">train_json格式：<span class="hljs-string">'000000.png'</span>: &#123;<span class="hljs-string">'height'</span>: [<span class="hljs-number">219</span>, <span class="hljs-number">219</span>],  <span class="hljs-string">'label'</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">9</span>],  <span class="hljs-string">'left'</span>: [<span class="hljs-number">246</span>, <span class="hljs-number">323</span>],  <span class="hljs-string">'top'</span>: [<span class="hljs-number">77</span>, <span class="hljs-number">81</span>],  <span class="hljs-string">'width'</span>: [<span class="hljs-number">81</span>, <span class="hljs-number">96</span>]&#125;,   train_label为train_json中label集合，举例train_label[<span class="hljs-number">0</span>]为[<span class="hljs-number">1</span>, <span class="hljs-number">9</span>]上述代码中：lbl=np.array(train_label[<span class="hljs-number">0</span>], dtype=np.int)array([<span class="hljs-number">1</span>, <span class="hljs-number">9</span>])lbl = list(lbl)  + (<span class="hljs-number">5</span> - len(lbl)) * [<span class="hljs-number">10</span>][<span class="hljs-number">1</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>]</code></pre></div><ul><li>Dataset：对数据集的封装，提供索引方式的对数据样本进行读取</li><li>DataLoder：对Dataset进行封装，提供批量读取的迭代读取</li></ul><div class="hljs"><pre><code class="hljs python">train_loader = torch.utils.data.DataLoader(        SVHNDataset(train_path, train_label,                   transforms.Compose([                       transforms.Resize((<span class="hljs-number">64</span>, <span class="hljs-number">128</span>)),                       transforms.ColorJitter(<span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.2</span>),                       transforms.RandomRotation(<span class="hljs-number">5</span>),                       transforms.ToTensor(),                       transforms.Normalize([<span class="hljs-number">0.485</span>, <span class="hljs-number">0.456</span>, <span class="hljs-number">0.406</span>], [<span class="hljs-number">0.229</span>, <span class="hljs-number">0.224</span>, <span class="hljs-number">0.225</span>])            ])),     batch_size=<span class="hljs-number">10</span>, <span class="hljs-comment"># 每批样本个数</span>    shuffle=<span class="hljs-literal">False</span>, <span class="hljs-comment"># 是否打乱顺序</span>    num_workers=<span class="hljs-number">0</span>, <span class="hljs-comment"># 读取的线程个数，windows为0</span>)<span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> train_loader:    <span class="hljs-keyword">break</span></code></pre></div><p>By 哒哒 CV实践小分队 17 2</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>零基础入门CV task1</title>
    <link href="/posts/ab419b1c.html"/>
    <url>/posts/ab419b1c.html</url>
    
    <content type="html"><![CDATA[<p>比赛地址：<a href="https://tianchi.aliyun.com/competition/entrance/531795/introduction" target="_blank" rel="noopener">https://tianchi.aliyun.com/competition/entrance/531795/introduction</a></p><h2 id="1-赛题理解"><a href="#1-赛题理解" class="headerlink" title="1 赛题理解"></a>1 赛题理解</h2><ul><li>赛题名称：零基础入门CV之街道字符识别</li><li>赛题目标：通过这道赛题可以引导大家走入计算机视觉的世界，主要针对竞赛选手上手视觉赛题，提高对数据建模能力。</li><li>赛题任务：赛题以计算机视觉中字符识别为背景，要求选手预测街道字符编码，这是一个典型的字符识别问题。<br>为了简化赛题难度，赛题数据采用公开数据集<a href="http://ufldl.stanford.edu/housenumbers/" target="_blank" rel="noopener">SVHN</a>，因此大家可以选择很多相应的paper作为思路参考。</li></ul><h3 id="1-1-学习目标"><a href="#1-1-学习目标" class="headerlink" title="1.1 学习目标"></a>1.1 学习目标</h3><ul><li>理解赛题背景和赛题数据</li><li>完成赛题报名和数据下载，理解赛题的解题思路</li></ul><h3 id="1-2-赛题数据"><a href="#1-2-赛题数据" class="headerlink" title="1.2 赛题数据"></a>1.2 赛题数据</h3><p>赛题以街道字符为为赛题数据，数据集报名后可见并可下载，该数据来自收集的SVHN街道字符，并进行了匿名采样处理。</p><p><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/赛事简介/数据集样本展示.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/%E8%B5%9B%E4%BA%8B%E7%AE%80%E4%BB%8B/%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%B7%E6%9C%AC%E5%B1%95%E7%A4%BA.png" srcset="/img/loading.gif" alt="数据示例"></a></p><p>注意: 按照比赛规则，所有的参赛选手只能使用比赛给定的数据集完成训练，不能使用SVHN原始数据集进行训练。比赛结束后将会对Top选手进行代码审核，违规的选手将清除排行榜成绩。</p><p>训练集数据包括3W张照片，验证集数据包括1W张照片，每张照片包括颜色图像和对应的编码类别和具体位置；为了保证比赛的公平性，测试集A包括4W张照片，测试集B包括4W张照片。</p><p>需要注意的是本赛题需要选手识别图片中所有的字符，为了降低比赛难度，我们提供了训练集、验证集中所有字符的位置框。</p><h3 id="1-3-数据标签"><a href="#1-3-数据标签" class="headerlink" title="1.3 数据标签"></a>1.3 数据标签</h3><p>对于训练数据每张图片将给出对于的编码标签，和具体的字符框的位置（训练集、验证集都给出字符位置），可用于模型训练：</p><div class="table-container"><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>top</td><td>左上角坐标X</td></tr><tr><td>height</td><td>字符高度</td></tr><tr><td>left</td><td>左上角最表Y</td></tr><tr><td>width</td><td>字符宽度</td></tr><tr><td>label</td><td>字符编码</td></tr></tbody></table></div><p>字符的坐标具体如下所示：<br><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/字符坐标.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/%E5%AD%97%E7%AC%A6%E5%9D%90%E6%A0%87.png" srcset="/img/loading.gif" alt="坐标"></a></p><p>在比赛数据（训练集和验证集）中，同一张图片中可能包括一个或者多个字符，因此在比赛数据的JSON标注中，会有两个字符的边框信息：</p><div class="table-container"><table><thead><tr><th>原始图片</th><th>图片JSON标注</th></tr></thead><tbody><tr><td><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/原始图片.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/%E5%8E%9F%E5%A7%8B%E5%9B%BE%E7%89%87.png" srcset="/img/loading.gif" alt="19"></a></td><td><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/原始图片标注.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/%E5%8E%9F%E5%A7%8B%E5%9B%BE%E7%89%87%E6%A0%87%E6%B3%A8.png" srcset="/img/loading.gif" alt="标注"></a></td></tr></tbody></table></div><h3 id="1-4-评测指标"><a href="#1-4-评测指标" class="headerlink" title="1.4 评测指标"></a>1.4 评测指标</h3><p>选手提交结果与实际图片的编码进行对比，以编码整体识别准确率为评价指标。任何一个字符错误都为错误，最终评测指标结果越大越好，具体计算公式如下：<br>Score=编码识别正确的数量/测试集图片数量</p><h3 id="1-5-读取数据"><a href="#1-5-读取数据" class="headerlink" title="1.5 读取数据"></a>1.5 读取数据</h3><p>为了方便大家进行数据读取，在此我们给出JSON中标签的读取方式：</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jsontrain_json = json.load(open(<span class="hljs-string">'../input/train.json'</span>))<span class="hljs-comment"># 数据标注处理</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_json</span><span class="hljs-params">(d)</span>:</span>   arr = np.array([       d[<span class="hljs-string">'top'</span>], d[<span class="hljs-string">'height'</span>], d[<span class="hljs-string">'left'</span>],  d[<span class="hljs-string">'width'</span>], d[<span class="hljs-string">'label'</span>]   ])   arr = arr.astype(int)   <span class="hljs-keyword">return</span> arrimg = cv2.imread(<span class="hljs-string">'../input/train/000000.png'</span>)arr = parse_json(train_json[<span class="hljs-string">'000000.png'</span>])plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>))plt.subplot(<span class="hljs-number">1</span>, arr.shape[<span class="hljs-number">1</span>]+<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)plt.imshow(img)plt.xticks([]); plt.yticks([])<span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> range(arr.shape[<span class="hljs-number">1</span>]):   plt.subplot(<span class="hljs-number">1</span>, arr.shape[<span class="hljs-number">1</span>]+<span class="hljs-number">1</span>, idx+<span class="hljs-number">2</span>)   plt.imshow(img[arr[<span class="hljs-number">0</span>, idx]:arr[<span class="hljs-number">0</span>, idx]+arr[<span class="hljs-number">1</span>, idx],arr[<span class="hljs-number">2</span>, idx]:arr[<span class="hljs-number">2</span>, idx]+arr[<span class="hljs-number">3</span>, idx]])   plt.title(arr[<span class="hljs-number">4</span>, idx])   plt.xticks([]); plt.yticks([])</code></pre></div><p><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/19.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/19.png" srcset="/img/loading.gif" alt="19"></a></p><h3 id="1-6-解题思路"><a href="#1-6-解题思路" class="headerlink" title="1.6 解题思路"></a>1.6 解题思路</h3><p>赛题思路分析：赛题本质是分类问题，需要对图片的字符进行识别。但赛题给定的数据图片中不同图片中包含的字符数量不等，如下图所示。有的图片的字符个数为2，有的图片字符个数为3，有的图片字符个数为4。</p><div class="table-container"><table><thead><tr><th>字符属性</th><th>图片</th></tr></thead><tbody><tr><td>字符：42 字符个数：2</td><td><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/42.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/42.png" srcset="/img/loading.gif" alt="标注"></a></td></tr><tr><td>字符：241 字符个数：3</td><td><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/2411.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/2411.png" srcset="/img/loading.gif" alt="标注"></a></td></tr><tr><td>字符：7358 字符个数：4</td><td><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/7358.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/7358.png" srcset="/img/loading.gif" alt="标注"></a></td></tr></tbody></table></div><p>因此本次赛题的难点是需要对不定长的字符进行识别，与传统的图像分类任务有所不同。为了降低参赛难度，我们提供了一些解题思路供大家参考：</p><ul><li>简单入门思路：定长字符识别</li></ul><p>可以将赛题抽象为一个定长字符识别问题，在赛题数据集中大部分图像中字符个数为2-4个，最多的字符 个数为6个。<br>因此可以对于所有的图像都抽象为6个字符的识别问题，字符23填充为23XXXX，字符231填充为231XXX。<br><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/23xxxxxx.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/23xxxxxx.png" srcset="/img/loading.gif" alt="标注"></a></p><p>经过填充之后，原始的赛题可以简化了6个字符的分类问题。在每个字符的分类中会进行11个类别的分类，假如分类为填充字符，则表明该字符为空。</p><ul><li>专业字符识别思路：不定长字符识别</li></ul><p><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/不定长字符识别.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/%E4%B8%8D%E5%AE%9A%E9%95%BF%E5%AD%97%E7%AC%A6%E8%AF%86%E5%88%AB.png" srcset="/img/loading.gif" alt="标注"></a></p><p>在字符识别研究中，有特定的方法来解决此种不定长的字符识别问题，比较典型的有CRNN字符识别模型。<br>在本次赛题中给定的图像数据都比较规整，可以视为一个单词或者一个句子。</p><ul><li>专业分类思路：检测再识别</li></ul><p>在赛题数据中已经给出了训练集、验证集中所有图片中字符的位置，因此可以首先将字符的位置进行识别，利用物体检测的思路完成。</p><p><a href="https://github.com/datawhalechina/team-learning/blob/master/03 计算机视觉/计算机视觉实践（街景字符编码识别）/IMG/Task01/检测.png" target="_blank" rel="noopener"><img src="https://github.com/datawhalechina/team-learning/raw/master/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E5%AE%9E%E8%B7%B5%EF%BC%88%E8%A1%97%E6%99%AF%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E8%AF%86%E5%88%AB%EF%BC%89/IMG/Task01/%E6%A3%80%E6%B5%8B.png" srcset="/img/loading.gif" alt="IMG"></a></p><p>此种思路需要参赛选手构建字符检测模型，对测试集中的字符进行识别。选手可以参考物体检测模型SSD或者YOLO来完成。</p><h3 id="1-7-本章小节"><a href="#1-7-本章小节" class="headerlink" title="1.7 本章小节"></a>1.7 本章小节</h3><p>综上所示，本次赛题虽然是一个简单的字符识别问题，但有多种解法可以使用到计算机视觉领域中的各个模型，是非常适合大家入门学习的。<br>三种解决思路的难度从低到高，因此建议入门学习的同学可以先学习定长字符识别的思路。在文档之后的内容中我们也会以定长字符识别为例，让大家逐渐入门计算机视觉。</p><h2 id="2-配置环境"><a href="#2-配置环境" class="headerlink" title="2 配置环境"></a>2 配置环境</h2><h3 id="2-1-CUDA安装"><a href="#2-1-CUDA安装" class="headerlink" title="2.1 CUDA安装"></a>2.1 CUDA安装</h3><p>CUDA就是一门编程语言，像C,C++,python 一样，也有人说CUDA是API。CUDA英文全称是Compute Unified Device Architecture，是显卡厂商NVIDIA推出的运算平台。 CUDA™是一种由NVIDIA推出的通用并行计算架构，该架构使GPU能够解决复杂的计算问题。按照<a href="https://blogs.nvidia.com/blog/2012/09/10/what-is-cuda-2/" target="_blank" rel="noopener">官方</a>的说法是，<strong>CUDA是一个并行计算平台和编程模型，能够使得使用GPU进行通用计算变得简单和优雅</strong>。</p><p><a href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html" target="_blank" rel="noopener">https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html</a></p><p><img src="https://raw.githubusercontent.com/anonymous12357/fitness/master/20200520132456.png" srcset="/img/loading.gif" alt="tflrie3lx8"></p><p><strong>注意</strong>：图片中computer capabilities 并不需要和cuda驱动版本一致</p><p>CUDA Toolkit由以下组件组成：</p><ul><li><p><strong>Compiler</strong>: CUDA-C和CUDA-C++编译器<code>NVCC</code>位于<code>bin/</code>目录中。它建立在<code>NVVM</code>优化器之上，而<code>NVVM</code>优化器本身构建在<code>LLVM</code>编译器基础结构之上。希望开发人员可以使用<code>nvm/</code>目录下的Compiler SDK来直接针对NVVM进行开发。</p></li><li><p><strong>Tools</strong>: 提供一些像<code>profiler</code>,<code>debuggers</code>等工具，这些工具可以从<code>bin/</code>目录中获取</p></li><li><p>Libraries</p><p>: 下面列出的部分科学库和实用程序库可以在</p><div class="hljs"><pre><code class="hljs crystal"><span class="hljs-class"><span class="hljs-keyword">lib</span>/</span></code></pre></div><p>目录中使用(Windows上的DLL位于</p><div class="hljs"><pre><code class="hljs plain">bin&#x2F;</code></pre></div><p>中)，它们的接口在</p><div class="hljs"><pre><code class="hljs actionscript"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span>/</span></code></pre></div><p>目录中可获取。</p><ul><li><strong>cudart</strong>: CUDA Runtime</li><li><strong>cudadevrt</strong>: CUDA device runtime</li><li><strong>cupti</strong>: CUDA profiling tools interface</li><li><strong>nvml</strong>: NVIDIA management library</li><li><strong>nvrtc</strong>: CUDA runtime compilation</li><li><strong>cublas</strong>: BLAS (Basic Linear Algebra Subprograms，基础线性代数程序集)</li><li><strong>cublas_device</strong>: BLAS kernel interface</li><li>…</li></ul></li><li><p><strong>CUDA Samples</strong>: 演示如何使用各种CUDA和library API的代码示例。可在Linux和Mac上的<code>samples/</code>目录中获得，Windows上的路径是<code>C：\ProgramData\NVIDIA Corporation\CUDA Samples</code>中。在Linux和Mac上，<code>samples/</code>目录是只读的，如果要对它们进行修改，则必须将这些示例复制到另一个位置。</p></li><li><p><strong>CUDA Driver</strong>: 运行CUDA应用程序需要系统至少有一个<strong>具有CUDA功能的GPU</strong>和<strong>与CUDA工具包兼容的驱动程序</strong>。每个版本的CUDA工具包都对应一个最低版本的CUDA Driver，也就是说如果你安装的CUDA Driver版本比官方推荐的还低，那么很可能会无法正常运行。CUDA Driver是向后兼容的，这意味着根据CUDA的特定版本编译的应用程序将继续在后续发布的Driver上也能继续工作。通常为了方便，在安装CUDA Toolkit的时候会默认安装CUDA Driver。在开发阶段可以选择默认安装Driver，但是对于像Tesla GPU这样的商用情况时，建议在<a href="http://www.nvidia.com/drivers" target="_blank" rel="noopener">官方</a>安装最新版本的Driver。<br>目前(2019年10月)的CUDA Toolkit和CUDA Driver版本的对应情况如下：</p></li></ul><div class="table-container"><table><thead><tr><th style="text-align:center">CUDA Toolkit</th><th style="text-align:center">Linux x86_64 Driver Version</th><th style="text-align:center">Windows x86_64 Driver Version</th></tr></thead><tbody><tr><td style="text-align:center">CUDA 10.1 (10.1.105 general release, and updates)</td><td style="text-align:center">&gt;= 418.39</td><td style="text-align:center">&gt;= 418.96</td></tr><tr><td style="text-align:center">CUDA 10.0.130</td><td style="text-align:center">&gt;= 410.48</td><td style="text-align:center">&gt;= 411.31</td></tr><tr><td style="text-align:center">CUDA 9.2 (9.2.148 Update 1)</td><td style="text-align:center">&gt;= 396.37</td><td style="text-align:center">&gt;= 398.26</td></tr><tr><td style="text-align:center">CUDA 9.2 (9.2.88)</td><td style="text-align:center">&gt;= 396.26</td><td style="text-align:center">&gt;= 397.44</td></tr><tr><td style="text-align:center">CUDA 9.1 (9.1.85)</td><td style="text-align:center">&gt;= 390.46</td><td style="text-align:center">&gt;= 391.29</td></tr><tr><td style="text-align:center">CUDA 9.0 (9.0.76)</td><td style="text-align:center">&gt;= 384.81</td><td style="text-align:center">&gt;= 385.54</td></tr><tr><td style="text-align:center">CUDA 8.0 (8.0.61 GA2)</td><td style="text-align:center">&gt;= 375.26</td><td style="text-align:center">&gt;= 376.51</td></tr><tr><td style="text-align:center">CUDA 8.0 (8.0.44)</td><td style="text-align:center">&gt;= 367.48</td><td style="text-align:center">&gt;= 369.30</td></tr><tr><td style="text-align:center">CUDA 7.5 (7.5.16)</td><td style="text-align:center">&gt;= 352.31</td><td style="text-align:center">&gt;= 353.66</td></tr><tr><td style="text-align:center">CUDA 7.0 (7.0.28)</td><td style="text-align:center">&gt;= 346.46</td><td style="text-align:center">&gt;= 347.62</td></tr></tbody></table></div><h3 id="2-2-conda下安装pytorch"><a href="#2-2-conda下安装pytorch" class="headerlink" title="2.2 conda下安装pytorch"></a>2.2 conda下安装pytorch</h3><p>使用 Anaconda prompt 创建环境;</p><div class="hljs"><pre><code class="hljs routeros">conda create -n pytorch_gpu pip <span class="hljs-attribute">python</span>=3.7</code></pre></div><p>进入创建好的环境里；</p><div class="hljs"><pre><code class="hljs applescript">conda <span class="hljs-built_in">activate</span> pytorch_gpu</code></pre></div><div class="hljs"><pre><code class="hljs crystal">先添加清华的channelsconda config --add channels <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/mirrors.tuna.tsinghua.edu.cn/anaconda</span><span class="hljs-regexp">/pkgs/free</span><span class="hljs-regexp">/</span><span class="hljs-regexp">conda config --add channels https:/</span><span class="hljs-regexp">/mirrors.tuna.tsinghua.edu.cn/anaconda</span><span class="hljs-regexp">/pkgs/main</span><span class="hljs-regexp">/</span><span class="hljs-regexp">conda config --set show_channel_urls yes</span><span class="hljs-regexp"></span><span class="hljs-regexp"># 安装pytorch，基于cudatoolkit=9.2</span><span class="hljs-regexp">conda config --add channels https:/</span><span class="hljs-regexp">/mirrors.tuna.tsinghua.edu.cn/anaconda</span><span class="hljs-regexp">/cloud/pytorch</span><span class="hljs-regexp">/</span><span class="hljs-regexp">conda config --add channels  https:/</span><span class="hljs-regexp">/mirrors.tuna.tsinghua.edu.cn/anaconda</span><span class="hljs-regexp">/cloud/numba</span><span class="hljs-regexp">/label/dev</span><span class="hljs-regexp">/noarch/</span>conda config --add channels  <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/mirrors.tuna.tsinghua.edu.cn/anaconda</span><span class="hljs-regexp">/cloud/numba</span><span class="hljs-regexp">/label/dev</span><span class="hljs-regexp">/win-64/</span>conda install pytorch torchvision cudatoolkit=<span class="hljs-number">9.2</span><span class="hljs-comment"># 安装其他依赖包</span>pip install -i <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/pypi.tuna.tsinghua.edu.cn/simple</span> jupyter tqdm opencv-python matplotlib pandas</code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Windows下安装npm</title>
    <link href="/posts/bb9bd797.html"/>
    <url>/posts/bb9bd797.html</url>
    
    <content type="html"><![CDATA[<h2 id="Windows下安装npm"><a href="#Windows下安装npm" class="headerlink" title="Windows下安装npm"></a>Windows下安装npm</h2><h3 id="安装npm"><a href="#安装npm" class="headerlink" title="安装npm"></a>安装npm</h3><ol><li><p>在cmd里输入node -v，若能出现版本号，则表示已经安装，若不能，需要到官网下载安装 （<a href="https://nodejs.org/zh-cn/）" target="_blank" rel="noopener">https://nodejs.org/zh-cn/）</a></p></li><li><p>首先配置npm的全局模块的存放路径、cache的路径，此处我选择放在：<strong>D:\Program Files\nodejs</strong><br>运行<strong>DOS</strong>，输入：</p><div class="hljs"><pre><code class="hljs routeros">npm<span class="hljs-built_in"> config </span><span class="hljs-builtin-name">set</span><span class="hljs-built_in"> prefix </span><span class="hljs-string">"D:\Program Files\nodejs\node_global"</span>npm<span class="hljs-built_in"> config </span><span class="hljs-builtin-name">set</span> cache<span class="hljs-string">"D:\Program Files\nodejs\node_cache"</span></code></pre></div><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-43603c027c382f67.png?imageMogr2/auto-orient/strip|imageView2/2/w/607/format/webp" srcset="/img/loading.gif" alt="img"></p><p>完成后可以在文件夹中看到相应名字的文件夹：</p></li></ol><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-ff3a4348f8de691f.png?imageMogr2/auto-orient/strip|imageView2/2/w/617/format/webp" srcset="/img/loading.gif" alt="img"></p><p>2、在系统环境变量添加<strong>NODE_PATH</strong>,输入路径为： <strong>D:\Program Files\nodejs\node_global</strong><br>操作如下：我的电脑右击，打开属性-&gt;高级系统设置-&gt;环境变量-&gt;新建（系统变量下）-&gt;输入变量名NODE_PATH-&gt;变量值：输入上面路径，确定即可。</p><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-02ab0351eef9f8b7.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" srcset="/img/loading.gif" alt="img"></p><p>3、在命令行输入：<strong>npm install express -g</strong><br>安装express（注：“-g”表示安装到global目录下，就是上面设置的node_global中）</p><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-71f3b3c3da1bff63.png?imageMogr2/auto-orient/strip|imageView2/2/w/402/format/webp" srcset="/img/loading.gif" alt="img"></p><p>可以看到node_global/node_modules下有express了：</p><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-2d8772945c59a55d.png?imageMogr2/auto-orient/strip|imageView2/2/w/524/format/webp" srcset="/img/loading.gif" alt="img"></p><p>4、在命令行输入：<strong>node</strong>进入编辑模式</p><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-cedabea5f8b7ea76.png?imageMogr2/auto-orient/strip|imageView2/2/w/451/format/webp" srcset="/img/loading.gif" alt="img"></p><p>输入：<strong>require(‘express’)</strong>检测是否能正常加载模块：</p><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-c5c4ed0dbcf4b03c?imageMogr2/auto-orient/strip|imageView2/2/w/487/format/webp" srcset="/img/loading.gif" alt="img"></p><p>如果成功，如上图显示；如果出错，检测下上面配置的NODE_PATH是否配置或者配置正确。</p><h3 id="安装cnpm"><a href="#安装cnpm" class="headerlink" title="安装cnpm"></a>安装cnpm</h3><p>1、安装cnpm，输入以下命令：<strong>npm install -g cnpm —registry=<a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></strong></p><p>为了避免每次安装都需要加上—registry参数，可以使用如下命令，永久更改系统里面的指定下载站点</p><div class="hljs"><pre><code class="hljs js">npm config <span class="hljs-keyword">set</span> registry http://registry.npm.taobao.org</code></pre></div><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-a84ea562c3f596cb.png?imageMogr2/auto-orient/strip|imageView2/2/w/882/format/webp" srcset="/img/loading.gif" alt="img"></p><p>2、输入<code>cnpm -v</code> ，检测是否正常</p><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-43a6da4d631c42b1.png?imageMogr2/auto-orient/strip|imageView2/2/w/863/format/webp" srcset="/img/loading.gif" alt="img"></p><p>如果报错，添加系统变量path的内容<br>因为cnpm会被安装到D:\Program Files\nodejs\node_global下，而系统变量path并未包含该路径。在系统变量path下添加该路径即可正常使用cnpm。</p><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-efdd94a86522f273.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" srcset="/img/loading.gif" alt="img"></p><p>然后再次输入<code>cnpm -v</code> ，结果如下：</p><p><img src="https:////upload-images.jianshu.io/upload_images/13319862-9209d3dd952394a8.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp" srcset="/img/loading.gif" alt="img"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>brook快速搭建socks5代理</title>
    <link href="/posts/5761edb4.html"/>
    <url>/posts/5761edb4.html</url>
    
    <content type="html"><![CDATA[<h3 id="brook快速搭建socks5代理"><a href="#brook快速搭建socks5代理" class="headerlink" title="brook快速搭建socks5代理"></a>brook快速搭建socks5代理</h3><p>安装brook：</p><div class="hljs"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/txthinking/</span>brook<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v20200201/</span>brookchmod +x brookmv brook <span class="hljs-regexp">/usr/</span>bin</code></pre></div><p>如何搭建Socks5?</p><div class="hljs"><pre><code class="hljs routeros"><span class="hljs-builtin-name">Run</span> socks5 serverStart socks5 server: $ brook socks5 -l :9999 -i your_server_ipThis will listen on TCP/UDP<span class="hljs-built_in"> port </span>9999, your can choose other port<span class="hljs-keyword">Or</span> with auth --username username --password password<span class="hljs-keyword">If</span> you have firewall, ensure it allowed both TCP/UDP 9999 port.Don<span class="hljs-string">'t forget to allow UDP port</span><span class="hljs-string">Stop brook: press Control + C</span></code></pre></div><p>简单使用：(将本地1000端口设置为socks5端口):</p><div class="hljs"><pre><code class="hljs angelscript">brook socks5 -l :<span class="hljs-number">1000</span> -i <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span></code></pre></div><p>后台运行：</p><div class="hljs"><pre><code class="hljs angelscript">nohup brook socks5 -l :<span class="hljs-number">1000</span> -i <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> &amp;</code></pre></div><p>如何设置密码?</p><div class="hljs"><pre><code class="hljs brainfuck"><span class="hljs-comment">末尾添加：</span>--<span class="hljs-comment">username</span> <span class="hljs-comment">用户名</span> --<span class="hljs-comment">password</span> <span class="hljs-comment">密码</span>  <span class="hljs-comment">即可。</span></code></pre></div><div class="hljs"><pre><code class="hljs angelscript">nohup brook socks5 -l :<span class="hljs-number">1081</span> -i <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> --username xxxxx --password xxxxx &gt;/dev/<span class="hljs-literal">null</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &amp;</code></pre></div><h3 id="Systemd方法"><a href="#Systemd方法" class="headerlink" title="Systemd方法"></a>Systemd方法</h3><div class="hljs"><pre><code class="hljs crystal">nano /<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">systemd</span>/<span class="hljs-title">system</span>/<span class="hljs-title">socks5</span>.<span class="hljs-title">service</span></span></code></pre></div><div class="hljs"><pre><code class="hljs bash">[Unit]Description=shadowsocks-libevAfter=network.target[Service]ExecStart=/home/geerda/brook/brook_linux_amd64 socks5 -l :1081 -i 0.0.0.0 --username xxxxx --password xxxxx Restart=on-abort[Install]WantedBy=multi-user.target</code></pre></div><div class="hljs"><pre><code class="hljs css"><span class="hljs-selector-tag">systemctl</span> <span class="hljs-selector-tag">enable</span> <span class="hljs-selector-tag">socks5</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-tag">systemctl</span> <span class="hljs-selector-tag">start</span> <span class="hljs-selector-tag">socks5</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-tag">systemctl</span> <span class="hljs-selector-tag">status</span> <span class="hljs-selector-tag">socks5</span><span class="hljs-selector-class">.service</span></code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>安装Shadowsocks-libev v2ray-plugin</title>
    <link href="/posts/9685df88.html"/>
    <url>/posts/9685df88.html</url>
    
    <content type="html"><![CDATA[<h2 id="安装Shadowsocks-libev、Nginx、acme-sh-SSL认证-使用-v2ray-plugin-协议"><a href="#安装Shadowsocks-libev、Nginx、acme-sh-SSL认证-使用-v2ray-plugin-协议" class="headerlink" title="安装Shadowsocks-libev、Nginx、acme.sh SSL认证;使用 v2ray-plugin 协议"></a>安装Shadowsocks-libev、Nginx、acme.sh SSL认证;使用 v2ray-plugin 协议</h2><p><strong>云服务商提前做好DNS解析域名到VPS</strong></p><p><strong>数据包的流向</strong></p><div class="hljs"><pre><code class="hljs dust"><span class="hljs-template-variable">&#123;浏览器&#125;</span><span class="xml"> <span class="hljs-tag">&lt;<span class="hljs-name">--socks--</span>&gt;</span> </span><span class="hljs-template-variable">&#123;SS客户端+v2ray-plugin&#125;</span><span class="xml"> <span class="hljs-tag">&lt;<span class="hljs-name">--websocket+tls--</span>&gt;</span> </span><span class="hljs-template-variable">&#123;服务器nginx&#125;</span><span class="xml"> <span class="hljs-tag">&lt;<span class="hljs-name">--</span>&gt;</span> </span><span class="hljs-template-variable">&#123;SS服务端+v2ray-plugin&#125;</span><span class="xml"> <span class="hljs-tag">&lt;<span class="hljs-name">--</span>&gt;</span> </span><span class="hljs-template-variable">&#123;目标网站&#125;</span></code></pre></div><p><strong>SS v2ray-plugin 也是可以不使用nginx做转发, 直接到SS服务端, 证书需要直接添加到SS服务端, 和上面稍有区别</strong></p><div class="hljs"><pre><code class="hljs dust"><span class="hljs-template-variable">&#123;浏览器&#125;</span><span class="xml"> <span class="hljs-tag">&lt;<span class="hljs-name">--socks--</span>&gt;</span> </span><span class="hljs-template-variable">&#123;SS客户端+v2ray-plugin&#125;</span><span class="xml"> <span class="hljs-tag">&lt;<span class="hljs-name">--websocket+tls--</span>&gt;</span> </span><span class="hljs-template-variable">&#123;SS服务端+v2ray-plugin&#125;</span><span class="xml"> <span class="hljs-tag">&lt;<span class="hljs-name">--</span>&gt;</span> </span><span class="hljs-template-variable">&#123;目标网站&#125;</span></code></pre></div><h3 id="1，安装Nginx"><a href="#1，安装Nginx" class="headerlink" title="1，安装Nginx"></a>1，安装Nginx</h3><p>Debian及Ubuntu添加Nginx官方源</p><p>和CentOS类似，我们也需要更改系统的源仓库文件，只是我们按照习惯，可以不用新建文件，直接在现有的源仓库文件上添加两行就行了。</p><p>用编辑器打开<strong><em>/etc/apt/sources.list\</em></strong>，Debian添加如下内容：</p><div class="hljs"><pre><code class="hljs crystal">deb <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/nginx.org/packages</span><span class="hljs-regexp">/debian/</span> codename nginxdeb-src <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/nginx.org/packages</span><span class="hljs-regexp">/debian/</span> codename nginx</code></pre></div><p>Ubuntu添加如下内容：</p><div class="hljs"><pre><code class="hljs crystal">deb <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/nginx.org/packages</span><span class="hljs-regexp">/ubuntu/</span> codename nginxdeb-src <span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/nginx.org/packages</span><span class="hljs-regexp">/ubuntu/</span> codename nginx</code></pre></div><p>然后根据实际发行版代号，替换上面的<strong><em>code\</em></strong>为实际的发行版代号，相关代号可以用命令<strong><em>cat /etc/os-release\</em></strong>查询得到。</p><p>添加完成之后，还需要添加Nginx官方的Key，不然会提示Key错误，命令如下：</p><div class="hljs"><pre><code class="hljs sas">wget https://nginx.org/keys/nginx_signing.<span class="hljs-meta">key</span> -O /tmp/nginx_signing.<span class="hljs-meta">key</span>apt-<span class="hljs-meta">key</span> <span class="hljs-meta">add</span> /tmp/nginx_signing.<span class="hljs-meta">key</span></code></pre></div><p>添加完成之后，要先更新仓库源信息才能安装Nginx：</p><div class="hljs"><pre><code class="hljs routeros">apt-<span class="hljs-builtin-name">get</span> updateapt<span class="hljs-built_in"> upgrade </span>nginx</code></pre></div><p>安装之后，可以通过如下命令查看Nginx的版本：</p><blockquote><p>nginx -v</p></blockquote><h4 id="1-1创建Web目录"><a href="#1-1创建Web目录" class="headerlink" title="1.1创建Web目录"></a>1.1创建Web目录</h4><p>所有的网站将会存放到 /var/www 下， example网站将会存放到 /var/www/example下面。</p><div class="hljs"><pre><code class="hljs maxima"><span class="hljs-built_in">mkdir</span> /<span class="hljs-built_in">var</span>/www<span class="hljs-built_in">mkdir</span> /<span class="hljs-built_in">var</span>/www/<span class="hljs-built_in">example</span></code></pre></div><h4 id="1-2修改nginx服务器配置文件"><a href="#1-2修改nginx服务器配置文件" class="headerlink" title="1.2修改nginx服务器配置文件"></a>1.2修改nginx服务器配置文件</h4><p>这里使用了nano编辑器，如何没有安装可以使用 <strong>apt-get install nano</strong> 安装，或者使用你喜欢的 vim编辑器。</p><div class="hljs"><pre><code class="hljs awk">nano <span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf</span></code></pre></div><div class="hljs"><pre><code class="hljs nginx"><span class="hljs-comment"># user www-data;</span><span class="hljs-attribute">worker_processes</span> auto;<span class="hljs-attribute">pid</span> /run/nginx.pid;<span class="hljs-section">events</span> &#123;        <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">3000</span>;        <span class="hljs-attribute">multi_accept</span> <span class="hljs-literal">on</span>;&#125;<span class="hljs-section">http</span> &#123;    <span class="hljs-comment">##</span>    <span class="hljs-comment"># Basic Settings</span>    <span class="hljs-comment">##</span>    <span class="hljs-attribute">aio</span> threads;    <span class="hljs-attribute">sendfile</span> <span class="hljs-literal">on</span>;    <span class="hljs-attribute">tcp_nopush</span> <span class="hljs-literal">on</span>;    <span class="hljs-attribute">charset</span> UTF-<span class="hljs-number">8</span>;    <span class="hljs-attribute">tcp_nodelay</span> <span class="hljs-literal">on</span>;    <span class="hljs-attribute">keepalive_timeout</span> <span class="hljs-number">65</span>;    <span class="hljs-attribute">types_hash_max_size</span> <span class="hljs-number">2048</span>;    <span class="hljs-attribute">server_tokens</span> <span class="hljs-literal">off</span>;    <span class="hljs-comment"># server_names_hash_bucket_size 64;</span>    <span class="hljs-comment"># server_name_in_redirect off;</span>    <span class="hljs-attribute">include</span> /etc/nginx/mime.types;    <span class="hljs-attribute">default_type</span> application/octet-stream;    <span class="hljs-comment">##</span>    <span class="hljs-comment"># SSL Settings</span>    <span class="hljs-comment">##</span>    <span class="hljs-attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="hljs-number">1</span> TLSv1.<span class="hljs-number">2</span>; <span class="hljs-comment"># Dropping SSLv3, ref: POODLE</span>    <span class="hljs-attribute">ssl_prefer_server_ciphers</span> <span class="hljs-literal">on</span>;    <span class="hljs-comment">##</span>    <span class="hljs-comment"># Logging Settings: nginx访问日志存放地址</span>    <span class="hljs-comment">##</span>    <span class="hljs-attribute">access_log</span> /var/log/nginx/access.log;    <span class="hljs-attribute">error_log</span> /var/log/nginx/error.log;    <span class="hljs-comment">##</span>    <span class="hljs-comment"># Gzip Settings: 开启gip压缩</span>    <span class="hljs-comment">##</span>    <span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>;    <span class="hljs-attribute">gzip_disable</span> <span class="hljs-string">"msie6"</span>;    <span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>;    <span class="hljs-attribute">gzip_proxied</span> any;    <span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">6</span>;    <span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">16</span> <span class="hljs-number">8k</span>;    <span class="hljs-attribute">gzip_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;    <span class="hljs-attribute">gzip_types</span> text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;    <span class="hljs-comment">##</span>    <span class="hljs-comment"># Virtual Host Configs</span>    <span class="hljs-comment">##</span>    <span class="hljs-comment">#注释掉默认的引用文件</span>    <span class="hljs-comment">#include /etc/nginx/conf.d/*.conf;</span>    <span class="hljs-comment">#include /etc/nginx/sites-enabled/*;</span>    <span class="hljs-comment">#****************************OnceAI***************************</span>    <span class="hljs-comment"># default_server 代表默认服务器</span>    <span class="hljs-comment"># 比如从IP访问时，并没有匹配 onceai.com 的域名，但也会代理到 /var/www/onceai 网站目录</span>    <span class="hljs-comment"># 如果去掉 default_server，此服务器将只会处理onceai.com域名的请求，</span>    <span class="hljs-comment"># 请将onceai.com换成你自己的域名。</span>    <span class="hljs-comment">#**************************************************************</span>    <span class="hljs-section">server</span> &#123;        <span class="hljs-attribute">listen</span>  <span class="hljs-number">80</span> default_server;        <span class="hljs-attribute">server_name</span> xxxxxx;        <span class="hljs-attribute">location</span> / &#123;            <span class="hljs-attribute">root</span>   /var/www/example;            <span class="hljs-attribute">index</span>  index.html;        &#125;    &#125;&#125;</code></pre></div><h4 id="1-3-测试nginx配置文件"><a href="#1-3-测试nginx配置文件" class="headerlink" title="1.3 测试nginx配置文件"></a>1.3 测试nginx配置文件</h4><div class="hljs"><pre><code class="hljs awk">nginx -t -c <span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf</span></code></pre></div><h4 id="1-4-测试通过，重启nginx服务器"><a href="#1-4-测试通过，重启nginx服务器" class="headerlink" title="1.4 测试通过，重启nginx服务器"></a>1.4 测试通过，重启nginx服务器</h4><div class="hljs"><pre><code class="hljs awk"><span class="hljs-regexp">/etc/i</span>nit.d<span class="hljs-regexp">/nginx restart</span></code></pre></div><h4 id="1-5-创建默认-index-html-网页"><a href="#1-5-创建默认-index-html-网页" class="headerlink" title="1.5 创建默认 index.html 网页"></a>1.5 创建默认 index.html 网页</h4><div class="hljs"><pre><code class="hljs awk">nano <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/example/i</span>ndex.html<span class="hljs-comment">#可以写入文字在主页显示，必须是index.html名称</span></code></pre></div><p>使用公网IP域域名访问测试你的服务器，查看 index.html 是否显示</p><h3 id="2，申请ssl证书"><a href="#2，申请ssl证书" class="headerlink" title="2，申请ssl证书"></a>2，申请ssl证书</h3><h4 id="2-1-安装-acme-sh"><a href="#2-1-安装-acme-sh" class="headerlink" title="2.1 安装 acme.sh"></a>2.1 安装 <strong>acme.sh</strong></h4><p>安装很简单, 一个命令:</p><div class="hljs"><pre><code class="hljs vim">curl  http<span class="hljs-variable">s:</span>//<span class="hljs-built_in">get</span>.acme.<span class="hljs-keyword">sh</span> | <span class="hljs-keyword">sh</span></code></pre></div><p>普通用户和 root 用户都可以安装使用. 安装过程进行了以下几步:</p><div class="hljs"><pre><code class="hljs arcade">~<span class="hljs-regexp">/.acme.sh/</span></code></pre></div><p>创建 一个 bash 的 alias, 方便你的使用:</p><div class="hljs"><pre><code class="hljs stata">alias acme.<span class="hljs-keyword">sh</span>=~/.acme.<span class="hljs-keyword">sh</span>/acme.<span class="hljs-keyword">sh</span></code></pre></div><h4 id="2-2-生成证书"><a href="#2-2-生成证书" class="headerlink" title="2.2 生成证书"></a>2.2 生成证书</h4><p><strong>acme.sh</strong> 实现了 <strong>acme</strong> 协议支持的所有验证协议. 一般有两种方式验证: http 和 dns 验证.</p><p>http 方式需要在你的网站根目录下放置一个文件, 来验证你的域名所有权,完成验证. 然后就可以生成证书了.</p><div class="hljs"><pre><code class="hljs jboss-cli">acme.sh  <span class="hljs-params">--issue</span>  -d xxxxxx  <span class="hljs-params">--webroot</span>  <span class="hljs-string">/var/www/example</span>  <span class="hljs-params">--keylength</span> ec-256</code></pre></div><p>只需要指定域名, 并指定域名所在的网站根目录. <strong>acme.sh</strong> 会全自动的生成验证文件, 并放到网站的根目录, 然后自动完成验证. 最后会聪明的删除验证文件. 整个过程没有任何副作用.</p><p>Nginx 的配置 <code>ssl_certificate</code> 使用 <code>fullchain.cer</code> ，而非 <code>/etc/nginx/ssl/.cer</code> ，否则 <a href="https://www.ssllabs.com/ssltest/" target="_blank" rel="noopener">SSL Labs</a> 的测试会报 <code>Chain issues Incomplete</code> 错误。</p><h4 id="2-3-修改-etc-nginx-nginx-conf-为-443-SSL-协议"><a href="#2-3-修改-etc-nginx-nginx-conf-为-443-SSL-协议" class="headerlink" title="2.3 修改  /etc/nginx/nginx.conf 为 443 SSL 协议"></a>2.3 修改 /etc/nginx/nginx.conf 为 443 SSL 协议</h4><p>在1.2的基础上主要修改server部分，修改结果如下。可以全部替换上面写的</p><div class="hljs"><pre><code class="hljs awk">nano <span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf</span></code></pre></div><div class="hljs"><pre><code># user www-data;worker_processes auto;pid /run/nginx.pid;events {        worker_connections 768;        multi_accept on;}http {    ##    # Basic Settings    ##    sendfile on;    tcp_nopush on;    tcp_nodelay on;    keepalive_timeout 65;    types_hash_max_size 2048;    server_tokens off;    charset UTF-8;        # server_names_hash_bucket_size 64;    # server_name_in_redirect off;    include /etc/nginx/mime.types;    default_type application/octet-stream;    ##    # SSL Settings    ##    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE    ssl_prefer_server_ciphers on;    ##    # Logging Settings: nginx访问日志存放地址    ##    access_log /var/log/nginx/access.log;    error_log /var/log/nginx/error.log;    ##    # Gzip Settings: 开启gip压缩    ##    gzip on;    gzip_disable &quot;msie6&quot;;    gzip_vary on;    gzip_proxied any;    gzip_comp_level 6;    gzip_buffers 16 8k;    gzip_http_version 1.1;    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;    ##    # Virtual Host Configs    ##    #注释掉默认的引用文件    #include /etc/nginx/conf.d/*.conf;    #include /etc/nginx/sites-enabled/*;    #****************************OnceAI***************************    # default_server 代表默认服务器    # 比如从IP访问时，并没有匹配 onceai.com 的域名，但也会代理到 /var/www/onceai 网站目录    # 如果去掉 default_server，此服务器将只会处理onceai.com域名的请求，    # 请将onceai.com换成你自己的域名。    #**************************************************************    server {    listen 443 ssl http2 reuseport fastopen=256;    listen [::]:443 ssl http2 reuseport fastopen=256;    ssl_certificate       /root/.acme.sh/xxxxxx/fullchain.cer;    ssl_certificate_key    /root/.acme.sh/xxxxxx/xxxxxx.key;    ssl_protocols         TLSv1.1 TLSv1.2;    ssl_ciphers HIGH:!aNULL:!MD5;    ssl_prefer_server_ciphers on;    ssl_session_cache   shared:SSL:40m;    ssl_session_timeout 1d;    ssl_session_tickets off;    ssl_stapling on;    ssl_stapling_verify on;    #ssl_dhparam /etc/nginx/nginx.pem;    resolver 127.0.0.1;    resolver_timeout 10s;    server_name           xxxxxx;    #add_header alt-svc &#39;quic=&quot;:443&quot;; ma=2592000; v=&quot;46&quot;&#39;;    #add_header X-Frame-Options SAMEORIGIN always;    #add_header X-Content-Type-Options &quot;nosniff&quot; always;    #add_header X-XSS-Protection &quot;1; mode=block&quot; always;    #add_header Referrer-Policy &quot;no-referrer&quot;;    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot; always;    #add_header Content-Security-Policy &quot;default-src &#39;self&#39;; script-src &#39;self&#39; https://ssl.google-analytics.com https://assets.zendesk.com https://connect.facebook.net; img-src &#39;self&#39; https://ssl.google-analytics.com https://s-static.ak.facebook.com https://assets.zendesk.com; style-src &#39;self&#39; https://fonts.googleapis.com https://assets.zendesk.com; font-src &#39;self&#39; https://themes.googleusercontent.com; frame-src https://assets.zendesk.com https://www.facebook.com https://s-static.ak.facebook.com https://tautt.zendesk.com; object-src &#39;none&#39;&quot;;    #add_header Feature-Policy &quot;geolocation none;midi none;notifications none;push none;sync-xhr none;microphone none;camera none;magnetometer none;gyroscope none;speaker self;vibrate none;fullscreen self;payment none;&quot;;    #if (\$http_user_agent ~* (wget|curl) ) { return 403; }    #if (\$http_user_agent = &quot;&quot;) { return 403; }    location / {        root /var/www/example;        index index.html;          }    location /v2ray {   #/ws为v2ray路径，随便填写比如/v2ray/，但要记住后面要用                if ($http_upgrade != &quot;websocket&quot;) {            return 301 https://www.12306.cn/index/;             }                proxy_redirect off;                proxy_pass http://127.0.0.1:8008; #你的v2ray入站端口，随意设置，要记住后面要用                proxy_http_version 1.1; #websocket还是http1.1的，但在服务器内部进行，几乎没有影响啦~                proxy_set_header Upgrade $http_upgrade;                proxy_set_header Connection &quot;upgrade&quot;;                proxy_set_header Host $http_host;              }    }    server {        listen 80;        listen [::]:80;        server_name xxxxxx;        return 301 https://xxxxxx;        }}</code></pre></div><div class="hljs"><pre><code class="hljs dts"><span class="hljs-meta">#测试并重启</span>nginx -t -c <span class="hljs-meta-keyword">/etc/</span>nginx/nginx.conf<span class="hljs-meta-keyword">/etc/</span>init.d/nginx restart</code></pre></div><h3 id="3，-更新-acme-sh"><a href="#3，-更新-acme-sh" class="headerlink" title="3， 更新 acme.sh"></a>3， 更新 acme.sh</h3><p>目前由于 acme 协议和 letsencrypt CA 都在频繁的更新, 因此 acme.sh 也经常更新以保持同步.</p><p>升级 acme.sh 到最新版 :</p><div class="hljs"><pre><code class="hljs ada">acme.sh <span class="hljs-comment">--upgrade</span></code></pre></div><p>如果你不想手动升级, 可以开启自动升级:</p><div class="hljs"><pre><code class="hljs brainfuck"><span class="hljs-comment">acme</span><span class="hljs-string">.</span><span class="hljs-comment">sh</span>  --<span class="hljs-comment">upgrade</span>  --<span class="hljs-comment">auto</span><span class="hljs-literal">-</span><span class="hljs-comment">upgrade</span></code></pre></div><p>之后, acme.sh 就会自动保持更新了.</p><p>你也可以随时关闭自动更新:</p><div class="hljs"><pre><code class="hljs angelscript">acme.sh --upgrade  --<span class="hljs-built_in">auto</span>-upgrade  <span class="hljs-number">0</span></code></pre></div><h3 id="4，安装原始版本shadowsocks-libev-最新版"><a href="#4，安装原始版本shadowsocks-libev-最新版" class="headerlink" title="4，安装原始版本shadowsocks-libev 最新版"></a>4，安装原始版本shadowsocks-libev 最新版</h3><h4 id="4-1采用官方推荐方法，较为繁琐"><a href="#4-1采用官方推荐方法，较为繁琐" class="headerlink" title="4.1采用官方推荐方法，较为繁琐"></a>4.1采用官方推荐方法，较为繁琐</h4><h5 id="安装-snap（一种沙盘包安装方式，不用编译）"><a href="#安装-snap（一种沙盘包安装方式，不用编译）" class="headerlink" title="安装 snap（一种沙盘包安装方式，不用编译）"></a>安装 snap（一种沙盘包安装方式，不用编译）</h5><div class="hljs"><pre><code class="hljs properties"><span class="hljs-attr">sudo</span> <span class="hljs-string">apt update</span><span class="hljs-attr">sudo</span> <span class="hljs-string">apt install snapd</span><span class="hljs-attr">sudo</span> <span class="hljs-string">snap install core</span></code></pre></div><h5 id="安装-ss-libev"><a href="#安装-ss-libev" class="headerlink" title="安装 ss-libev"></a>安装 ss-libev</h5><div class="hljs"><pre><code class="hljs cmake">sudo snap <span class="hljs-keyword">install</span> shadowsocks-libev</code></pre></div><h5 id="配置-ss-libev"><a href="#配置-ss-libev" class="headerlink" title="配置 ss-libev"></a>配置 ss-libev</h5><p>配置文件 config.json 放在 <strong>/snap/bin/</strong> 中</p><div class="hljs"><pre><code class="hljs arduino">nano /snap/bin/<span class="hljs-built_in">config</span>.json</code></pre></div><ul><li><p>配置文件</p><div class="hljs"><pre><code class="hljs llvm">&#123;  <span class="hljs-string">"server"</span>: <span class="hljs-string">"0.0.0.0"</span>,  <span class="hljs-string">"nameserver"</span>: <span class="hljs-string">"1.1.1.1"</span>,  <span class="hljs-string">"server_port"</span>: <span class="hljs-number">8008</span>,  <span class="hljs-string">"password"</span>: <span class="hljs-string">"xxxxx"</span>,  <span class="hljs-string">"method"</span>: <span class="hljs-string">"rc4-md5"</span>,  <span class="hljs-string">"no_delay"</span>: <span class="hljs-keyword">true</span>,  <span class="hljs-string">"fast_open"</span>: <span class="hljs-keyword">true</span>,  <span class="hljs-string">"reuse_port"</span>: <span class="hljs-keyword">true</span>,  <span class="hljs-string">"timeout"</span>: <span class="hljs-number">600</span>,  #公共代理，需要低一些  <span class="hljs-string">"mode"</span>: <span class="hljs-string">"tcp_and_udp"</span>,   #如果发现运营商，Qos 可以设置成tcp  <span class="hljs-string">"plugin"</span>:<span class="hljs-string">"/var/snap/shadowsocks-libev/common/v2ray-plugin"</span>,  <span class="hljs-string">"plugin_opts"</span>:<span class="hljs-string">"server;path=/v2ray;host=xxxxxx;loglevel=none"</span>&#125;#其他设置说明在https://wiki.archlinux.org/index.php/Shadowsocks_(<span class="hljs-symbol">%E7</span><span class="hljs-symbol">%AE</span><span class="hljs-symbol">%80</span><span class="hljs-symbol">%E4</span><span class="hljs-symbol">%BD</span><span class="hljs-symbol">%93</span><span class="hljs-symbol">%E4</span><span class="hljs-symbol">%B8</span><span class="hljs-symbol">%AD</span><span class="hljs-symbol">%E6</span><span class="hljs-symbol">%96</span><span class="hljs-symbol">%87</span>)</code></pre></div><div class="hljs"><pre><code class="hljs plain"> </code></pre></div><p>可以选择的加密方式: rc4-md5,</p><div class="hljs"><pre><code>                        aes-128-gcm, aes-192-gcm, aes-256-gcm,                        aes-128-cfb, aes-192-cfb, aes-256-cfb,                        aes-128-ctr, aes-192-ctr, aes-256-ctr,                        camellia-128-cfb, camellia-192-cfb,                        camellia-256-cfb, bf-cfb,                        chacha20-ietf-poly1305,                        xchacha20-ietf-poly1305,                        salsa20, chacha20 and chacha20-ietf.                        The default cipher is aes-256-gcm.</code></pre></div></li></ul><div class="hljs"><pre><code class="hljs markdown">    对于科学上网，TFO（fast_open）不建议开启（指的是客户端不开启，服务器端可以开启）。根据 [<span class="hljs-string">shadowsocks-libev</span>](<span class="hljs-link">https://github.com/shadowsocks/shadowsocks-libev/issues/1669</span>) 的反馈，TFO在中国移动数据网络下不能正常工作，而且长城防火墙会识别和丢弃TFO的包，开启TFO只会自找麻烦。<span class="hljs-section">#### 4.2安装 Golang最新版</span></code></pre></div><p>snap install go —classic<br><div class="hljs"><pre><code class="hljs dos">永久修改当前用户<span class="hljs-built_in">PATH</span></code></pre></div><br>nano ~/.bashrc</p><h1 id="最后一行添加以下命令"><a href="#最后一行添加以下命令" class="headerlink" title="最后一行添加以下命令"></a>最后一行添加以下命令</h1><p>export PATH=”$PATH:/snap/bin”<br><div class="hljs"><pre><code class="hljs autohotkey">关闭保存，执行以下命令生效：​```bashsource ~/.bashrc</code></pre></div></p><div class="hljs"><pre><code class="hljs applescript">go <span class="hljs-built_in">version</span> <span class="hljs-comment">#检查版本</span></code></pre></div><h4 id="4-3-编译安装最新v2ray-plugin"><a href="#4-3-编译安装最新v2ray-plugin" class="headerlink" title="4.3 编译安装最新v2ray-plugin"></a>4.3 编译安装最新v2ray-plugin</h4><div class="hljs"><pre><code class="hljs stata">git clone https:<span class="hljs-comment">//github.com/shadowsocks/v2ray-plugin.git</span><span class="hljs-keyword">cd</span> v2ray-<span class="hljs-keyword">plugin</span>go mod downloadgo buildcp v2ray-<span class="hljs-keyword">plugin</span> /<span class="hljs-keyword">var</span>/snap/shadowsocks-libev/common/v2ray-<span class="hljs-keyword">plugin</span>#snap包安装完成后，它的文件系统被划分为只读和可读写的两种不同权限的区域，一般情况下只读区域为/snap/xxxxx目录，可读写区域就是/<span class="hljs-keyword">var</span>/snap/xxxx/common/</code></pre></div><h4 id="4-4-验证配置全部正确"><a href="#4-4-验证配置全部正确" class="headerlink" title="4.4 验证配置全部正确"></a>4.4 验证配置全部正确</h4><div class="hljs"><pre><code class="hljs awk"><span class="hljs-regexp">/snap/</span>bin<span class="hljs-regexp">/shadowsocks-libev.ss-server -c /</span>snap<span class="hljs-regexp">/bin/</span>config.json <span class="hljs-comment">#没有tls命令，因为nginx已经使用tls，但客户端需要有tls，看后续步骤</span></code></pre></div><p>建立systemd 启动管理项目</p><div class="hljs"><pre><code class="hljs crystal">nano /<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">systemd</span>/<span class="hljs-title">system</span>/<span class="hljs-title">shadowsocks</span>-<span class="hljs-title">libev</span>.<span class="hljs-title">service</span></span></code></pre></div><div class="hljs"><pre><code class="hljs ini"><span class="hljs-comment">#填入以下内容保存</span><span class="hljs-section">[Unit]</span><span class="hljs-attr">Description</span>=shadowsocks-libev<span class="hljs-attr">After</span>=network.target<span class="hljs-section">[Service]</span><span class="hljs-attr">ExecStart</span>=/snap/bin/shadowsocks-libev.ss-server -c /snap/bin/config.json <span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-abort<span class="hljs-section">[Install]</span><span class="hljs-attr">WantedBy</span>=multi-user.target</code></pre></div><p>然后必须</p><div class="hljs"><pre><code class="hljs gradle">systemctl enable shadowsocks-libev.service#Systemd 默认从目录<span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>读取配置文件。但是，里面存放的大部分文件都是符号链接，指向目录<span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/systemd/</span>system<span class="hljs-regexp">/，真正的配置文件存放在那个目录。systemctl enable命令用于在上面两个目录之间，建立符号链接关系</span></code></pre></div><div class="hljs"><pre><code class="hljs css"><span class="hljs-selector-id">#systemctl</span> <span class="hljs-selector-tag">cat</span>命令可以查看配置文件的内容<span class="hljs-selector-tag">systemctl</span> <span class="hljs-selector-tag">cat</span> <span class="hljs-selector-tag">shadowsocks-libev</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-tag">systemctl</span> <span class="hljs-selector-tag">start</span> <span class="hljs-selector-tag">shadowsocks-libev</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-tag">systemctl</span> <span class="hljs-selector-tag">status</span> <span class="hljs-selector-tag">shadowsocks-libev</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-id">#status</span>必须显示<span class="hljs-selector-tag">active</span>，否则找错误<span class="hljs-selector-id">#systemctl</span> <span class="hljs-selector-tag">stop</span> <span class="hljs-selector-tag">shadowsocks-libev</span><span class="hljs-selector-class">.service</span></code></pre></div><p>如果修改了shadowsocks-libev.service，需要执行</p><div class="hljs"><pre><code class="hljs properties"><span class="hljs-comment"># 重新加载配置文件</span><span class="hljs-attr">systemctl</span> <span class="hljs-string">daemon-reload</span><span class="hljs-comment"># 重启相关服务</span><span class="hljs-attr">systemctl</span> <span class="hljs-string">restart shadowsocks-libev.service</span></code></pre></div><h3 id="5-替换锐速内核"><a href="#5-替换锐速内核" class="headerlink" title="5, 替换锐速内核"></a>5, 替换锐速内核</h3><div class="hljs"><pre><code class="hljs sas">推荐bbrplus旧版，卸载内核wget -N --no-<span class="hljs-meta">check</span>-certificate <span class="hljs-string">"https://raw.githubusercontent.com/ylx2016/Linux-NetSpeed/master/tcp.sh"</span> <span class="hljs-variable">&amp;&amp;</span> chmod +<span class="hljs-meta">x</span> tcp.sh <span class="hljs-variable">&amp;&amp;</span> ./tcp.sh</code></pre></div><p>需要重启一次，再进入脚本<code>./tcp.sh</code>开启锐速，然后选择加速核心和优化系统2个选项，再重启。</p><h3 id="6-保护shadowsocks，防止被嗅探（适合固定ip访问）"><a href="#6-保护shadowsocks，防止被嗅探（适合固定ip访问）" class="headerlink" title="6, 保护shadowsocks，防止被嗅探（适合固定ip访问）"></a>6, 保护shadowsocks，防止被嗅探（适合固定ip访问）</h3><p>设置理由：</p><p><a href="https://gfw.report/blog/gfw_shadowsocks/zh.html" target="_blank" rel="noopener">https://gfw.report/blog/gfw_shadowsocks/zh.html</a></p><p>具体操作方法你可以使用iptables命令：</p><p>禁止所有人访问你的ss 443端口</p><div class="hljs"><pre><code class="hljs brainfuck"><span class="hljs-comment">iptables</span> --<span class="hljs-comment">append</span> <span class="hljs-comment">INPUT</span> --<span class="hljs-comment">protocol</span> <span class="hljs-comment">tcp</span> --<span class="hljs-comment">dport</span> <span class="hljs-comment">443</span> --<span class="hljs-comment">jump</span> <span class="hljs-comment">DROP</span></code></pre></div><p>这条命令的意思是仅允许1.1.1.1访问你ss 443端口</p><div class="hljs"><pre><code class="hljs dsconfig"><span class="hljs-string">iptables </span><span class="hljs-built_in">--append</span> <span class="hljs-string">INPUT </span><span class="hljs-built_in">--protocol</span> <span class="hljs-string">tcp </span><span class="hljs-built_in">--src</span> 1.1.1.1 <span class="hljs-built_in">--dport</span> <span class="hljs-string">443 </span><span class="hljs-built_in">--jump</span> <span class="hljs-string">ACCEPT</span><span class="hljs-string"></span><span class="hljs-string">#</span>或者选择<span class="hljs-string">ip段</span>，<span class="hljs-string">http:</span>//<span class="hljs-string">ip.</span><span class="hljs-string">bczs.</span><span class="hljs-string">net/</span>和<span class="hljs-string">http:</span>//<span class="hljs-string">apps.</span><span class="hljs-string">neu.</span><span class="hljs-string">edu.</span><span class="hljs-string">cn/</span><span class="hljs-string">netaggr/</span><span class="hljs-string">iptables </span><span class="hljs-built_in">--append</span> <span class="hljs-string">INPUT </span><span class="hljs-built_in">--protocol</span> <span class="hljs-string">tcp </span><span class="hljs-built_in">--src</span> 0.0.0.0/<span class="hljs-string">10 </span><span class="hljs-built_in">--dport</span> <span class="hljs-string">443 </span><span class="hljs-built_in">--jump</span> <span class="hljs-string">ACCEPT</span></code></pre></div><p>查看iptables规则<br>命令后面的line-number为显示行号（将规则一则一则输出，并显示行号），可选，方便后文的删除指令。</p><div class="hljs"><pre><code class="hljs ada">iptables -L -n <span class="hljs-comment">--line-numbers</span></code></pre></div><p>清除已有iptables规则</p><div class="hljs"><pre><code class="hljs ebnf"><span class="hljs-attribute">iptables -F</span></code></pre></div><h3 id="7，-客户端使用"><a href="#7，-客户端使用" class="headerlink" title="7， 客户端使用"></a>7， 客户端使用</h3><p>客户端要选择tls，但不需要加载证书，因为nginx已经使用tls协议，注意Path 填写/v2ray，下边为例子。</p><p>由于最常用的还是Android, 所以简单介绍一下, 从google play商店下载 SS, v2ray-plugin(这个是插件, 安装后无图标)<br>SS的配置和以前一样, 只是多一个插件,<br>SS配置, 服务器, 远程端口:443(使用websocket+tls), 加密方式, 及以密码<br>在插件部分选择v2ray, 点击配置进行修改, 运输方式: websocket-tls, Hostname: yourhost, Path: nginx转发路径(/sspath)</p><p>举例截图:<br><img src="https://i.loli.net/2019/08/19/GAyr9iWRLwQtTdJ.jpg" srcset="/img/loading.gif" alt="https://i.loli.net/2019/08/19/GAyr9iWRLwQtTdJ.jpg"> <img src="https://i.loli.net/2019/08/19/rFD6f8GuaHQwX1V.jpg" srcset="/img/loading.gif" alt="https://i.loli.net/2019/08/19/rFD6f8GuaHQwX1V.jpg"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>udp2raw 命令行</title>
    <link href="/posts/77b962c.html"/>
    <url>/posts/77b962c.html</url>
    
    <content type="html"><![CDATA[<div class="hljs"><pre><code class="hljs angelscript">./udp2raw_amd64 -s -l0<span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8220</span> -r <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">29900</span> -k <span class="hljs-string">"passwd"</span> --raw-mode faketcp --cipher-mode none --auth-mode none -a./udp2raw_mips24kc_be -c -l0<span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">29900</span> -r <span class="hljs-number">45.118</span><span class="hljs-number">.133</span><span class="hljs-number">.155</span>:<span class="hljs-number">8220</span> -k <span class="hljs-string">"passwd"</span> --raw-mode faketcp --cipher-mode <span class="hljs-keyword">xor</span> --auth-mode none -g./usr/bin/udp2raw_mips24kc_be -c -l0<span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">29900</span> -r <span class="hljs-number">45.118</span><span class="hljs-number">.133</span><span class="hljs-number">.155</span>:<span class="hljs-number">8220</span> -k <span class="hljs-string">"passwd"</span> --raw-mode faketcp --cipher-mode none --auth-mode none &amp;</code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Termux 使用教程</title>
    <link href="/posts/3909ede9.html"/>
    <url>/posts/3909ede9.html</url>
    
    <content type="html"><![CDATA[<h1 id="Termux-使用教程"><a href="#Termux-使用教程" class="headerlink" title="Termux 使用教程"></a>Termux 使用教程</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><a href="https://p3terx.com/go/aHR0cHM6Ly90ZXJtdXguY29tLw==" target="_blank" rel="noopener">Termux</a> 是一个 An­droid 下的终端模拟器，可以在手机上模拟 Linux 环境。它是一个手机 App，可以从应用商店直接下载安装，打开就能使用，它提供一个命令行界面，让用户与系统交互。它支持 apt 软件包管理，可以十分方便安装软件包，而且完美支持 Python 、 PHP 、 Ruby 、 Go 、 Nodejs 、 MySQL 等工具。随着智能设备的普及和性能的不断提升，如今手机、平板等设备的硬件标准已经直逼入门级桌面计算机，使用 Ter­mux 完全可以把手机变成一个强大的小型服务器。你甚至可以使用 Ter­mux 通过 Nmap、Sqlmap、BB­Scan、sub­Do­mains­Brute、Hy­dra、Router­Sploit 等工具实现端口扫描、注入检测、子域名爆破、多协议弱口令爆破、路由器漏洞检测框架多种功能，把手机打造成一个随身携带的渗透神器，成为现实版的艾登・皮尔斯。</p><h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><p>官方推荐从 <a href="https://p3terx.com/go/aHR0cHM6Ly9mLWRyb2lkLm9yZy9yZXBvc2l0b3J5L2Jyb3dzZS8|ZmRpZD1jb20udGVybXV4" target="_blank" rel="noopener">F-Droid</a> 和 <a href="https://p3terx.com/go/aHR0cHM6Ly9wbGF5Lmdvb2dsZS5jb20vc3RvcmUvYXBwcy9kZXRhaWxzP2lkPWNvbS50ZXJtdXg=" target="_blank" rel="noopener">Google Play</a> 这两个平台下载，安装完打开就是下面这个样子。</p><p><a href="https://p3terximg.gitee.io/post/20190919225945.jpg#vwid=1080&amp;vhei=1857" target="_blank" rel="noopener"><img src="https://p3terximg.gitee.io/post/20190919225945.jpg#vwid=1080&amp;vhei=1857" srcset="/img/loading.gif" alt="img"></a></p><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>俗话说” 会跑之前，要先学会走 “，先了解基本操作，以后搞一些骚操作就轻而易举了。</p><h3 id="选项和菜单"><a href="#选项和菜单" class="headerlink" title="选项和菜单"></a>选项和菜单</h3><p>长按屏幕会出现可选择的复制光标，同时会显示 <code>Copy</code>（复制）、<code>Paste</code>（粘贴）、<code>More...</code>（更多）这几个选项。</p><p><a href="https://p3terximg.gitee.io/post/20190920185125.jpg#vwid=673&amp;vhei=367" target="_blank" rel="noopener"><img src="https://p3terximg.gitee.io/post/20190920185125.jpg#vwid=673&amp;vhei=367" srcset="/img/loading.gif" alt="img"></a></p><p>点击 <code>More...</code> 进入到下一级菜单。</p><p><a href="https://p3terximg.gitee.io/post/20190922142041.jpg#vwid=1080&amp;vhei=1860" target="_blank" rel="noopener"><img src="https://p3terximg.gitee.io/post/20190922142041.jpg#vwid=1080&amp;vhei=1860" srcset="/img/loading.gif" alt="img"></a></p><div class="hljs"><pre><code class="hljs none">长按屏幕├── COPY: 复制├── PASTE: 粘贴├── More: 更多   ├── Select URL: 选择 URL   └── Share transcipt: 传输当前会话的所有输出(通过Android api)   └── Reset: 重置   └── Kill process: 杀掉当前终端会话进程   └── Style: 风格配色（需安装 Termux:Styling 插件）   └── Keep screen on: 保持屏幕开启   └── Help: 帮助文档(Termux Wiki)</code></pre></div><p>从左侧屏幕边缘向右滑动可以拖出导航栏，在这里可以新建、切换、重命名会话 (ses­sion) 和调出输入法。</p><p><a href="https://p3terximg.gitee.io/post/20190920192124.jpg#vwid=1080&amp;vhei=1851" target="_blank" rel="noopener"><img src="https://p3terximg.gitee.io/post/20190920192124.jpg#vwid=1080&amp;vhei=1851" srcset="/img/loading.gif" alt="img"></a></p><h3 id="常用快捷键"><a href="#常用快捷键" class="headerlink" title="常用快捷键"></a>常用快捷键</h3><p>在使用终端时，需要使用到 <code>Alt</code>、<code>Ctrl</code>、<code>Esc</code> 等键，但手机上并没有这些键。</p><p>Ter­mux 中可以使用<code>音量减</code>按钮来模拟 <code>Ctrl</code> 键。例如，<code>音量减</code> +<code>L</code> 相当于在键盘上按下 <code>Ctrl</code>+<code>L</code>。</p><p>以下是一些在终端中常用的快捷键，同样适用于 Ter­mux 中。</p><ul><li><strong><code>Ctrl</code>+<code>A</code></strong> -&gt; 光标移动到开始位置</li><li><strong><code>Ctrl</code>+<code>E</code></strong> -&gt; 光标移动到最末尾</li><li><strong><code>Ctrl</code>+<code>K</code></strong> -&gt; 剪切此处至末尾的所有内容</li><li><strong><code>Ctrl</code>+<code>U</code></strong> -&gt; 剪切此处至开始的所有内容</li><li><strong><code>Ctrl</code>+<code>W</code></strong> -&gt; 剪切此处到左边的单词</li><li><strong><code>Ctrl</code>+<code>Y</code></strong> -&gt; 粘贴由<code>Ctrl + U</code>、<code>Ctrl + D</code>、<code>Ctrl + W</code>剪切的单词</li><li><strong><code>Ctrl</code>+<code>L</code></strong> -&gt; 相当于<code>clear</code>命令，清屏</li><li><strong><code>Ctrl</code>+<code>C</code></strong> -&gt; 终止进程/命令</li><li><strong><code>Ctrl</code>+<code>D</code></strong> -&gt; 关闭终端</li><li><strong><code>Ctrl</code>+<code>Z</code></strong> -&gt; 挂起（发送 SIGTSTP 到）当前进程</li></ul><p><code>音量加</code>按钮可以作为产生特定输入的特殊键，可以粗略的理解为笔记本电脑上的 <code>Fn</code> 键。</p><ul><li><strong><code>音量加</code>+<code>E</code></strong> -&gt; <code>Esc</code>键</li><li><strong><code>音量加</code>+<code>T</code></strong> -&gt; <code>Tab</code>键</li><li><strong><code>音量加</code>+<code>1</code></strong> -&gt; <code>F1</code>键（<code>音量增加 + 2</code>相当于<code>F2</code>，以此类推）</li><li><strong><code>音量加</code>+<code>0</code></strong> -&gt; <code>F10</code>键</li><li><strong><code>音量加</code>+<code>B</code></strong> -&gt; <code>Alt</code>+<code>B</code>，使用readline时返回一个单词</li><li><strong><code>音量加</code>+<code>F</code></strong> -&gt; <code>Alt</code>+<code>F</code>，使用readline时转发一个单词</li><li><strong><code>音量加</code>+<code>X</code></strong> -&gt; <code>Alt</code>+<code>X</code></li><li><strong><code>音量加</code>+<code>W</code></strong> -&gt; 向上箭头键</li><li><strong><code>音量加</code>+<code>A</code></strong> -&gt; 向左箭头键</li><li><strong><code>音量加</code>+<code>S</code></strong> -&gt; 向下箭头键</li><li><strong><code>音量加</code>+<code>D</code></strong> -&gt; 向右箭头键</li><li><strong><code>音量加</code>+<code>L</code></strong> -&gt; <code>|</code>（管道字符）</li><li><strong><code>音量加</code>+<code>H</code></strong> -&gt; <code>〜</code>（波浪号字符）</li><li><strong><code>音量加</code>+<code>U</code></strong> -&gt; <code>_</code>(下划线字符)</li><li><strong><code>音量加</code>+<code>P</code></strong> -&gt; <code>Page Up</code>键（上一页）</li><li><strong><code>音量加</code>+<code>N</code></strong> -&gt; <code>Page Down</code>键（下一页）</li><li><strong><code>音量加</code>+<code>.</code></strong> -&gt; <code>Ctrl</code>+<code>\</code>（SIGQUIT）</li><li><strong><code>音量加</code>+<code>V</code></strong> -&gt; 显示音量控制</li><li><strong><code>音量加</code>+<code>Q</code></strong> -&gt; 显示额外的按键视图</li><li><strong><code>音量加</code>+<code>K</code></strong> -&gt; 同上</li></ul><h3 id="扩展功能按键"><a href="#扩展功能按键" class="headerlink" title="扩展功能按键"></a>扩展功能按键</h3><p>前面提到 Ter­mux 可以使用音量键来实现快捷键操作，个人感觉使用音量键不是很不方便。Ter­mux 还提供屏幕扩展功能按键。可以使用<code>音量加</code> +<code>Q</code> 或者<code>音量加</code> +<code>K</code> 可以显示和隐藏。</p><p><a href="https://p3terximg.gitee.io/post/20190919214058.jpg#vwid=1080&amp;vhei=108" target="_blank" rel="noopener"><img src="https://p3terximg.gitee.io/post/20190919214058.jpg#vwid=1080&amp;vhei=108" srcset="/img/loading.gif" alt="img"></a></p><p>此外，功能按键向左滑动可以调出文本输入框，可以更方便的粘贴和对待输入的指令进行更精细的修改。</p><p><a href="https://p3terximg.gitee.io/post/20190920193543.jpg#vwid=1080&amp;vhei=1039" target="_blank" rel="noopener"><img src="https://p3terximg.gitee.io/post/20190920193543.jpg#vwid=1080&amp;vhei=1039" srcset="/img/loading.gif" alt="img"></a></p><h3 id="软件包管理"><a href="#软件包管理" class="headerlink" title="软件包管理"></a>软件包管理</h3><p>Ter­mux 除了支持 <code>apt</code> 命令外，还在此基础上封装了 <code>pkg</code> 命令，<code>pkg</code> 命令向下兼容 <code>apt</code> 命令。官方建议使用 <code>pkg</code> 命令，因为它会在安装或升级包时会自动更新 apt 列表，也就是说执行 <code>pkg upgrade</code> 相当于执行了 <code>apt update &amp;&amp; apt upgrade</code>，简化了操作流程。</p><div class="table-container"><table><thead><tr><th style="text-align:left">命令</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left">pkg search</td><td style="text-align:left">搜索包</td></tr><tr><td style="text-align:left">pkg install</td><td style="text-align:left">安装包，简写<code>pkg i</code></td></tr><tr><td style="text-align:left">pkg uninstall</td><td style="text-align:left">卸载包</td></tr><tr><td style="text-align:left">pkg reinstall</td><td style="text-align:left">重新安装包</td></tr><tr><td style="text-align:left">pkg update / pkg upgrade</td><td style="text-align:left">升级软件包，简写<code>pkg up</code></td></tr><tr><td style="text-align:left">pkg list-all</td><td style="text-align:left">列出可供安装的所有包</td></tr><tr><td style="text-align:left">pkg list-installed</td><td style="text-align:left">列出已经安装的包</td></tr><tr><td style="text-align:left">pkg shoe</td><td style="text-align:left">显示某个包的详细信息</td></tr><tr><td style="text-align:left">pkg files</td><td style="text-align:left">显示某个包的相关文件夹路径</td></tr></tbody></table></div><h2 id="Termux-与标准-Linux-目录结构的区别"><a href="#Termux-与标准-Linux-目录结构的区别" class="headerlink" title="Termux 与标准 Linux 目录结构的区别"></a>Termux 与标准 Linux 目录结构的区别</h2><p>与大多数 Linux 发行版不同，Ter­mux 不遵循<a href="https://p3terx.com/go/aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlsZXN5c3RlbV9IaWVyYXJjaHlfU3RhbmRhcmQ=" target="_blank" rel="noopener">文件系统层次结构标准</a>，你无法在标准路径找到 <code>/bin</code>、<code>/etc</code>、<code>/usr</code>、<code>/tmp</code> 等目录。为了方便，<code>Termux</code> 提供了一个特殊的环境变量：<code>PREFIX</code>，它相当于 <code>/usr</code> 目录。</p><div class="hljs"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree -d -L 1 <span class="hljs-variable">$PREFIX</span></span>/data/data/com.termux/files/usr├── bin├── etc├── include├── lib├── libexec├── share├── src├── tmp└── var</code></pre></div><p>此外用户主目录也在非常规位置。</p><div class="hljs"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$HOME</span></span>/data/data/com.termux/files/home</code></pre></div><p>由于没有 root 权限，想对根目录进行操作是不可能的。</p><div class="hljs"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ls /</span>ls: cannot open directory '/': Permission denied</code></pre></div><p>对此可以安装 <code>proot</code>，并使用 <code>termux-chroot</code> 命令可以模拟 root 环境与标准的 Linux 目录结构。</p><div class="hljs"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> pkg i -y proot</span><span class="hljs-meta">$</span><span class="bash"> termux-chroot</span><span class="hljs-meta">$</span><span class="bash"> ls /</span>bin  data  dev  etc  home  lib  proc  root  sbin  share  storage  system  tmp  usr  var  vendor<span class="hljs-meta">$</span><span class="bash"> ls /usr</span>bin  etc  include  lib  libexec  share  src  tmp  var</code></pre></div><p>这对某些必须要用到标准路径的一些程序会非常有用。</p><h2 id="root-权限"><a href="#root-权限" class="headerlink" title="root 权限"></a>root 权限</h2><p>前面提到的 <code>proot</code> 毕竟是模拟的方式，会有一定的局限性。如果手机已经 root ，在 Ter­mux 中使用 <code>su</code> 虽然可以切换为 root 用户，但是会有一些 Ter­mux 的命令无法正常使用，毕竟这不是一个标准的 Linux 环境。解决方案是安装 <code>tsu</code> 来获取 root 权限，<code>tsu</code> 是 Ter­mux 中的 <code>su</code> 替代方案。</p><p>安装 <code>tsu</code>：</p><div class="hljs"><pre><code class="hljs shell">pkg i -y tsu</code></pre></div><p>使用 root 权限执行命令：</p><div class="hljs"><pre><code class="hljs shell">tsudo command</code></pre></div><p>切换到 root 用户：</p><div class="hljs"><pre><code class="hljs shell">tsu</code></pre></div><p>在 root 用户下，输入 <code>exit</code> 命令或者按 <code>Ctrl</code>+<code>D</code> 可以回到普通用户。</p><h2 id="访问外部存储"><a href="#访问外部存储" class="headerlink" title="访问外部存储"></a>访问外部存储</h2><p>Ter­mux 默认只能访问自身内部的数据，如果要访问手机中其它的数据，输入下面的命令后，手机弹出对请求权限的窗口，允许即可。</p><div class="hljs"><pre><code class="hljs shell">termux-setup-storage</code></pre></div><p>这个操作将创建 <code>$HOME/storage</code> 目录，此目录中的子目录将通过符号链接到手机存储中的一些常用目录。</p><div class="hljs"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree storage</span>storage├── dcim -&gt; /storage/emulated/0/DCIM├── downloads -&gt; /storage/emulated/0/Download├── movies -&gt; /storage/emulated/0/Movies├── music -&gt; /storage/emulated/0/Music├── pictures -&gt; /storage/emulated/0/Pictures└── shared -&gt; /storage/emulated/0</code></pre></div><p>此外还可以通过 <code>/sdcard</code> 来访问外部存储的根目录。</p><h2 id="SSH-连接"><a href="#SSH-连接" class="headerlink" title="SSH 连接"></a>SSH 连接</h2><p>作为 Linux 终端或者服务器，SSH 都是必须的。不管你是 SSH 连接到 Ter­mux ，还是使用 Ter­mux 去连其它主机，都需要先安装 <code>openssh</code>。</p><div class="hljs"><pre><code class="hljs shell">pkg i -y openssh</code></pre></div><h3 id="Termux-使用-SSH-连接其它主机"><a href="#Termux-使用-SSH-连接其它主机" class="headerlink" title="Termux 使用 SSH 连接其它主机"></a>Termux 使用 SSH 连接其它主机</h3><p>基本操作，ssh 命令：</p><div class="hljs"><pre><code class="hljs shell">ssh User@Host -p Port</code></pre></div><h3 id="SSH-连接到-Termux"><a href="#SSH-连接到-Termux" class="headerlink" title="SSH 连接到 Termux"></a>SSH 连接到 Termux</h3><p>手机操作起来毕竟束缚太多，在电脑上通过 SSH 连接再进行操作是一件非常优雅的事情。</p><ul><li><p>设置密码：</p><div class="hljs"><pre><code class="hljs shell">passwd</code></pre></div></li><li><p>查看用户名：</p><div class="hljs"><pre><code class="hljs shell">whoami</code></pre></div><blockquote><p>由于 Ter­mux 是单用户环境，所以这个步骤不是必须的。使用任何用户名都可以进行登录。</p></blockquote></li><li><p>查看 IP 地址：</p><div class="hljs"><pre><code class="hljs shell">ifconfig</code></pre></div></li><li><p>启动 SSH 服务端：</p><div class="hljs"><pre><code class="hljs shell">sshd</code></pre></div><blockquote><p>SSH 服务端程序默认是不启动的，且每次应用关闭再打开也需要再次启动。后面会讲如何自启 SSH 服务端。</p></blockquote></li></ul><p>集齐 SSH 三要素，现在可以在电脑终端中输入 <code>ssh</code> 命令或者使用其它 SSH 客户端进行连接了。需要注意的是 Ter­mux 的 SSH 端口是 <code>8022</code>。</p><div class="hljs"><pre><code class="hljs shell">ssh User@Host -p 8022</code></pre></div><p>执行 <code>ssh</code> 命令后，输入密码就可以连上了，然后就可以在电脑上方便的进行各种骚操作了。</p><p><a href="https://p3terximg.gitee.io/post/20190921141822.png#vwid=1100&amp;vhei=739" target="_blank" rel="noopener"><img src="https://p3terximg.gitee.io/post/20190921141822.png#vwid=1100&amp;vhei=739" srcset="/img/loading.gif" alt="img"></a></p><h3 id="配置-SSH-密钥登录"><a href="#配置-SSH-密钥登录" class="headerlink" title="配置 SSH 密钥登录"></a>配置 SSH 密钥登录</h3><p>如果需要将 Ter­mux 的 SSH 端口暴露在公网，为了安全建议配置密钥登录。</p><p>操作和一般的 Linux 发行版没有区别，属于基本操作。如果你不知道如何配置可以去看《<a href="https://p3terx.com/archives/configuring-ssh-keys-with-sshkeygen-and-sshcopyid.html" target="_blank" rel="noopener">使用 ssh-keygen 和 ssh-copy-id 配置 SSH 密钥实现免密登陆</a>》和《<a href="https://p3terx.com/archives/configuring-ssh-key-with-xshell.html" target="_blank" rel="noopener">使用 Xshell 给 Linux VPS 配置 SSH 密钥实现免密登录</a>》这两篇教程补补课，这里不再赘述。</p><blockquote><p><strong>友情提示：</strong><code>sshd_config</code>文件的路径是<code>$PREFIX/etc/ssh/sshd_config</code></p></blockquote><p>推荐使用 <a href="https://p3terx.com/archives/ssh-key-installer.html" target="_blank" rel="noopener">SSH 密钥一键配置脚本</a>，它可以从 GitHub 或者链接中获取公钥并自动配置。只要你在 GitHub 上设置过公钥，配置后就直接可以使用连接 GitHub 仓库的 SSH 密钥进行登录。</p><h3 id="SSH-服务端-sshd-自启"><a href="#SSH-服务端-sshd-自启" class="headerlink" title="SSH 服务端(sshd)自启"></a>SSH 服务端(sshd)自启</h3><p>如果不想每次 ssh 连接 Ter­mux 前去输入 <code>sshd</code> 命令可以设置自启。sshd 自启分两种情况，一种是打开 Ter­mux 应用时自启，还有一种是手机开机后自启。</p><h4 id="打开应用时自启-SSH-服务端"><a href="#打开应用时自启-SSH-服务端" class="headerlink" title="打开应用时自启 SSH 服务端"></a>打开应用时自启 SSH 服务端</h4><p>把 <code>sshd</code> 命令添加到 Shell 配置文件中即可，比如我使用的是 zsh ，那么就添加到 <code>~/.zshrc</code> 中。如果是 bash ，那么就添加到 <code>~/.bashrc</code>。</p><div class="hljs"><pre><code class="hljs shell">echo "sshd" &gt;&gt; ~/.zshrc</code></pre></div><h4 id="手机开机后自启-SSH-服务端"><a href="#手机开机后自启-SSH-服务端" class="headerlink" title="手机开机后自启 SSH 服务端"></a>手机开机后自启 SSH 服务端</h4><p>首先安装 <a href="https://p3terx.com/go/aHR0cHM6Ly93aWtpLnRlcm11eC5jb20vd2lraS9UZXJtdXg6Qm9vdA==" target="_blank" rel="noopener">Termux:Boot</a> 插件，安装后给予该插件开机启动的权限，这样 Ter­mux 就可以在开机后自启了。</p><p>创建 <code>~/.termux/boot/</code> 目录（这个目录中放置的脚本会在开机启动 Ter­mux 后执行）。</p><div class="hljs"><pre><code class="hljs shell">mkdir -p ~/.termux/boot/</code></pre></div><p>在该目录中新建一个脚本，命名为 <code>start-sshd</code>，把 <code>sshd</code> 命令添加到这个文件中即可。</p><div class="hljs"><pre><code class="hljs shell">echo 'termux-wake-lock; sshd' &gt; ~/.termux/boot/start-sshd</code></pre></div><blockquote><p><code>termux-wake-lock</code>命令可防止手机休眠导致 Ter­mux 应用的进程被冻结。</p></blockquote><p>设置完成后，手机开机会自动启动 Ter­mux ，并开启 SSH 服务端。</p><h1 id="ermux优化"><a href="#ermux优化" class="headerlink" title="ermux优化"></a>ermux优化</h1><h2 id="终端配色"><a href="#终端配色" class="headerlink" title="终端配色"></a>终端配色</h2><p>主要使用了<code>zsh</code>来替代<code>bash</code>作为默认<code>shell</code>.<br>使用一键安装脚本来安装,一步到位,顺便启动了外置存储,可以直接访问SD卡下的目录.</p><blockquote><p>执行下面这个命令确保已经安装好了curl</p></blockquote><p>Bash</p><div class="hljs"><pre><code class="hljs bash">sh -c <span class="hljs-string">"<span class="hljs-variable">$(curl -fsSL https://github.com/Cabbagec/termux-ohmyzsh/raw/master/install.sh)</span>"</span></code></pre></div><p><img src="https://image.3001.net/images/20180501/15251492617193.png" srcset="/img/loading.gif" alt="img"></p><p>Android6.0以上会弹框确认是否授权,<code>允许</code>授权后<code>Termux</code>可以方便的访问SD卡文件.<br>脚本允许后先后有如下两个选项:</p><div class="hljs"><pre><code class="hljs livecodeserver">Enter <span class="hljs-keyword">a</span> <span class="hljs-built_in">number</span>, leave blank <span class="hljs-built_in">to</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">to</span> change: <span class="hljs-number">14</span>Enter <span class="hljs-keyword">a</span> <span class="hljs-built_in">number</span>, leave blank <span class="hljs-built_in">to</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">to</span> change: <span class="hljs-number">6</span></code></pre></div><p>分别选择<code>背景色</code>和<code>字体</code><br>想要继续更改挑选配色的话,继续运行脚本来再次筛选:</p><p>Bash</p><div class="hljs"><pre><code class="hljs bash">$ ~/termux-ohmyzsh/install.sh</code></pre></div><p><code>exit</code>重启<code>sessions</code>会话生效配置</p><h2 id="访问外置存储优化"><a href="#访问外置存储优化" class="headerlink" title="访问外置存储优化"></a>访问外置存储优化</h2><p>执行过上面的<code>zsh</code>一键配置脚本后,并且授予文件访问权限的话,会在家目录生成<code>storage</code>目录，并且生成若干目录，软连接都指向外置存储卡的相应目录</p><p><img src="https://image.3001.net/images/20180501/15251507436942.png" srcset="/img/loading.gif" alt="img"></p><p><strong>创建QQ文件夹软连接</strong></p><p>手机上一般经常使用手机QQ来接收文件,这里为了方便文件传输,直接在<code>storage</code>目录下创建软链接.<br><strong>QQ</strong></p><p>Bash</p><div class="hljs"><pre><code class="hljs bash">ln -s /data/data/com.termux/files/home/storage/shared/tencent/QQfile_recv QQ</code></pre></div><p><strong>TIM</strong></p><p>Bash</p><div class="hljs"><pre><code class="hljs bash">ln -s /data/data/com.termux/files/home/storage/shared/tencent/TIMfile_recv TIM</code></pre></div><p>最后效果图如下:</p><p><img src="https://image.3001.net/images/20180501/15251516872451.png" srcset="/img/loading.gif" alt="img"></p><p>这样可以直接在<code>home</code>目录下去访问QQ文件夹,非常方便文件的传输,大大提升了工作效率.</p><h2 id="oh-my-zsh主题配色"><a href="#oh-my-zsh主题配色" class="headerlink" title="oh my zsh主题配色"></a>oh my zsh主题配色</h2><p>编辑<code>.zshrc</code>配置文件</p><p>Bash</p><div class="hljs"><pre><code class="hljs bash">$ vim .zshrc</code></pre></div><p>第一行可以看到,默认的主题是<code>agnoster</code>主题:</p><p><img src="https://image.3001.net/images/20180501/15251531807018.png" srcset="/img/loading.gif" alt="img"></p><p>在<code>.oh-my-zsh/themes</code>目录下放着<code>oh-my-zsh</code>所有的主题配置文件.<br>下面是国光认为还不错的几款主题</p><p><strong>agnoster</strong></p><p><img src="https://image.3001.net/images/20180501/15251534292438.png" srcset="/img/loading.gif" alt="img"></p><p><strong>robbyrussell</strong></p><p><img src="https://image.3001.net/images/20180501/15251540733399.png" srcset="/img/loading.gif" alt="img"></p><p><strong>jaischeema</strong></p><p><img src="https://image.3001.net/images/20180501/15251541015433.png" srcset="/img/loading.gif" alt="img"></p><p><strong>re5et</strong></p><p><img src="https://image.3001.net/images/20180501/15251541397.png" srcset="/img/loading.gif" alt="img"></p><p><strong>junkfood</strong></p><p><img src="https://image.3001.net/images/20180501/15251541908342.png" srcset="/img/loading.gif" alt="img"></p><p><strong>cloud</strong></p><p><img src="https://image.3001.net/images/20180501/15251542579462.png" srcset="/img/loading.gif" alt="img"></p><p><strong>random</strong></p><p>当然如果你是个变态的话,可以尝试<code>random</code>主题,每打开一个会话配色主题都是随机的.</p><h2 id="安装常用工具"><a href="#安装常用工具" class="headerlink" title="安装常用工具"></a>安装常用工具</h2><p>安装一些基本的常用工具，方便后续的折腾。</p><div class="hljs"><pre><code class="hljs shell">pkg i -y git curl wget tree vim nano tmux htop</code></pre></div><h2 id="安装和配置-Oh-My-Zsh"><a href="#安装和配置-Oh-My-Zsh" class="headerlink" title="安装和配置 Oh My Zsh"></a>安装和配置 Oh My Zsh</h2><blockquote><p><strong>Oh My Zsh will not make you a 10x developer…but you may feel like one.</strong></p></blockquote><p>上面那句话来自 <a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL3JvYmJ5cnVzc2VsbC9vaC1teS16c2gvYmxvYi9tYXN0ZXIvUkVBRE1FLm1k" target="_blank" rel="noopener">Oh My Zsh README</a>，意思是 “装逼是第一生产力”。(大雾</p><p>我使用 Oh My Zsh 倒不是为把终端搞得花里胡哨去装逼，作为一个实用主义者，我非常喜欢自动建议、补全和代码高亮功能，这极大的提高了终端的输入效率。所以不管什么平台，都会安装 Oh My Zsh 。</p><h3 id="安装-zsh"><a href="#安装-zsh" class="headerlink" title="安装 zsh"></a>安装 zsh</h3><div class="hljs"><pre><code class="hljs shell">pkg i -y zsh</code></pre></div><h3 id="安装-Oh-My-Zsh"><a href="#安装-Oh-My-Zsh" class="headerlink" title="安装 Oh My Zsh"></a>安装 Oh My Zsh</h3><p>使用 curl 下载安装</p><div class="hljs"><pre><code class="hljs shell">sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</code></pre></div><p>使用 wget 下载安装</p><div class="hljs"><pre><code class="hljs shell">sh -c "$(wget -O- https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</code></pre></div><p>Oh My Zsh 安装完成后会提示你设置 zsh 为默认 sehll 。如果没有提示，输入下面的命令进行设置：</p><div class="hljs"><pre><code class="hljs shell">chsh -s zsh</code></pre></div><h3 id="修改-Oh-My-Zsh-主题"><a href="#修改-Oh-My-Zsh-主题" class="headerlink" title="修改 Oh My Zsh 主题"></a>修改 Oh My Zsh 主题</h3><p>Oh My Zsh 有很多<a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL3JvYmJ5cnVzc2VsbC9vaC1teS16c2gvd2lraS90aGVtZXM=" target="_blank" rel="noopener">内置主题</a>，只需要修改配置文件即可启用。也可以选择安装<a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL3JvYmJ5cnVzc2VsbC9vaC1teS16c2gvd2lraS9FeHRlcm5hbC10aGVtZXM=" target="_blank" rel="noopener">外置主题</a>，比如 <a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL3JvbWthdHYvcG93ZXJsZXZlbDEwaw==" target="_blank" rel="noopener">Powerlevel10k</a> 。</p><p>我使用的主题是 <a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL3JvYmJ5cnVzc2VsbC9vaC1teS16c2gvd2lraS90aGVtZXMjeXM=" target="_blank" rel="noopener">ys</a>，简单实用，不花里胡哨。使用 <code>sed</code> 命令一键修改：</p><div class="hljs"><pre><code class="hljs shell">sed -i '/^ZSH_THEME=/c\ZSH_THEME="ys"' ~/.zshrc</code></pre></div><p>修改后输入下面的命令刷新配置就可以看到效果：</p><div class="hljs"><pre><code class="hljs shell">source ~/.zshrc</code></pre></div><h3 id="安装-Oh-My-Zsh-插件"><a href="#安装-Oh-My-Zsh-插件" class="headerlink" title="安装 Oh My Zsh 插件"></a>安装 Oh My Zsh 插件</h3><p>安装 <a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL3pzaC11c2Vycy96c2gtc3ludGF4LWhpZ2hsaWdodGluZw==" target="_blank" rel="noopener">zsh-syntax-highlighting</a>（代码高亮）</p><div class="hljs"><pre><code class="hljs shell">git clone https://github.com/zsh-users/zsh-syntax-highlighting $ZSH_CUSTOM/plugins/zsh-syntax-highlighting</code></pre></div><p>安装 <a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL3pzaC11c2Vycy96c2gtYXV0b3N1Z2dlc3Rpb25z" target="_blank" rel="noopener">zsh-autosuggestions</a>（自动建议）</p><div class="hljs"><pre><code class="hljs shell">git clone https://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions</code></pre></div><p>安装 <a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL3pzaC11c2Vycy96c2gtY29tcGxldGlvbnM=" target="_blank" rel="noopener">zsh-completions</a>（自动补全）</p><div class="hljs"><pre><code class="hljs shell">git clone https://github.com/zsh-users/zsh-completions $ZSH_CUSTOM/plugins/zsh-completions</code></pre></div><p>zsh-com­ple­tions 插件还需把 <code>autoload -U compinit &amp;&amp; compinit</code> 添加到<code>.zshrc</code>。输入命令可一键添加：</p><div class="hljs"><pre><code class="hljs shell">[ -z "`grep "autoload -U compinit &amp;&amp; compinit" ~/.zshrc`" ] &amp;&amp; echo "autoload -U compinit &amp;&amp; compinit" &gt;&gt; ~/.zshrc</code></pre></div><p>把需要启用的插件写入到配置文件中，使用 <code>sed</code> 命令一键操作。</p><div class="hljs"><pre><code class="hljs shell">sed -i '/^plugins=/c\plugins=(git z zsh-syntax-highlighting zsh-autosuggestions zsh-completions)' ~/.zshrc</code></pre></div><blockquote><p>如果你有自己想添加的插件，写在括号内即可，插件名称用空格隔开。</p></blockquote><p>最后应用配置</p><div class="hljs"><pre><code class="hljs shell">source ~/.zshrc</code></pre></div><h2 id="修改终端配色"><a href="#修改终端配色" class="headerlink" title="修改终端配色"></a>修改终端配色</h2><p>修改配色需要安装 <a href="https://p3terx.com/go/aHR0cHM6Ly93aWtpLnRlcm11eC5jb20vd2lraS9UZXJtdXg6U3R5bGluZw==" target="_blank" rel="noopener">Termux:Styling</a> 这个插件，安装好后长按屏幕，进入 <code>More...</code> 菜单，选择 <code>Style</code> 就可以对配色和字体进行设置。这在上篇文章中介绍菜单和选项时有提到过。</p><p><a href="https://p3terximg.gitee.io/post/20190924184057.jpg#vwid=1080&amp;vhei=1135" target="_blank" rel="noopener"><img src="https://p3terximg.gitee.io/post/20190924184057.jpg#vwid=1080&amp;vhei=1135" srcset="/img/loading.gif" alt="img"></a></p><p>选择好你自己喜欢的配色和字体，设置好后会在 <code>~/.termux</code> 目录中生成配色文件 <code>colors.properties</code> 和字体文件 <code>font.ttf</code>，可以把这两个文件进行备份，以后只需要导入即可，就不再需要安装这个插件了。</p><div class="hljs"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree ~/.termux</span>/data/data/com.termux/files/home/.termux├── colors.properties├── font.ttf├── shell -&gt; /data/data/com.termux/files/usr/bin/zsh└── termux.properties</code></pre></div><p>Bash</p><div class="hljs"><pre><code class="hljs bash">ZSH_THEME=<span class="hljs-string">"random"</span></code></pre></div><h2 id="管理员身份"><a href="#管理员身份" class="headerlink" title="管理员身份"></a>管理员身份</h2><h3 id="手机没有root"><a href="#手机没有root" class="headerlink" title="手机没有root"></a>手机没有root</h3><p>利用<code>proot</code>工具来模拟某些需要root的环境</p><p>Bash</p><div class="hljs"><pre><code class="hljs bash">pkg install proot</code></pre></div><p>然后终端下面输入:</p><div class="hljs"><pre><code class="hljs ebnf"><span class="hljs-attribute">termux-chroot</span></code></pre></div><p>即可模拟<code>root</code>环境<br>在这个<code>proot</code>环境下面,相当于是进入了<code>home</code>目录,可以很方便地进行一些配置.</p><p><img src="https://image.3001.net/images/20180502/15252406356840.png" srcset="/img/loading.gif" alt="img"></p><p>在管理员身份下，输入<code>exit</code>可回到普通用户身份。</p><h3 id="手机已经root"><a href="#手机已经root" class="headerlink" title="手机已经root"></a>手机已经root</h3><p>安装<code>tsu</code>,这是一个<code>su</code>的termux版本,用来在termux上替代<code>su</code>:</p><p>Bash</p><div class="hljs"><pre><code class="hljs bash">pkg install tsu</code></pre></div><p>然后终端下面输入:</p><div class="hljs"><pre><code class="hljs ebnf"><span class="hljs-attribute">tsu</span></code></pre></div><p>即可切换<code>root</code>用户,这个时候会弹出<code>root</code>授权提示,给予其<code>root</code>权限,效果图如下:</p><p><img src="https://image.3001.net/images/20180501/15251567018423.png" srcset="/img/loading.gif" alt="img"></p><p>在管理员身份下，输入<code>exit</code>可回到普通用户身份。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>修改win10 tcp配置参数来提升酸酸乳打开youtube的速度教程</title>
    <link href="/posts/d8b5d3fc.html"/>
    <url>/posts/d8b5d3fc.html</url>
    
    <content type="html"><![CDATA[<h2 id="修改win10-tcp配置参数来提升酸酸乳打开youtube的速度教程"><a href="#修改win10-tcp配置参数来提升酸酸乳打开youtube的速度教程" class="headerlink" title="修改win10 tcp配置参数来提升酸酸乳打开youtube的速度教程"></a>修改win10 tcp配置参数来提升酸酸乳打开youtube的速度教程</h2><p>先去下载<a href="https://www.speedguide.net/downloads.php" target="_blank" rel="noopener"><strong>SG TCP Optimizer</strong></a>使用默认设置优化win10.</p><h3 id="1、管理员方式运行cmd命令，在cmd窗口输入以下命令，查看当前-TCP-全局参数"><a href="#1、管理员方式运行cmd命令，在cmd窗口输入以下命令，查看当前-TCP-全局参数" class="headerlink" title="1、管理员方式运行cmd命令，在cmd窗口输入以下命令，查看当前 TCP 全局参数"></a>1、管理员方式运行cmd命令，在cmd窗口输入以下命令，查看当前 TCP 全局参数</h3><p><code>netsh int tcp show global</code><br><img src="https://tva1.sinaimg.cn/large/007X8olVly1g6nwztaehoj30ek08oq36.jpg" srcset="/img/loading.gif" alt="img"></p><h3 id="2、修改TCP-全局参数。以下4个都要改"><a href="#2、修改TCP-全局参数。以下4个都要改" class="headerlink" title="2、修改TCP 全局参数。以下4个都要改"></a>2、修改TCP 全局参数。以下4个都要改</h3><p><strong>2.1直接缓存访问(DCA)</strong><code>netsh int tcp set global dca=enabled</code></p><p><strong>2.2接收窗口自动调谐级别</strong><code>netsh int tcp set global autotuninglevel=normal</code></p><p><strong>2.3附加拥塞控制提供程序</strong></p><p>Win7用此命令<code>netsh interface tcp set global congestionprovider=ctcp</code><br>Win10用此命令 <code>netsh int tcp set supplemental template=internet congestionprovider=ctcp</code><br><strong>2.4RFC 1323 时间戳</strong><code>netsh int tcp set global timestamps=enabled</code></p><p><img src="https://tva1.sinaimg.cn/large/007X8olVly1g6nx29ro56j30j305p3yk.jpg" srcset="/img/loading.gif" alt="img"></p><p>3、重启电脑</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Fail2Ban 禁止服务器上的非法访问</title>
    <link href="/posts/f3bca7b5.html"/>
    <url>/posts/f3bca7b5.html</url>
    
    <content type="html"><![CDATA[<p>Linux 管理员的一个重要任务是保护服务器免受非法攻击或访问。 默认情况下，Linux 系统带有配置良好的防火墙，比如iptables、Uncomplicated Firewall（UFW），ConfigServer Security Firewall（CSF）等，可以防止多种攻击。</p><p>任何连接到互联网的机器都是恶意攻击的潜在目标。 有一个名为 Fail2Ban 的工具可用来缓解服务器上的非法访问。</p><h2 id="1-认识问题严重性"><a href="#1-认识问题严重性" class="headerlink" title="1.认识问题严重性"></a>1.认识问题严重性</h2><p>先在你机器（包括你平时用的linux的机器）上跑几个命令看看吧。</p><h2 id="1-1查看尝试暴力破解机器密码的人"><a href="#1-1查看尝试暴力破解机器密码的人" class="headerlink" title="1.1查看尝试暴力破解机器密码的人"></a>1.1查看尝试暴力破解机器密码的人</h2><div class="hljs"><pre><code class="hljs text">sudo grep &quot;Failed password for root&quot; &#x2F;var&#x2F;log&#x2F;auth.log | awk &#39;&#123;print $11&#125;&#39; | sort | uniq -c | sort -nr | more</code></pre></div><p>害怕吗？</p><h2 id="1-2查看暴力猜用户名的人"><a href="#1-2查看暴力猜用户名的人" class="headerlink" title="1.2查看暴力猜用户名的人"></a>1.2查看暴力猜用户名的人</h2><div class="hljs"><pre><code class="hljs text">sudo grep &quot;Failed password for invalid user&quot; &#x2F;var&#x2F;log&#x2F;auth.log | awk &#39;&#123;print $13&#125;&#39; | sort | uniq -c | sort -nr | more</code></pre></div><p>在我实验室的机器上，看到的结果如下：</p><p>次数ip207202.201.34.104108114.80.253.818222.186.58.2448222.186.56.1203198.55.103.1442一堆ip1一堆ip</p><p><strong>感受到寒意了吗？</strong></p><h2 id="2应对策略"><a href="#2应对策略" class="headerlink" title="2应对策略"></a>2应对策略</h2><h2 id="2-1-SSH相关"><a href="#2-1-SSH相关" class="headerlink" title="2.1 SSH相关"></a>2.1 SSH相关</h2><h3 id="2-1-1-不使用默认的22端口"><a href="#2-1-1-不使用默认的22端口" class="headerlink" title="2.1.1 不使用默认的22端口"></a>2.1.1 不使用默认的22端口</h3><p>ssh登陆默认的端口是22，而搬瓦工一般都默认是一个比较大的随机端口，<strong>不要为了方便，改回22</strong>。<br>修改<code>/etc/ssh/sshd_config</code>文件，将其中的<code>Port 22</code>改为随意的端口比如<code>Port 47832</code>，port的取值范围是 0 – 65535(即2的16次方)，0到1024是众所周知的端口（知名端口，常用于系统服务等，例如http服务的端口号是80)。</p><h3 id="2-1-2-不要使用简单密码"><a href="#2-1-2-不要使用简单密码" class="headerlink" title="2.1.2 不要使用简单密码"></a>2.1.2 不要使用简单密码</h3><p>默认生成的root密码是随机的，但是不要改成你自己的密码，你可以将密码记在手机上，但是一定不要改成你自己的有规律的密码。</p><h3 id="2-1-3-禁止使用密码登陆，使用RSA私钥登陆"><a href="#2-1-3-禁止使用密码登陆，使用RSA私钥登陆" class="headerlink" title="2.1.3 禁止使用密码登陆，使用RSA私钥登陆"></a>2.1.3 禁止使用密码登陆，使用RSA私钥登陆</h3><p><strong>这条是最重要最有效的。</strong><br>跟之前写的<a href="https://www.findhao.net/easycoding/1652" target="_blank" rel="noopener">debian ssh 连接android 通过termux</a>里登陆部分是一样的。rsa的原理也不再赘述，<a href="https://zh.wikipedia.org/wiki/RSA加密演算法" target="_blank" rel="noopener">wiki上的条目</a>描述的很清楚。<br>先通过<code>ssh-keygen</code> <code>-t rsa</code>生成你的客户端的密钥，包括一个私钥和公钥，用<code>scp id_rsa.pub</code> <code>root@XX.XX.XX.XX:~/</code>把公钥拷贝到服务器上，注意，生成私钥的时候，文件名是可以自定义的，且可以再加一层密码，所以建议文件名取自己能识别出哪台机器的名字。然后在服务器上，你的用户目录下，新建<code>.ssh</code>文件夹，并将该文件夹的权限设为<strong>700</strong>，<code>chmod 700 .ssh</code>，并新建一个<code>authorized_keys</code>，这是默认允许的key存储的文件。如果已经存在，则只需要将上传的<code>id_rsa.pub</code>文件内容追加进去即可：<code>cat id_rsa.pub &gt;&gt; authorized_keys</code>，如果不存在则新建并改权限为400即可。<br>然后编辑ssh的配置文件：</p><div class="hljs"><pre><code class="hljs text"># vi &#x2F;etc&#x2F;ssh&#x2F;sshd_configRSAAuthentication yes #RSA认证PubkeyAuthentication yes #开启公钥验证AuthorizedKeysFile .ssh&#x2F;authorized_keys #验证文件路径PasswordAuthentication no #禁止密码认证PermitEmptyPasswords no #禁止空密码# 最后保存，重启sshd服务sudo service sshd restart</code></pre></div><h3 id="2-1-4-禁止root用户登录"><a href="#2-1-4-禁止root用户登录" class="headerlink" title="2.1.4 禁止root用户登录"></a>2.1.4 禁止root用户登录</h3><p>你可以新建一个用户来管理，而非直接使用root用户，防止密码被破解。<br>还是修改<code>/etc/ssh/sshd_config</code></p><div class="hljs"><pre><code class="hljs text">PermitRootLogin no</code></pre></div><h3 id="什么是-Fail2Ban？"><a href="#什么是-Fail2Ban？" class="headerlink" title="什么是 Fail2Ban？"></a>什么是 Fail2Ban？</h3><p><a href="https://github.com/fail2ban/fail2ban" target="_blank" rel="noopener">Fail2Ban</a> 是一款入侵防御软件，可以保护服务器免受暴力攻击。 它是用 Python 编程语言编写的。 Fail2Ban 基于auth 日志文件工作，默认情况下它会扫描所有 auth 日志文件，如 <code>/var/log/auth.log</code>、<code>/var/log/apache/access.log</code> 等，并禁止带有恶意标志的IP，比如密码失败太多，寻找漏洞等等标志。</p><p>通常，Fail2Ban 用于更新防火墙规则，用于在指定的时间内拒绝 IP 地址。 它也会发送邮件通知。 Fail2Ban 为各种服务提供了许多过滤器，如 ssh、apache、nginx、squid、named、mysql、nagios 等。</p><p>Fail2Ban 能够降低错误认证尝试的速度，但是它不能消除弱认证带来的风险。 这只是服务器防止暴力攻击的安全手段之一。</p><h3 id="如何在-Linux-中安装-Fail2Ban"><a href="#如何在-Linux-中安装-Fail2Ban" class="headerlink" title="如何在 Linux 中安装 Fail2Ban"></a>如何在 Linux 中安装 Fail2Ban</h3><p>Fail2Ban 已经与大部分 Linux 发行版打包在一起了，所以只需使用你的发行包版的包管理器来安装它。</p><p>对于 Debian / Ubuntu，使用 <a href="https://www.2daygeek.com/apt-get-apt-cache-command-examples-manage-packages-debian-ubuntu-systems/" target="_blank" rel="noopener">APT-GET 命令</a>或 <a href="https://www.2daygeek.com/apt-command-examples-manage-packages-debian-ubuntu-systems/" target="_blank" rel="noopener">APT 命令</a>安装。</p><div class="hljs"><pre><code class="hljs cmake">$ sudo apt <span class="hljs-keyword">install</span> fail2ban</code></pre></div><p>对于 Fedora，使用 <a href="https://www.2daygeek.com/dnf-command-examples-manage-packages-fedora-system/" target="_blank" rel="noopener">DNF 命令</a>安装。</p><div class="hljs"><pre><code class="hljs cmake">$ sudo dnf <span class="hljs-keyword">install</span> fail2ban</code></pre></div><p>对于 CentOS/RHEL，启用 <a href="https://www.2daygeek.com/install-enable-epel-repository-on-rhel-centos-scientific-linux-oracle-linux/" target="_blank" rel="noopener">EPEL 库</a>或 <a href="https://www.2daygeek.com/install-enable-repoforge-rpmforge-repository-on-rhel-centos-sl/" target="_blank" rel="noopener">RPMForge</a> 库，使用 <a href="https://www.2daygeek.com/yum-command-examples-manage-packages-rhel-centos-systems/" target="_blank" rel="noopener">YUM 命令</a>安装。</p><div class="hljs"><pre><code class="hljs cmake">$ sudo yum <span class="hljs-keyword">install</span> fail2ban</code></pre></div><p>对于 Arch Linux，使用 <a href="https://www.2daygeek.com/pacman-command-examples-manage-packages-arch-linux-system/" target="_blank" rel="noopener">Pacman 命令</a>安装。</p><div class="hljs"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>sudo pacman -S fail2ban</code></pre></div><p>对于 openSUSE , 使用 <a href="https://www.2daygeek.com/zypper-command-examples-manage-packages-opensuse-system/" target="_blank" rel="noopener">Zypper命令</a>安装。</p><div class="hljs"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>sudo zypper <span class="hljs-keyword">in</span> fail2ban</code></pre></div><h3 id="如何配置-Fail2Ban"><a href="#如何配置-Fail2Ban" class="headerlink" title="如何配置 Fail2Ban"></a>如何配置 Fail2Ban</h3><p>默认情况下，Fail2Ban 将所有配置文件保存在 <code>/etc/fail2ban/</code> 目录中。 主配置文件是 <code>jail.conf</code>，它包含一组预定义的过滤器。 所以，不要编辑该文件，这是不可取的，因为只要有新的更新，配置就会重置为默认值。</p><p>只需在同一目录下创建一个名为 <code>jail.local</code> 的新配置文件，并根据您的意愿进行修改。</p><div class="hljs"><pre><code class="hljs gradle"># cp <span class="hljs-regexp">/etc/</span>fail2ban<span class="hljs-regexp">/jail.conf /</span>etc<span class="hljs-regexp">/fail2ban/</span>jail.local</code></pre></div><p>默认情况下，大多数选项都已经配置的很完美了，如果要启用对任何特定 IP 的访问，则可以将 IP 地址添加到 <code>ignoreip</code> 区域，对于多个 IP 的情况，用空格隔开 IP 地址。</p><p>配置文件中的 <code>DEFAULT</code> 部分包含 Fail2Ban 遵循的基本规则集，您可以根据自己的意愿调整任何参数。</p><div class="hljs"><pre><code class="hljs angelscript"># nano /etc/fail2ban/jail.local[DEFAULT]ignoreip = <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>/<span class="hljs-number">8</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span>/<span class="hljs-number">24</span>bantime = <span class="hljs-number">600f</span>indtime = <span class="hljs-number">600</span>maxretry = <span class="hljs-number">3</span>destemail = <span class="hljs-symbol">2daygeek@</span>gmail.com</code></pre></div><ul><li><code>ignoreip</code>：本部分允许我们列出 IP 地址列表，Fail2Ban 不会禁止与列表中的地址匹配的主机</li><li><code>bantime</code>：主机被禁止的秒数</li><li><code>findtime</code>：如果在最近 <code>findtime</code> 秒期间已经发生了 <code>maxretry</code> 次重试，则主机会被禁止</li><li><code>maxretry</code>：是主机被禁止之前的失败次数</li></ul><h3 id="如何配置服务"><a href="#如何配置服务" class="headerlink" title="如何配置服务"></a>如何配置服务</h3><p>Fail2Ban 带有一组预定义的过滤器，用于各种服务，如 ssh、apache、nginx、squid、named、mysql、nagios 等。 我们不希望对配置文件进行任何更改，只需在服务区域中添加 <code>enabled = true</code> 这一行就可以启用任何服务。 禁用服务时将 <code>true</code> 改为 <code>false</code> 即可。</p><div class="hljs"><pre><code class="hljs elm"># <span class="hljs-type">SSH</span> servers[sshd]enabled = true<span class="hljs-keyword">port</span> = sshlogpath = %(sshd_log)sbackend = %(sshd_backend)s</code></pre></div><ul><li><code>enabled</code>： 确定服务是打开还是关闭。</li><li><code>port</code>：指明特定的服务。 如果使用默认端口，则服务名称可以放在这里。 如果使用非传统端口，则应该是端口号。</li><li><code>logpath</code>：提供服务日志的位置</li><li><code>backend</code>：指定用于获取文件修改的后端。</li></ul><h3 id="重启-Fail2Ban"><a href="#重启-Fail2Ban" class="headerlink" title="重启 Fail2Ban"></a>重启 Fail2Ban</h3><p>进行更改后，重新启动 Fail2Ban 才能生效。</p><div class="hljs"><pre><code class="hljs routeros">[<span class="hljs-keyword">For</span> SysVinit Systems]#<span class="hljs-built_in"> service </span>fail2ban restart[<span class="hljs-keyword">For</span> systemd Systems]# systemctl restart fail2ban.service</code></pre></div><h3 id="验证-Fail2Ban-iptables-规则"><a href="#验证-Fail2Ban-iptables-规则" class="headerlink" title="验证 Fail2Ban iptables 规则"></a>验证 Fail2Ban iptables 规则</h3><p>你可以使用下面的命令来确认是否在防火墙中成功添加了Fail2Ban iptables 规则。</p><div class="hljs"><pre><code class="hljs vim"># iptables -LChain INPUT (policy ACCEPT)target prot <span class="hljs-keyword">opt</span> <span class="hljs-keyword">source</span> destinationf2b-apache-auth tcp -- anywhere anywhere multiport dports http,httpsf2b-sshd tcp -- anywhere anywhere multiport dports <span class="hljs-number">1234</span>ACCEPT tcp -- anywhere anywhere tcp <span class="hljs-keyword">dp</span><span class="hljs-variable">t:1234Chain</span> FORWARD (policy ACCEPT)target prot <span class="hljs-keyword">opt</span> <span class="hljs-keyword">source</span> destinationChain OUTPUT (policy ACCEPT)target prot <span class="hljs-keyword">opt</span> <span class="hljs-keyword">source</span> destinationChain f2b-apache-auth (<span class="hljs-number">1</span> references)target prot <span class="hljs-keyword">opt</span> <span class="hljs-keyword">source</span> destinationRETURN <span class="hljs-keyword">all</span> -- anywhere anywhereChain f2b-sshd (<span class="hljs-number">1</span> references)target prot <span class="hljs-keyword">opt</span> <span class="hljs-keyword">source</span> destinationRETURN <span class="hljs-keyword">all</span> -- anywhere anywhere</code></pre></div><h3 id="如何测试-Fail2Ban"><a href="#如何测试-Fail2Ban" class="headerlink" title="如何测试 Fail2Ban"></a>如何测试 Fail2Ban</h3><p>我做了一些失败的尝试来测试这个。 为了证实这一点，我要验证 <code>/var/log/fail2ban.log</code> 文件。</p><div class="hljs"><pre><code class="hljs angelscript"><span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">22</span>,<span class="hljs-number">901</span> fail2ban.server [<span class="hljs-number">7141</span>]: INFO Changed logging target to /var/log/fail2ban.log <span class="hljs-keyword">for</span> Fail2ban v0<span class="hljs-number">.9</span><span class="hljs-number">.62017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">22</span>,<span class="hljs-number">987</span> fail2ban.database [<span class="hljs-number">7141</span>]: INFO Connected to fail2ban persistent database <span class="hljs-string">'/var/lib/fail2ban/fail2ban.sqlite3'</span><span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">22</span>,<span class="hljs-number">996</span> fail2ban.database [<span class="hljs-number">7141</span>]: WARNING New database created. Version <span class="hljs-string">'2'</span><span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">22</span>,<span class="hljs-number">998</span> fail2ban.jail [<span class="hljs-number">7141</span>]: INFO Creating new jail <span class="hljs-string">'sshd'</span><span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">002</span> fail2ban.jail [<span class="hljs-number">7141</span>]: INFO Jail <span class="hljs-string">'sshd'</span> uses poller &#123;&#125;<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">019</span> fail2ban.jail [<span class="hljs-number">7141</span>]: INFO Initiated <span class="hljs-string">'polling'</span> backend2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">019</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO Set maxRetry = <span class="hljs-number">52017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">020</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO Set jail log file encoding to UTF<span class="hljs-number">-82017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">020</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO Added logfile = /var/log/auth.log2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">021</span> fail2ban.actions [<span class="hljs-number">7141</span>]: INFO Set banTime = <span class="hljs-number">6002017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">021</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO Set findtime = <span class="hljs-number">6002017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">022</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO Set maxlines = <span class="hljs-number">102017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">070</span> fail2ban.server [<span class="hljs-number">7141</span>]: INFO Jail sshd <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> a JournalFilter instance2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">081</span> fail2ban.jail [<span class="hljs-number">7141</span>]: INFO Jail <span class="hljs-string">'sshd'</span> started2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">763</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO [sshd] Found <span class="hljs-number">103.5</span><span class="hljs-number">.134</span><span class="hljs-number">.1672017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">763</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO [sshd] Found <span class="hljs-number">103.5</span><span class="hljs-number">.134</span><span class="hljs-number">.1672017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">764</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO [sshd] Found <span class="hljs-number">181.129</span><span class="hljs-number">.54</span><span class="hljs-number">.1702017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">764</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO [sshd] Found <span class="hljs-number">181.129</span><span class="hljs-number">.54</span><span class="hljs-number">.1702017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">765</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO [sshd] Found <span class="hljs-number">181.129</span><span class="hljs-number">.54</span><span class="hljs-number">.1702017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">14</span>:<span class="hljs-number">43</span>:<span class="hljs-number">23</span>,<span class="hljs-number">765</span> fail2ban.filter [<span class="hljs-number">7141</span>]: INFO [sshd] Found <span class="hljs-number">181.129</span><span class="hljs-number">.54</span><span class="hljs-number">.1702017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">06</span>,<span class="hljs-number">192</span> fail2ban.server [<span class="hljs-number">7141</span>]: INFO Stopping all jails2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">06</span>,<span class="hljs-number">874</span> fail2ban.jail [<span class="hljs-number">7141</span>]: INFO Jail <span class="hljs-string">'sshd'</span> stopped2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">06</span>,<span class="hljs-number">879</span> fail2ban.server [<span class="hljs-number">7141</span>]: INFO Exiting Fail2ban2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">123</span> fail2ban.server [<span class="hljs-number">8528</span>]: INFO Changed logging target to /var/log/fail2ban.log <span class="hljs-keyword">for</span> Fail2ban v0<span class="hljs-number">.9</span><span class="hljs-number">.62017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">123</span> fail2ban.database [<span class="hljs-number">8528</span>]: INFO Connected to fail2ban persistent database <span class="hljs-string">'/var/lib/fail2ban/fail2ban.sqlite3'</span><span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">126</span> fail2ban.jail [<span class="hljs-number">8528</span>]: INFO Creating new jail <span class="hljs-string">'sshd'</span><span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">129</span> fail2ban.jail [<span class="hljs-number">8528</span>]: INFO Jail <span class="hljs-string">'sshd'</span> uses poller &#123;&#125;<span class="hljs-number">2017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">141</span> fail2ban.jail [<span class="hljs-number">8528</span>]: INFO Initiated <span class="hljs-string">'polling'</span> backend2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">142</span> fail2ban.actions [<span class="hljs-number">8528</span>]: INFO Set banTime = <span class="hljs-number">602017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">142</span> fail2ban.filter [<span class="hljs-number">8528</span>]: INFO Set findtime = <span class="hljs-number">602017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">142</span> fail2ban.filter [<span class="hljs-number">8528</span>]: INFO Set jail log file encoding to UTF<span class="hljs-number">-82017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">143</span> fail2ban.filter [<span class="hljs-number">8528</span>]: INFO Set maxRetry = <span class="hljs-number">32017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">144</span> fail2ban.filter [<span class="hljs-number">8528</span>]: INFO Added logfile = /var/log/auth.log2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">144</span> fail2ban.filter [<span class="hljs-number">8528</span>]: INFO Set maxlines = <span class="hljs-number">102017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">189</span> fail2ban.server [<span class="hljs-number">8528</span>]: INFO Jail sshd <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> a JournalFilter instance2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">19</span>:<span class="hljs-number">07</span>,<span class="hljs-number">195</span> fail2ban.jail [<span class="hljs-number">8528</span>]: INFO Jail <span class="hljs-string">'sshd'</span> started2017<span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">03</span>,<span class="hljs-number">263</span> fail2ban.filter [<span class="hljs-number">8528</span>]: INFO [sshd] Found <span class="hljs-number">103.5</span><span class="hljs-number">.134</span><span class="hljs-number">.1672017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">05</span>,<span class="hljs-number">267</span> fail2ban.filter [<span class="hljs-number">8528</span>]: INFO [sshd] Found <span class="hljs-number">103.5</span><span class="hljs-number">.134</span><span class="hljs-number">.1672017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">12</span>,<span class="hljs-number">276</span> fail2ban.filter [<span class="hljs-number">8528</span>]: INFO [sshd] Found <span class="hljs-number">103.5</span><span class="hljs-number">.134</span><span class="hljs-number">.1672017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">20</span>:<span class="hljs-number">12</span>,<span class="hljs-number">380</span> fail2ban.actions [<span class="hljs-number">8528</span>]: NOTICE [sshd] Ban <span class="hljs-number">103.5</span><span class="hljs-number">.134</span><span class="hljs-number">.1672017</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span>:<span class="hljs-number">12</span>,<span class="hljs-number">659</span> fail2ban.actions [<span class="hljs-number">8528</span>]: NOTICE [sshd] Unban <span class="hljs-number">103.5</span><span class="hljs-number">.134</span><span class="hljs-number">.167</span></code></pre></div><p>要查看启用的监狱列表，请运行以下命令。</p><div class="hljs"><pre><code class="hljs vala"><span class="hljs-meta"># fail2ban-client statusStatus|- Number of jail:  2`- Jail list:   apache-auth, sshd</span></code></pre></div><p>通过运行以下命令来获取禁止的 IP 地址。</p><div class="hljs"><pre><code class="hljs stata"># fail2ban-client status sshStatus <span class="hljs-keyword">for</span> the jail: ssh|- filter| |- <span class="hljs-keyword">File</span> <span class="hljs-keyword">list</span>: /<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/auth.<span class="hljs-keyword">log</span>| |- Currently failed: 1| `- <span class="hljs-keyword">Total</span> failed: 3`- action |- Currently banned: 1 | `- IP <span class="hljs-keyword">list</span>: 192.168.1.115 `- <span class="hljs-keyword">Total</span> banned: 1</code></pre></div><p>要从 Fail2Ban 中删除禁止的 IP 地址，请运行以下命令。</p><div class="hljs"><pre><code class="hljs angelscript"># fail2ban-client <span class="hljs-keyword">set</span> ssh unbanip <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.115</span></code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>besttrace回程测速方法</title>
    <link href="/posts/c863342b.html"/>
    <url>/posts/c863342b.html</url>
    
    <content type="html"><![CDATA[<p>Best Trace 是 <a href="https://www.24kplus.com/go/ipip" target="_blank" rel="noopener">IPIP</a> 推出的一款路由追踪器，目前有 windows，linux，mac，android，ios 共五个版本，其中 Linux 版本最为简洁，既没有网络表格化更没有地图连线，只有简单的排版打印。 此次介绍的 Best Trace 是在 linux 命令行界面下使用的工具。</p><p>在这里介绍 BestTrace 的 Linux 版本使用方式</p><h4 id="1、下载并解压"><a href="#1、下载并解压" class="headerlink" title="1、下载并解压"></a>1、下载并解压</h4><div class="hljs"><pre><code class="hljs armasm"><span class="hljs-symbol">wget</span> https://cdn.ipip.net/<span class="hljs-number">17</span>mon/<span class="hljs-keyword">besttrace4linux.zip</span><span class="hljs-keyword">unzip </span><span class="hljs-keyword">besttrace4linux.zip </span>-d <span class="hljs-keyword">besttrace4</span><span class="hljs-keyword">cd </span><span class="hljs-keyword">besttrace4</span></code></pre></div><p>如果出现 <code>-bash: unzip: command not found</code> 错误，执行：</p><div class="hljs"><pre><code class="hljs cmake"><span class="hljs-comment">#CentOS</span>yum <span class="hljs-keyword">install</span> unzip zip -y<span class="hljs-comment">#Ubuntu</span>apt <span class="hljs-keyword">install</span> unzip zip -y</code></pre></div><h4 id="2、赋予执行权"><a href="#2、赋予执行权" class="headerlink" title="2、赋予执行权"></a>2、赋予执行权</h4><div class="hljs"><pre><code class="hljs gml">chmod +<span class="hljs-symbol">x</span> besttrace</code></pre></div><h4 id="3、进行路由追踪"><a href="#3、进行路由追踪" class="headerlink" title="3、进行路由追踪"></a>3、进行路由追踪</h4><div class="hljs"><pre><code class="hljs routeros">./besttrace -q1 -g cn IP<span class="hljs-comment">#或者采用-T防止vps用icmp欺骗程序</span>./besttrace -q1 -g cn -T IP</code></pre></div><h4 id="4、测试丢包"><a href="#4、测试丢包" class="headerlink" title="4、测试丢包"></a>4、测试丢包</h4><div class="hljs"><pre><code class="hljs angelscript">ping -c <span class="hljs-number">100</span> <span class="hljs-number">58.16</span><span class="hljs-number">.83</span><span class="hljs-number">.239</span></code></pre></div><p>例如：</p><div class="hljs"><pre><code class="hljs angelscript">$ ./besttrace -q1 -g cn <span class="hljs-number">183.56</span><span class="hljs-number">.167</span><span class="hljs-number">.125</span>traceroute to <span class="hljs-number">183.56</span><span class="hljs-number">.167</span><span class="hljs-number">.125</span> (<span class="hljs-number">183.56</span><span class="hljs-number">.167</span><span class="hljs-number">.125</span>), <span class="hljs-number">30</span> hops max, <span class="hljs-number">60</span> byte packets  <span class="hljs-number">1</span>  <span class="hljs-number">103.102</span><span class="hljs-number">.5</span><span class="hljs-number">.1</span>  <span class="hljs-number">0.40</span> ms  AS131477  美国 加利福尼亚州 洛杉矶 rixcloud.com  <span class="hljs-number">2</span>  *  <span class="hljs-number">3</span>  <span class="hljs-number">59.43</span><span class="hljs-number">.182</span><span class="hljs-number">.78</span>  <span class="hljs-number">155.69</span> ms  AS4809  中国 广东 广州 电信  <span class="hljs-number">4</span>  <span class="hljs-number">59.43</span><span class="hljs-number">.187</span><span class="hljs-number">.141</span>  <span class="hljs-number">186.04</span> ms  AS4809  中国 广东 广州 电信  <span class="hljs-number">5</span>  <span class="hljs-number">59.43</span><span class="hljs-number">.130</span><span class="hljs-number">.113</span>  <span class="hljs-number">191.66</span> ms  AS4809  中国 广东 广州 电信  <span class="hljs-number">6</span>  <span class="hljs-number">202.97</span><span class="hljs-number">.70</span><span class="hljs-number">.14</span>  <span class="hljs-number">186.64</span> ms  *  中国 广东 广州 电信  <span class="hljs-number">7</span>  *  <span class="hljs-number">8</span>  <span class="hljs-number">121.14</span><span class="hljs-number">.112</span><span class="hljs-number">.234</span>  <span class="hljs-number">159.83</span> ms  AS4816  中国 广东 深圳 电信  <span class="hljs-number">9</span>  <span class="hljs-number">183.60</span><span class="hljs-number">.20</span><span class="hljs-number">.134</span>  <span class="hljs-number">191.64</span> ms  AS4816  中国 广东 深圳 电信 <span class="hljs-number">10</span>  <span class="hljs-number">183.56</span><span class="hljs-number">.167</span><span class="hljs-number">.125</span>  <span class="hljs-number">160.32</span> ms  AS4816  中国 广东 深圳 电信</code></pre></div><p>电信：其中 AS4809 就是电信CN2网络，CN2一般59开头IP段，而 AS4134 则是我们说的163网络（也有小营运商称为CN1），全称没有 AS4134 节点称为CN2 GIA，如果中间经过 AS4134 则为CN2 GT。</p><p>联通：联通出口网络一般为 AS4837，好于电信的AS4134，比 AS4809 要差一些，高峰期存在丢包现象，联通的出口带宽并不是完全没有亮点，不管是香港还是美国，联通 AS4837 几乎都能直连，很少绕路。也有部分商家为了优化联通的进出口网络，增强用户体验，在国内中转CN2网络后再出口连接到其他国家，这种也可以貌美电信CN2 GIA。</p><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><div class="hljs"><pre><code class="hljs angelscript"><span class="hljs-number">-6</span>， - ipv6使用ipv6。-J， - json使用JSON格式打印traceroute结果。-g， - lang <span class="hljs-built_in">string</span>语言现在仅支持cn和en。-m， - maxhop <span class="hljs-built_in">int</span>指定traceroute将探测的最大跳数（最大生存时间值）。默认值为<span class="hljs-number">30.</span>（默认为<span class="hljs-number">30</span>）-a， - noas显示时，请勿尝试将IP地址映射到AS。-n， - nodomain显示时，请勿尝试将IP地址映射到主机名。-l， - location显示时，请勿尝试将IP地址映射到位置。-q， - query <span class="hljs-built_in">int</span>设置每跳的探测包数。默认值为<span class="hljs-number">3.</span>（默认值为<span class="hljs-number">3</span>）-z， - sendtime <span class="hljs-built_in">int</span>探针之间的最小时间间隔（默认为<span class="hljs-number">0</span>）。如果该值大于<span class="hljs-number">10</span>，则它指定一个以毫秒为单位的数字，否则它是一个秒数（也允许浮点值）。当某些路由器对ICMP消息使用速率限制时很有用。-f， - stopop <span class="hljs-built_in">int</span>指定要启动的TTL。默认为<span class="hljs-number">1.</span>（默认值为<span class="hljs-number">1</span>）- 同步通过同步发送icmp包。-T， - tcp使用TCP SYN进行探测。-V， - 版本打印版本并退出。-w， - waittime <span class="hljs-built_in">int</span>设置等待探测响应的时间（以秒为单位）。 （默认<span class="hljs-number">3</span>）</code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>AutoRclone配合gclone突破GoogleTeamDrive750G流量限制</title>
    <link href="/posts/e5e17474.html"/>
    <url>/posts/e5e17474.html</url>
    
    <content type="html"><![CDATA[<p>参考：</p><p><a href="https://www.uud.me/qiwenzalun/autorclone-gclone.html" target="_blank" rel="noopener">https://www.uud.me/qiwenzalun/autorclone-gclone.html</a></p><p><a href="http://blog.jialezi.net/?post=153" target="_blank" rel="noopener">http://blog.jialezi.net/?post=153</a></p><p><a href="https://gsuitems.com/index.php/archives/13/" target="_blank" rel="noopener">https://gsuitems.com/index.php/archives/13/</a></p><p>本文大部分复制以上链接拼接并修改。</p><p>GoogleDrive 每日流量限制为750G，AutoRclone 的功能在于通过谷歌开发者平台创建多个服务账户，实现达到750G流量限制后，自动切换账户。AutoRclone 同时配合 Gclone 能够在 Google Drive 账号之间、谷歌团队盘之间快速拷贝、传输学习资料。</p><p>本文的设置过程中，主要使用 AutoRclone 生成 Service Accounts，然后配合 gclone 中 <code>service_account_file</code> 和 <code>service_account_file_path</code> 这两项参数，调用 Service Accounts，实现达到750G流量限制后，自动切换账户。本文记录一下设置的详细过程</p><p>感谢以下项目：</p><p><a href="https://github.com/xyou365/AutoRclone" target="_blank" rel="noopener">https://github.com/xyou365/AutoRclone</a></p><p><a href="https://github.com/Spazzlo/folderclone" target="_blank" rel="noopener">https://github.com/Spazzlo/folderclone</a></p><p><a href="https://github.com/donwa/gclone" target="_blank" rel="noopener">https://github.com/donwa/gclone</a></p><h2 id="将实现的功能"><a href="#将实现的功能" class="headerlink" title="将实现的功能"></a>将实现的功能</h2><ul><li>从本地服务器传输到 Google Team Drive</li><li>从他人分享的链接拷贝到 Google Team Drive</li><li>从一个 Google Team Drive 传输到另一个 Google Team Drive</li><li>以上都不受750G流量限制</li></ul><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>一台 VPS服务器，当然在 本地电脑 Windows 上也是可以的，不过本文以 VPS 为例</li><li>一个谷歌账号</li><li>一个 Google Team Drive 账号，如果没有，本文结尾会提供几个免费获取渠道</li></ul><h2 id="大致过程"><a href="#大致过程" class="headerlink" title="大致过程"></a>大致过程</h2><ol><li>安装 Python3 和 AutoRclone</li><li>借助谷歌开发者平台，生成服务账号</li><li>将服务账号 service accounts 加入到 Google Groups</li><li>安装 gclone 进行复制文件</li></ol><h2 id="获取免费Team-Drive"><a href="#获取免费Team-Drive" class="headerlink" title="获取免费Team Drive"></a>获取免费Team Drive</h2><p>这里分享几个分享获取 Team Drive 的网站</p><p>但是注意：</p><p>千万不要在这些 Team Drive 中存放任何重要资料、隐私资料</p><p>没人这些 Team Drive 会不会翻车失效</p><p>地址：</p><div class="hljs"><pre><code class="hljs dts"><span class="hljs-symbol">https:</span><span class="hljs-comment">//gd.404edu.workers.dev/</span><span class="hljs-symbol">http:</span><span class="hljs-comment">//leon.educationhost.cloud/</span></code></pre></div><h2 id="安装详细过程"><a href="#安装详细过程" class="headerlink" title="安装详细过程"></a>安装详细过程</h2><p>以下教程内容基于 Debian10 系统的 VPS 服务器</p><h3 id="安装Python3"><a href="#安装Python3" class="headerlink" title="安装Python3"></a>安装Python3</h3><p>首先删除vps自带的python3.5，可以通过<code>python --version</code> 查看。必须安装python3.6版本以上</p><div class="hljs"><pre><code class="hljs bash">sudo apt updatesudo apt install build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libreadline-dev libffi-dev curlsudo apt autoremove python3.5 python3.5-devsudo curl -O https://www.python.org/ftp/python/3.8.2/Python-3.8.2.tar.xztar -xf Python-3.8.2.tar.xz<span class="hljs-built_in">cd</span> Python-3.8.2./configure --<span class="hljs-built_in">enable</span>-optimizationsmake -j 8<span class="hljs-comment">#For faster build time, modify the -j flag according to your processor. If you do not know the number of cores your processor you can find it by typing nproc. My system has 8 cores, so I am using the -j8 flag.</span>sudo make install</code></pre></div><div class="hljs"><pre><code class="hljs bash"><span class="hljs-comment">#关联python3.8到python命令。如果提示没有不用理会，如果提示有文件路径，用rm -rf删除，比如rm -rf /usr/bin/python</span>ln -s /usr/<span class="hljs-built_in">local</span>/bin/python3.8 /usr/bin/python3ln -s /usr/<span class="hljs-built_in">local</span>/bin/python3.8 /usr/bin/pythonln -s /usr/<span class="hljs-built_in">local</span>/bin/pip3.8 /usr/bin/pipln -s /usr/<span class="hljs-built_in">local</span>/bin/pip3.8 /usr/bin/pip3</code></pre></div><h3 id="安装AutoRclone"><a href="#安装AutoRclone" class="headerlink" title="安装AutoRclone"></a>安装AutoRclone</h3><div class="hljs"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://github.com/xyou365/AutoRclone &amp;&amp; cd AutoRclone &amp;&amp; pip3 install -r requirements.txt</code></pre></div><h3 id="生成Service-Accounts"><a href="#生成Service-Accounts" class="headerlink" title="生成Service Accounts"></a>生成Service Accounts</h3><p>打开链接：<a href="https://developers.google.com/drive/api/v3/quickstart/python" target="_blank" rel="noopener">https://developers.google.com/drive/api/v3/quickstart/python</a></p><p><a href="https://img.uud.me/dispatch/c54a3174f4d6adb40edb1222fad052a5" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/c54a3174f4d6adb40edb1222fad052a5" srcset="/img/loading.gif" alt="1584068507.jpg"></a></p><p><a href="https://img.uud.me/dispatch/c54a3174f4d6adb40edb1222fad052a5" target="_blank" rel="noopener">1584068507.jpg</a></p><p>点击 <strong>Enable the Drive API</strong></p><p>在弹出的窗口中，下载生成的 <code>credentials.json</code>：</p><p><a href="https://img.uud.me/dispatch/a7911ceed8d6a3c4705d18bfbeb9a1fa" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/a7911ceed8d6a3c4705d18bfbeb9a1fa" srcset="/img/loading.gif" alt="1584068583.jpg"></a></p><p><a href="https://img.uud.me/dispatch/a7911ceed8d6a3c4705d18bfbeb9a1fa" target="_blank" rel="noopener">1584068583.jpg</a></p><p>然后将你下载的 <code>credentials.json</code> 放到 AutoRclone 目录下</p><p>这里我用的是 Xshell，可以使用 <code>rz</code> 命令从本地电脑上传文件到 VPS</p><p>首先运行以下命令：</p><div class="hljs"><pre><code class="hljs cmake">apt <span class="hljs-keyword">install</span> lrzsz -y</code></pre></div><p>然后进入 AutoRclone 目录：</p><div class="hljs"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> AutoRclone</code></pre></div><p>然后输入 <code>rz</code> 并按下回车键，此时会 弹出窗口：</p><p><a href="https://img.uud.me/dispatch/a65d5955f9f269b29cdaba3a4427b6ed" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/a65d5955f9f269b29cdaba3a4427b6ed" srcset="/img/loading.gif" alt="1584068909.jpg"></a></p><p>找到你的 <code>credentials.json</code>，点击然后打开就会上传</p><p>上传完毕后，输入 <code>ls</code> 可以看到：</p><p><a href="https://img.uud.me/dispatch/105d1df09048705968609394d1bc7156" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" srcset="/img/loading.gif" alt="1584069078.jpg"></a><img src="https://ae01.alicdn.com/kf/U85be469a070f4a53bad1b7d04bc32a35Z.png" srcset="/img/loading.gif" alt=""></p><p>然后需要分三种情况：</p><h4 id="1、之前没有创建过项目"><a href="#1、之前没有创建过项目" class="headerlink" title="1、之前没有创建过项目"></a>1、之前没有创建过项目</h4><p>直接运行：</p><div class="hljs"><pre><code class="hljs vim"><span class="hljs-keyword">python3</span> gen_sa_accounts.<span class="hljs-keyword">py</span> --quick-setup <span class="hljs-number">1</span></code></pre></div><p>以上命令含义：</p><ul><li>创建1个项目</li><li>开启相关的服务</li><li>创建100个 service accounts</li><li>将100个 service accounts 的授权文件下载到 accounts 文件夹下面</li></ul><h4 id="2、已有项目，需要创建新的"><a href="#2、已有项目，需要创建新的" class="headerlink" title="2、已有项目，需要创建新的"></a>2、已有项目，需要创建新的</h4><div class="hljs"><pre><code class="hljs vim"><span class="hljs-keyword">python3</span> gen_sa_accounts.<span class="hljs-keyword">py</span> --quick-setup <span class="hljs-number">2</span> --<span class="hljs-keyword">new</span>-<span class="hljs-keyword">only</span></code></pre></div><p>以上命令含义：</p><ul><li>额外创建2个项目（项目N+1到项目N+2）</li><li>开启相关的服务</li><li>创建200个 service accounts（2个项目，每个项目100个）</li><li>将200个 service accounts 的授权文件下载到 accounts 文件夹下面</li></ul><h4 id="3、使用已有项目，不创建新的"><a href="#3、使用已有项目，不创建新的" class="headerlink" title="3、使用已有项目，不创建新的"></a>3、使用已有项目，不创建新的</h4><div class="hljs"><pre><code class="hljs vim"><span class="hljs-keyword">python3</span> gen_sa_accounts.<span class="hljs-keyword">py</span> --quick-setup -<span class="hljs-number">1</span></code></pre></div><p>以上命令会覆盖掉已有的 service accounts</p><p>我这里是第一种情况，运行 <code>python3 gen_sa_accounts.py --quick-setup 1</code></p><p>如下图，浏览器打开返回的链接：</p><p><a href="https://img.uud.me/dispatch/325ed345db0b35b868b55dbe2bccdf42" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" srcset="/img/loading.gif" alt="1584069533.jpg"></a></p><p><img src="https://ae01.alicdn.com/kf/Uf2c64218e6ed4408adb7974c0df4e091x.png" srcset="/img/loading.gif" alt=""></p><p>登录拥有 Team Drive 账号的谷歌账户：</p><p><a href="https://img.uud.me/dispatch/bac40a663ce22734d1f781730db373f2" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" srcset="/img/loading.gif" alt="1584069580.jpg"></a></p><p><img src="https://ae01.alicdn.com/kf/Ufbe6fe2734674b49bc0e20650381a313W.png" srcset="/img/loading.gif" alt=""></p><p>选择 <strong>允许</strong>：</p><p><a href="https://img.uud.me/dispatch/683999333edcc2dc77ebee58a590f8bb" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" srcset="/img/loading.gif" alt="1584069629.jpg"></a></p><p><img src="https://ae01.alicdn.com/kf/U91f23f41529440d3a61c9135c71116f49.png" srcset="/img/loading.gif" alt="[1584069629.jpg](https://img.uud.me/dispatch/683999333edcc2dc77ebee58a590f8bb)"></p><p>复制返回的代码，粘贴到 Xshell 会话窗口：</p><p><a href="https://img.uud.me/dispatch/c87eef8b24be14a40bd46d9e1b4c9c92" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" srcset="/img/loading.gif" alt="1584070486.jpg"></a></p><p><img src="https://img.uud.me/dispatch/c87eef8b24be14a40bd46d9e1b4c9c92" srcset="/img/loading.gif" alt="[1584070486.jpg](https://img.uud.me/dispatch/c87eef8b24be14a40bd46d9e1b4c9c92)"></p><p>粘贴后回车：</p><p><a href="https://img.uud.me/dispatch/6eaee368d343a0f9f4e5870786a388d4" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/6eaee368d343a0f9f4e5870786a388d4" srcset="/img/loading.gif" alt="1584070586.jpg"></a></p><p><a href="https://img.uud.me/dispatch/6eaee368d343a0f9f4e5870786a388d4" target="_blank" rel="noopener">1584070586.jpg</a></p><p>如果回车后，你看到如上图的提示，原因是谷歌账号未开启 <strong>Service Usage API</strong></p><p>复制打开提供的链接地址，到浏览器打开，注意是<strong>登录你刚刚授权的谷歌账户</strong>，然后点击启用：</p><p><a href="https://img.uud.me/dispatch/0c27c460ce7febd6303628ff523d2b2a" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/0c27c460ce7febd6303628ff523d2b2a" srcset="/img/loading.gif" alt="1584070521.jpg"></a></p><p><a href="https://img.uud.me/dispatch/0c27c460ce7febd6303628ff523d2b2a" target="_blank" rel="noopener">1584070521.jpg</a></p><p>启用成功后，回到 Xshell 会话窗口，点击回车，之后就会显示类似下图内容：</p><p><a href="https://img.uud.me/dispatch/d17fc4519349b1a6148ec428b162d15f" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/d17fc4519349b1a6148ec428b162d15f" srcset="/img/loading.gif" alt="1584070733.jpg"></a></p><p><a href="https://img.uud.me/dispatch/d17fc4519349b1a6148ec428b162d15f" target="_blank" rel="noopener">1584070733.jpg</a></p><p>此时就需要耐心等待</p><p>之后进入 accounts 文件夹下，会看到非常多的 <code>.json</code> 后缀文件：</p><p><a href="https://img.uud.me/dispatch/f405ea9f908723a5f0f8299f07d9a6b1" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/f405ea9f908723a5f0f8299f07d9a6b1" srcset="/img/loading.gif" alt="1584070979.jpg"></a></p><p><a href="https://img.uud.me/dispatch/f405ea9f908723a5f0f8299f07d9a6b1" target="_blank" rel="noopener">1584070979.jpg</a></p><h3 id="将service-accounts加入Google-Groups"><a href="#将service-accounts加入Google-Groups" class="headerlink" title="将service accounts加入Google Groups"></a>将service accounts加入Google Groups</h3><p>此为可选操作，但建议操作</p><p>算是整个过程里最麻烦的步骤了</p><p>这个步骤也分两种情况</p><ul><li>你的账户是普通 Google 账户</li><li>你的账户是 G Suite 管理员</li></ul><p>如果是管理员，这一个步骤还是比较快速的</p><p>但是如果你只是免费领取的 Google Team Drive 账户，那就比较麻烦</p><p>我们这一步需要将刚刚生成的数以百计的 Service Accounts 添加到 Google Group 中</p><p>而且，<strong>每次只能加10个，每24小时只能加100个</strong></p><p>所以……</p><p>以下为普通账户的操作</p><h4 id="创建Google-Group"><a href="#创建Google-Group" class="headerlink" title="创建Google Group"></a>创建Google Group</h4><p>打开链接：<a href="https://groups.google.com/" target="_blank" rel="noopener">https://groups.google.com/</a></p><p>创建群组：</p><p><a href="https://img.uud.me/dispatch/dcdb8dd18795d1c23a49e695967c61fe" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/dcdb8dd18795d1c23a49e695967c61fe" srcset="/img/loading.gif" alt="1584071501.jpg"></a></p><p><a href="https://img.uud.me/dispatch/dcdb8dd18795d1c23a49e695967c61fe" target="_blank" rel="noopener">1584071501.jpg</a></p><p>填写群组信息：</p><p><a href="https://img.uud.me/dispatch/13c751ad917f3417ec9a0622fb1a81b0" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/13c751ad917f3417ec9a0622fb1a81b0" srcset="/img/loading.gif" alt="1584071544.jpg"></a></p><p><a href="https://img.uud.me/dispatch/13c751ad917f3417ec9a0622fb1a81b0" target="_blank" rel="noopener">1584071544.jpg</a></p><h4 id="批量提取-Service-Accounts"><a href="#批量提取-Service-Accounts" class="headerlink" title="批量提取 Service Accounts"></a>批量提取 Service Accounts</h4><p>数百个账户一个个复制实在太慢，我们需要借助一个 Chrome 插件：</p><p><a href="https://chrome.google.com/webstore/detail/email-extractor/fgcoaakamhopmbbbllmpocacgkhjhmbp?hl=zh-CN" target="_blank" rel="noopener">https://chrome.google.com/webstore/detail/email-extractor/fgcoaakamhopmbbbllmpocacgkhjhmbp?hl=zh-CN</a></p><p>安装以上插件，然后打开这个链接：<a href="https://console.cloud.google.com/iam-admin/serviceaccounts" target="_blank" rel="noopener">https://console.cloud.google.com/iam-admin/serviceaccounts</a></p><p>如下图：</p><p><a href="https://img.uud.me/dispatch/bf0627f4cf9b51c36cfb3462cb70d8ed" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/bf0627f4cf9b51c36cfb3462cb70d8ed" srcset="/img/loading.gif" alt="1584072101.jpg"></a></p><p><a href="https://img.uud.me/dispatch/bf0627f4cf9b51c36cfb3462cb70d8ed" target="_blank" rel="noopener">1584072101.jpg</a></p><p>然后这个页面就会显示你刚刚创建的 Service Accounts 账户</p><p>然后我们就可以通过刚刚安装的插件，批量获取到这些邮箱：</p><p><a href="https://img.uud.me/dispatch/0f5685f31d7bdbd79f82586baa2e7a10" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/0f5685f31d7bdbd79f82586baa2e7a10" srcset="/img/loading.gif" alt="1584072179.jpg"></a></p><p><a href="https://img.uud.me/dispatch/0f5685f31d7bdbd79f82586baa2e7a10" target="_blank" rel="noopener">1584072179.jpg</a></p><p>我们可以以 txt 格式下载这些邮箱，注意这里会将你自己的谷歌账户邮箱也提取出来</p><p>或者用我写的Python脚本读取credentials.json并处理出邮箱列表：</p><div class="hljs"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<span class="hljs-keyword">import</span> json<span class="hljs-comment">#analysis_root_dir改成你的credentials.json位置，store_result改成储存位置。输出结果为10个一组邮箱</span>analysis_root_dir = <span class="hljs-string">r"c:\Users\Administrator\Desktop\accounts"</span>store_result=<span class="hljs-string">r"c:\Users\Administrator\Desktop\accounts\dependency.txt"</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_dir</span><span class="hljs-params">(root_dir)</span>:</span>    path = Path(root_dir)    all_json_file = list(path.glob(<span class="hljs-string">'**/*.json'</span>))    parse_result = []    <span class="hljs-keyword">for</span> json_file <span class="hljs-keyword">in</span> all_json_file:        <span class="hljs-comment"># 获取所在目录的名称</span>        service_name = json_file.parent.stem        <span class="hljs-keyword">with</span> json_file.open() <span class="hljs-keyword">as</span> f:            json_result = json.load(f)        json_result[<span class="hljs-string">"service_name"</span>] = service_name        parse_result.append(json_result)    <span class="hljs-keyword">return</span>  parse_result<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_result_in_file</span><span class="hljs-params">(write_path , write_content)</span>:</span>    counter=<span class="hljs-number">0</span>    <span class="hljs-keyword">with</span> open(write_path,<span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:        <span class="hljs-keyword">for</span> dict_content <span class="hljs-keyword">in</span> write_content:             url = dict_content[<span class="hljs-string">'client_email'</span>]             f.writelines(url+<span class="hljs-string">","</span>)             counter+=<span class="hljs-number">1</span>             <span class="hljs-keyword">if</span> counter%<span class="hljs-number">10</span>==<span class="hljs-number">0</span>:                    f.writelines(<span class="hljs-string">"\n\n"</span>)            <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>    print(<span class="hljs-string">"main begin..."</span>)    parse_result = parse_dir(analysis_root_dir)    write_result_in_file(store_result,parse_result)    print(<span class="hljs-string">"main finished..."</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:    main()</code></pre></div><h4 id="添加到Group"><a href="#添加到Group" class="headerlink" title="添加到Group"></a>添加到Group</h4><p>Group 已经创建，Service Accounts 邮箱也已经获取，现在我们将这些邮箱添加到 Group 中</p><p>注意每次只能添加10个，每24小时只能添加100个</p><p>回到 Group 页面，右上角 <strong>管理成员</strong>：</p><p><a href="https://img.uud.me/dispatch/239ef1a1750065759f9c36839616d970" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/239ef1a1750065759f9c36839616d970" srcset="/img/loading.gif" alt="1584071713.jpg"></a></p><p><a href="https://img.uud.me/dispatch/239ef1a1750065759f9c36839616d970" target="_blank" rel="noopener">1584071713.jpg</a></p><p>左侧 <strong>直接添加成员</strong>，将 Service Accounts 邮箱复制粘贴10个，点击 <strong>添加</strong>：</p><p><a href="https://img.uud.me/dispatch/5034c7e59985c81112f375313d8d44a6" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/5034c7e59985c81112f375313d8d44a6" srcset="/img/loading.gif" alt="1584072420.jpg"></a></p><p><a href="https://img.uud.me/dispatch/5034c7e59985c81112f375313d8d44a6" target="_blank" rel="noopener">1584072420.jpg</a></p><p>重复以上步骤，将100个邮箱添加进去：</p><p><a href="https://img.uud.me/dispatch/5cb4d367590fbb0b6ec9749b138f7094" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" srcset="/img/loading.gif" alt="1584077562.jpg"></a></p><p><img src="https://img.uud.me/dispatch/5cb4d367590fbb0b6ec9749b138f7094" srcset="/img/loading.gif" alt="[1584077562.jpg](https://img.uud.me/dispatch/5cb4d367590fbb0b6ec9749b138f7094)"></p><p>累了累了……</p><h4 id="Group邮箱添加到Team-Drive"><a href="#Group邮箱添加到Team-Drive" class="headerlink" title="Group邮箱添加到Team Drive"></a>Group邮箱添加到Team Drive</h4><p>如下图：</p><p><a href="https://img.uud.me/dispatch/5a41931bf25e46434b09932f52f5db8c" target="_blank" rel="noopener"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=" srcset="/img/loading.gif" alt="1584077685.jpg"></a></p><p><img src="https://img.uud.me/dispatch/5a41931bf25e46434b09932f52f5db8c" srcset="/img/loading.gif" alt="[1584077685.jpg](https://img.uud.me/dispatch/5a41931bf25e46434b09932f52f5db8c)"></p><p>找到群组邮箱：</p><p><a href="https://img.uud.me/dispatch/1f404803798d7117ac5d274fd8c6160d" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/1f404803798d7117ac5d274fd8c6160d" srcset="/img/loading.gif" alt="1584077716.jpg"></a></p><p><a href="https://img.uud.me/dispatch/1f404803798d7117ac5d274fd8c6160d" target="_blank" rel="noopener">1584077716.jpg</a></p><p>将这个邮箱添加到你的 Google Team Drive 中：</p><p><a href="https://img.uud.me/dispatch/2f13f502e19070a22054245faf201d4f" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/2f13f502e19070a22054245faf201d4f" srcset="/img/loading.gif" alt="1584077784.jpg"></a></p><p><a href="https://img.uud.me/dispatch/2f13f502e19070a22054245faf201d4f" target="_blank" rel="noopener">1584077784.jpg</a></p><p><a href="https://img.uud.me/dispatch/f430c71c70ca7a8622c161c39acc4c69" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/f430c71c70ca7a8622c161c39acc4c69" srcset="/img/loading.gif" alt="1584077818.jpg">1584077818.jpg</a></p><p>添加完成后，基本就完成所有设置了</p><h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><h3 id="直接使用"><a href="#直接使用" class="headerlink" title="直接使用"></a>直接使用</h3><p>首先将 service accounts 加入到目标Team Drive</p><div class="hljs"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span> <span class="hljs-string">/root/AutoRclone</span><span class="hljs-comment">#将以下SharedTeamDriveDstID替换为你团队盘ID，如果添加进group，不需要这一步 </span>python3 add_to_team_drive.py -d SharedTeamDriveDstID</code></pre></div><p>查看团队盘ID：</p><p>打开你的团队盘，查看浏览器上的链接，比如：</p><div class="hljs"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>drive.google.com<span class="hljs-regexp">/drive/u</span><span class="hljs-regexp">/2/</span>folders<span class="hljs-regexp">/0App-QeDCIy_mUk9PVA</span></code></pre></div><p>以上链接中，<code>0App-QeDCIy_mUk9PVA</code> 就是ID</p><p>那么就应该运行命令：</p><div class="hljs"><pre><code class="hljs vim"><span class="hljs-keyword">python3</span> add_to_team_drive.<span class="hljs-keyword">py</span> -d <span class="hljs-number">0</span>App-QeDCIy_mUk9PVA</code></pre></div><p>回车后，再次回车：</p><p><a href="https://img.uud.me/dispatch/ba73fb3a982693d7e2308b8b9d4a91ae" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/ba73fb3a982693d7e2308b8b9d4a91ae" srcset="/img/loading.gif" alt="1584082783.jpg"></a></p><p><a href="https://img.uud.me/dispatch/ba73fb3a982693d7e2308b8b9d4a91ae" target="_blank" rel="noopener">1584082783.jpg</a></p><p>之后我们就可以使用了</p><p>详细的使用命令可以看这里：<a href="https://github.com/xyou365/AutoRclone#step-5-start-your-task" target="_blank" rel="noopener">https://github.com/xyou365/AutoRclone#step-5-start-your-task</a></p><div class="hljs"><pre><code class="hljs angelscript">https:<span class="hljs-comment">//drive.google.com/drive/u/2/folders/10zOvIf8yBmIuZgBfC3rcDKWHIlODZjXF</span>python3 rclone_sa_magic.py -s <span class="hljs-number">10</span>zOvIf8yBmIuZgBfC3rcDKWHIlODZjXF -d <span class="hljs-number">0</span>AMp-QeDCIy_mUk9PVA -dp InSide.No<span class="hljs-number">.09</span> -b <span class="hljs-number">1</span> -e <span class="hljs-number">600</span> --drive-server-side-across-configs</code></pre></div><p>以上命令是将共享链接里的文件保存到自己的 Team Drive</p><h3 id="配合Gclone使用"><a href="#配合Gclone使用" class="headerlink" title="配合Gclone使用"></a>配合Gclone使用</h3><p>gclone 其实就是 rclone 的加强版，为Google Drive 操作增加自动切换账户和命令行根目录id操作支持</p><p>其他功能与原版 rclone 相同</p><h4 id="安装gclone"><a href="#安装gclone" class="headerlink" title="安装gclone"></a>安装gclone</h4><div class="hljs"><pre><code class="hljs lisp">bash &lt;(<span class="hljs-name">wget</span> -qO- https<span class="hljs-symbol">://git</span>.io/gclone.sh)</code></pre></div><p>然后就安装完成了</p><p>你可以选择将 gclone 重命名为 rclone，方便使用：<code>cp /usr/bin/gclone /usr/bin/rclone</code></p><p>以下内容都是以没有重命名为例，如果你进行了重命名，将以下命令中出现的<code>gclone</code> 改为 <code>rclone</code></p><h4 id="配置gclone"><a href="#配置gclone" class="headerlink" title="配置gclone"></a>配置gclone</h4><p>首先需要先记下 <code>/root/AutoRclone/accounts/</code>中的其中一个文件：</p><div class="hljs"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">ls</span> <span class="hljs-string">/root/AutoRclone/accounts</span></code></pre></div><p>回车后会显示很多 <code>.json</code> 后缀的文件名，复制其中一个文件名，记下文件路径，比如：</p><div class="hljs"><pre><code class="hljs llvm">/root/AutoRclone/accounts/<span class="hljs-number">7</span><span class="hljs-keyword">c</span><span class="hljs-number">3</span><span class="hljs-keyword">c</span><span class="hljs-number">53023</span>d<span class="hljs-number">06</span>ae<span class="hljs-number">8688084</span><span class="hljs-keyword">c</span><span class="hljs-number">82</span>f<span class="hljs-number">507480</span><span class="hljs-keyword">c</span><span class="hljs-number">878</span>a<span class="hljs-number">422</span><span class="hljs-keyword">c</span>.json</code></pre></div><p>然后进行 gclone 的配置</p><p>gclone 在使用上跟 rclone 是一致的，配置过程也几乎一样</p><p>运行以下命令进行配置：</p><div class="hljs"><pre><code class="hljs arduino">gclone <span class="hljs-built_in">config</span></code></pre></div><div class="hljs"><pre><code class="hljs bash">n) New remotes) Set configuration passwordq) Quit confign/s/q&gt; n   <span class="hljs-comment"># 输入n回车，新建配置</span>name&gt; GD   <span class="hljs-comment"># 新建配置的名称，自行设定</span>Type of storage to configure.Enter a string value. Press Enter <span class="hljs-keyword">for</span> the default (<span class="hljs-string">""</span>).Choose a number from below, or <span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> your own value 1 / 1Fichier   \ <span class="hljs-string">"fichier"</span> 2 / Alias <span class="hljs-keyword">for</span> an existing remote   \ <span class="hljs-string">"alias"</span> 3 / Amazon Drive   \ <span class="hljs-string">"amazon cloud drive"</span> 4 / Amazon S3 Compliant Storage Provider (AWS, Alibaba, Ceph, Digital Ocean, Dreamhost, IBM COS, Minio, etc)   \ <span class="hljs-string">"s3"</span> 5 / Backblaze B2   \ <span class="hljs-string">"b2"</span> 6 / Box   \ <span class="hljs-string">"box"</span> 7 / Cache a remote   \ <span class="hljs-string">"cache"</span> 8 / Dropbox   \ <span class="hljs-string">"dropbox"</span> 9 / Encrypt/Decrypt a remote   \ <span class="hljs-string">"crypt"</span>10 / FTP Connection   \ <span class="hljs-string">"ftp"</span>11 / Google Cloud Storage (this is not Google Drive)   \ <span class="hljs-string">"google cloud storage"</span>12 / Google Drive   \ <span class="hljs-string">"drive"</span>13 / Google Photos   \ <span class="hljs-string">"google photos"</span>14 / Hubic   \ <span class="hljs-string">"hubic"</span>15 / JottaCloud   \ <span class="hljs-string">"jottacloud"</span>16 / Koofr   \ <span class="hljs-string">"koofr"</span>17 / Local Disk   \ <span class="hljs-string">"local"</span>18 / Mega   \ <span class="hljs-string">"mega"</span>19 / Microsoft Azure Blob Storage   \ <span class="hljs-string">"azureblob"</span>20 / Microsoft OneDrive   \ <span class="hljs-string">"onedrive"</span>21 / OpenDrive   \ <span class="hljs-string">"opendrive"</span>22 / Openstack Swift (Rackspace Cloud Files, Memset Memstore, OVH)   \ <span class="hljs-string">"swift"</span>23 / Pcloud   \ <span class="hljs-string">"pcloud"</span>24 / Put.io   \ <span class="hljs-string">"putio"</span>25 / QingCloud Object Storage   \ <span class="hljs-string">"qingstor"</span>26 / SSH/SFTP Connection   \ <span class="hljs-string">"sftp"</span>27 / Union merges the contents of several remotes   \ <span class="hljs-string">"union"</span>28 / Webdav   \ <span class="hljs-string">"webdav"</span>29 / Yandex Disk   \ <span class="hljs-string">"yandex"</span>30 / http Connection   \ <span class="hljs-string">"http"</span>31 / premiumize.me   \ <span class="hljs-string">"premiumizeme"</span>Storage&gt; 12       <span class="hljs-comment"># 选择需要挂载的网盘类型</span>** See <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> drive backend at: https://rclone.org/drive/ **Google Application Client IdSetting your own is recommended.See https://rclone.org/drive/<span class="hljs-comment">#making-your-own-client-id for how to create your own.</span>If you leave this blank, it will use an internal key <span class="hljs-built_in">which</span> is low performance.Enter a string value. Press Enter <span class="hljs-keyword">for</span> the default (<span class="hljs-string">""</span>).client_id&gt;        <span class="hljs-comment"># 默认直接回车，或者输入自己的OAuth ID</span>Google Application Client SecretSetting your own is recommended.Enter a string value. Press Enter <span class="hljs-keyword">for</span> the default (<span class="hljs-string">""</span>).client_secret&gt;    <span class="hljs-comment"># 默认直接回车，或者输入自己的OAuth秘锁</span>Scope that rclone should use when requesting access from drive.Enter a string value. Press Enter <span class="hljs-keyword">for</span> the default (<span class="hljs-string">""</span>).Choose a number from below, or <span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> your own value 1 / Full access all files, excluding Application Data Folder.   \ <span class="hljs-string">"drive"</span> 2 / Read-only access to file metadata and file contents.   \ <span class="hljs-string">"drive.readonly"</span>   / Access to files created by rclone only. 3 | These are visible <span class="hljs-keyword">in</span> the drive website.   | File authorization is revoked when the user deauthorizes the app.   \ <span class="hljs-string">"drive.file"</span>   / Allows <span class="hljs-built_in">read</span> and write access to the Application Data folder. 4 | This is not visible <span class="hljs-keyword">in</span> the drive website.   \ <span class="hljs-string">"drive.appfolder"</span>   / Allows <span class="hljs-built_in">read</span>-only access to file metadata but 5 | does not allow any access to <span class="hljs-built_in">read</span> or download file content.   \ <span class="hljs-string">"drive.metadata.readonly"</span>scope&gt; 1 <span class="hljs-comment"># 选择1然后回车</span>ID of the root folderLeave blank normally.Fill <span class="hljs-keyword">in</span> to access <span class="hljs-string">"Computers"</span> folders (see docs), or <span class="hljs-keyword">for</span> rclone to usea non root folder as its starting point.Note that <span class="hljs-keyword">if</span> this is blank, the first time rclone runs it will fill it<span class="hljs-keyword">in</span> with the ID of the root folder.Enter a string value. Press Enter <span class="hljs-keyword">for</span> the default (<span class="hljs-string">""</span>).root_folder_id&gt;        <span class="hljs-comment"># 直接回车</span>Service Account Credentials JSON file path Leave blank normally.Needed only <span class="hljs-keyword">if</span> you want use SA instead of interactive login.Enter a string value. Press Enter <span class="hljs-keyword">for</span> the default (<span class="hljs-string">""</span>).service_account_file&gt; <span class="hljs-comment"># 直接回车，如果使用Service Account就填写其中一个文件的绝对路径即可：/root/AutoRclone/accounts/0a5af037763bdab70e3a7094d02ec4bd37f8db94.json</span>Service Account Credentials JSON file path .Enter a string value. Press Enter <span class="hljs-keyword">for</span> the default (<span class="hljs-string">""</span>).service_account_file_path&gt; 直接回车，如果使用Service Account就填写这个路径：/root/AutoRclone/accounts/Edit advanced config? (y/n)y) Yesn) No (default)y/n&gt; n                    <span class="hljs-comment"># 选择n 不使用高级配置</span>Remote configConfigure this as a team drive?y) Yesn) No (default)y/n&gt; y                     <span class="hljs-comment"># 选择n不加载团队盘，选择y加载团队盘</span>Fetching team drive list...Choose a number from below, or <span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> your own value 1 / 网盘01   \ <span class="hljs-string">"0AFZFXMn1uKs2Uk9PVA"</span> 2 / 网盘05   \ <span class="hljs-string">"0AI3nH3Vf8NWIUk9PVA"</span> 3 / 网盘02   \ <span class="hljs-string">"0ADYACmKjlU3JUk9PVA"</span>Enter a Team Drive ID&gt; <span class="hljs-comment"># 选择你的团队盘编号</span>y) Yes this is OKe) Edit this remoted) Delete this remotey/e/d&gt; y       <span class="hljs-comment"># 选择y回车</span>Current remotes:Name                 Type====                 ====网盘01             drivee) Edit existing remoten) New remoted) Delete remoter) Rename remotec) Copy remotes) Set configuration passwordq) Quit confige/n/d/r/c/s/q&gt; q   <span class="hljs-comment"># 输入q回车，保存配置退出</span></code></pre></div><p>配置过程中，需要注意的是，当出现 <code>service_account_file</code> 选项时，填入以上记下的 <code>.json</code> 文件</p><p>当出现 <code>service_account_file_path</code> 时，填入 <code>/root/AutoRclone/accounts/</code></p><p><a href="https://img.uud.me/dispatch/7261c1657c571f7d077de3d6dcdc5268" target="_blank" rel="noopener"><img src="https://img.uud.me/dispatch/7261c1657c571f7d077de3d6dcdc5268" srcset="/img/loading.gif" alt="1584103752.jpg"></a></p><p><a href="https://img.uud.me/dispatch/7261c1657c571f7d077de3d6dcdc5268" target="_blank" rel="noopener">1584103752.jpg</a></p><p>之后就配置完成了</p><h4 id="使用gclone复制文件"><a href="#使用gclone复制文件" class="headerlink" title="使用gclone复制文件"></a>使用gclone复制文件</h4><p>作者 Github 提供的文档：<a href="https://github.com/donwa/gclone/blob/master/README_zh.md" target="_blank" rel="noopener">https://github.com/donwa/gclone/blob/master/README_zh.md</a></p><p>简单记录常用命令</p><h5 id="复制共享链接文件到团队盘"><a href="#复制共享链接文件到团队盘" class="headerlink" title="复制共享链接文件到团队盘"></a>复制共享链接文件到团队盘</h5><div class="hljs"><pre><code class="hljs applescript">gclone <span class="hljs-keyword">copy</span> edugd:&#123;目录<span class="hljs-built_in">id</span>&#125; edugd:&#123;目录<span class="hljs-built_in">id</span>&#125; <span class="hljs-comment">--drive-server-side-across-configs -v</span></code></pre></div><p>以上命令中，<code>edugd</code> 是你配置 gclone 时设置的 <code>name</code>（可以通过rclone config 查看）</p><div class="hljs"><pre><code class="hljs awk">目录id` 是共享链接中链接中的最后部分，比如：`https:<span class="hljs-regexp">//</span>drive.google.com<span class="hljs-regexp">/drive/u</span><span class="hljs-regexp">/2/</span>folders<span class="hljs-regexp">/10zOvIf8yBmIuZgBfC3rcDKWHIlODZjXF</span></code></pre></div><p><code>10zOvIf8yBmIuZgBfC3rcDKWHIlODZjXF</code> 就是目录id</p><p><code>--drive-server-side-across-configs</code> 用于谷歌盘之间传输时使用，不走服务器流量，传输速度也更快</p><p><code>-v</code> 用于查看传输过程的速度</p><p>命令使用示例：</p><div class="hljs"><pre><code class="hljs angelscript">gclone copy edugd:&#123;<span class="hljs-number">10</span>zOvIf8yBmIuZgBfC3rcDKWHIlODZjXF&#125; edugd:&#123;<span class="hljs-number">1</span>j4z3UH1thdNB8dOhTUgb0uRHxQaDYL1T&#125; --drive-server-side-across-configs -v</code></pre></div><p>目标位置除了使用 <code>id</code> 外，也可以直接使用目录，比如：</p><div class="hljs"><pre><code class="hljs groovy">gclone copy <span class="hljs-string">edugd:</span>&#123;<span class="hljs-number">10</span>zOvIf8yBmIuZgBfC3rcDKWHIlODZjXF&#125; <span class="hljs-string">edugd:</span>Movie-TV<span class="hljs-regexp">/剧集/</span>日韩/王国-李尸王朝 --drive-server-side-across-configs -v</code></pre></div><h5 id="传输本地文件到团队盘"><a href="#传输本地文件到团队盘" class="headerlink" title="传输本地文件到团队盘"></a>传输本地文件到团队盘</h5><div class="hljs"><pre><code class="hljs gradle">gclone <span class="hljs-keyword">copy</span> <span class="hljs-regexp">/root/</span>Downloads<span class="hljs-regexp">/王国-李尸王朝 edugd:Movie-TV/</span>剧集<span class="hljs-regexp">/日韩/</span>王国-李尸王朝 -v</code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>建立google driver在线目录goindex</title>
    <link href="/posts/e222848c.html"/>
    <url>/posts/e222848c.html</url>
    
    <content type="html"><![CDATA[<h2 id="建立-GoIndex-无服务器架构-Google-Drive-目录索引和Cloudflare-自定义ip加速访问"><a href="#建立-GoIndex-无服务器架构-Google-Drive-目录索引和Cloudflare-自定义ip加速访问" class="headerlink" title="建立 GoIndex - 无服务器架构 Google Drive 目录索引和Cloudflare 自定义ip加速访问"></a>建立 GoIndex - 无服务器架构 Google Drive 目录索引和Cloudflare 自定义ip加速访问</h2><h3 id="1-在线建立GoIndex或者自建服务"><a href="#1-在线建立GoIndex或者自建服务" class="headerlink" title="1.在线建立GoIndex或者自建服务"></a>1.在线建立GoIndex或者自建服务</h3><h4 id="1-1参考github项目教程。"><a href="#1-1参考github项目教程。" class="headerlink" title="1.1参考github项目教程。"></a>1.1参考<a href="https://github.com/donwa/goindex" target="_blank" rel="noopener">github项目教程</a>。</h4><h4 id="1-2参考p3terx教程。"><a href="#1-2参考p3terx教程。" class="headerlink" title="1.2参考p3terx教程。"></a>1.2参考<a href="https://p3terx.com/archives/goindex-google-drive-directory-index.html" target="_blank" rel="noopener">p3terx教程</a>。</h4><p>​ 1.2为自己利用Google Drive API自建程序，两者效果一样。<strong>注意</strong>：教育邮箱无限网盘一般不能采用1.2方法；rclone建议用gclone代替，一样的运行命令。</p><h3 id="2-Cloudflare-自定义ip加速访问"><a href="#2-Cloudflare-自定义ip加速访问" class="headerlink" title="2.Cloudflare 自定义ip加速访问"></a>2.Cloudflare 自定义ip加速访问</h3><p>因为Cloudflare默认情况下访问慢，可以采用Cloudflare自定义ip方法解决，某些国内线路可以跑满带宽。本教程提供的设置方法只适合于建立GoIndex，不适合建站，建站的设置方法自己查找。</p><p><img src="https://raw.githubusercontent.com/anonymous12357/BL/master/photos/%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B-768x519.png" srcset="/img/loading.gif" alt=""></p><h4 id="2-1CloudFlare-Partner-添加域名"><a href="#2-1CloudFlare-Partner-添加域名" class="headerlink" title="2.1CloudFlare Partner 添加域名"></a>2.1CloudFlare Partner 添加域名</h4><p>​ 首先找一个 CloudFlare Partner 添加域名（需要添加根域名，可以自己去freenom注册个免费域名，如果freenom无法注册请参考<a href="https://www.365tol.top/post/595.html" target="_blank" rel="noopener">这篇文章</a>，或者拿新的域名，不建议使用其他已经设置的域名。已经在CloudFlare设置的域名无法使用CloudFlare Partner高级功能）。推荐2个登录方式，一样的设置：<a href="https://cdn.bnxb.com/" target="_blank" rel="noopener">笨牛网</a>；<a href="https://cdn.wzfou.com/" target="_blank" rel="noopener">挖站否</a>。用挖站否为例：</p><p><img src="https://raw.githubusercontent.com/anonymous12357/BL/master/photos/Snipaste_2020-03-13_21-07-36.png" srcset="/img/loading.gif" alt="https://raw.githubusercontent.com/anonymous12357/BL/master/photos/Snipaste_2020-03-13_21-07-36.png"></p><p>只添加二级域名就可以，有几个GoIndex就添加几个二级域名，要添加CNAME类型，如图。主机内容随便填（原因看1.2 GoIndex教程），我用www.cloudflare.com。</p><h4 id="2-2注册华为云国际版，设置解析方法。"><a href="#2-2注册华为云国际版，设置解析方法。" class="headerlink" title="2.2注册华为云国际版，设置解析方法。"></a>2.2注册华为云国际版，设置解析方法。</h4><p>​ 修改freenom注册域名的DNS的解析服务器地址。我选择<a href="https://www.huaweicloud.com/intl/zh-cn/product/dns.html" target="_blank" rel="noopener">注册华为云国际版解析服务</a>，因为dnspod等国内解析现在都要实名制。注册完华为云，将freenom的nameserver值，填写以下任意2个</p><div class="hljs"><pre><code class="hljs css"><span class="hljs-selector-tag">ns1</span><span class="hljs-selector-class">.huaweicloud-dns</span><span class="hljs-selector-class">.org</span>，<span class="hljs-selector-tag">ns1</span><span class="hljs-selector-class">.huaweicloud-dns</span><span class="hljs-selector-class">.net</span>，<span class="hljs-selector-tag">ns1</span><span class="hljs-selector-class">.huaweicloud-dns</span><span class="hljs-selector-class">.cn</span>，<span class="hljs-selector-tag">ns1</span><span class="hljs-selector-class">.huaweicloud-dns</span><span class="hljs-selector-class">.com</span>。</code></pre></div><p>在华为云添加域名解析根域名后，比如添加一个二级域名teamdriver.xxx.xx。首先选择CNAME方式，线路是全网默认，值是2.1步骤图片显示的下面对应域名的CNAME值。然后添加A值，线路是你自已任意选的优化方式，ip是你能解析CloudFlare服务器最快的地址。这个地址来源可以查看这个<a href="https://luotianyi.vc/3258.html" target="_blank" rel="noopener">网页介绍</a>，我直接将网页中的bat脚本地址发出来：<strong>Windows Bat</strong>：<a href="https://static.lty.fun/其他资源/CF/colo.bat" target="_blank" rel="noopener">点击下载</a>。直接下载运行，任选一个ip，ping以下看效果填入。</p><p><img src="https://raw.githubusercontent.com/anonymous12357/BL/master/photos/Snipaste_2020-03-13_21-24-35.png" srcset="/img/loading.gif" alt=""></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>speedtest回程测速方法</title>
    <link href="/posts/17de76dc.html"/>
    <url>/posts/17de76dc.html</url>
    
    <content type="html"><![CDATA[<div class="hljs"><pre><code class="hljs avrasm">wget -O speedtest-<span class="hljs-keyword">cli</span> https://raw.githubusercontent.com/sivel/speedtest-<span class="hljs-keyword">cli</span>/master/speedtest.pychmod +<span class="hljs-built_in">x</span> speedtest-<span class="hljs-keyword">cli</span></code></pre></div><div class="hljs"><pre><code class="hljs avrasm">./speedtest-<span class="hljs-keyword">cli</span></code></pre></div><p>如果想看一下所有 speedtest.net 可用的服务器，可以使用以下命令</p><div class="hljs"><pre><code class="hljs jboss-cli"><span class="hljs-string">./speedtest-cli</span> <span class="hljs-params">--list</span></code></pre></div><p>可以通过”grep”命令进行筛选，例如查看位于北京的节点</p><div class="hljs"><pre><code class="hljs jboss-cli"><span class="hljs-string">./speedtest-cli</span> <span class="hljs-params">--list</span> | grep <span class="hljs-params">(city)</span></code></pre></div><p>知道了测试节点信息后，就可以指定节点进行测速了</p><div class="hljs"><pre><code class="hljs jboss-cli"><span class="hljs-string">./speedtest-cli</span> <span class="hljs-params">--server</span> <span class="hljs-params">(numbers)</span> <span class="hljs-params">--byte</span><span class="hljs-string">./speedtest-cli</span> <span class="hljs-params">--server</span> <span class="hljs-params">(numbers)</span> <span class="hljs-params">--byte</span> <span class="hljs-params">--no-upload</span> <span class="hljs-params">--single</span></code></pre></div><p>就是使用”–help”参数，查看 speedtest-cli 的详细参数信息，有兴趣的话可以自行测试每个参数的作用，这里就不再做过多讲解。</p><div class="hljs"><pre><code class="hljs jboss-cli"><span class="hljs-string">./speedtest-cli</span> <span class="hljs-params">--help</span></code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>安装 shadowsocks-libev + kcptun + 锐速 教程</title>
    <link href="/posts/2d5fa211.html"/>
    <url>/posts/2d5fa211.html</url>
    
    <content type="html"><![CDATA[<h2 id="安装-shadowsocks-libev-kcptun-锐速-教程"><a href="#安装-shadowsocks-libev-kcptun-锐速-教程" class="headerlink" title="安装 shadowsocks-libev + kcptun + 锐速 教程"></a>安装 shadowsocks-libev + kcptun + 锐速 教程</h2><h4 id="1，安装shadowsocks-libev，使用一键脚本来自https-www-xlovett-com-1288-html-编译安装"><a href="#1，安装shadowsocks-libev，使用一键脚本来自https-www-xlovett-com-1288-html-编译安装" class="headerlink" title="1，安装shadowsocks-libev，使用一键脚本来自https://www.xlovett.com/1288.html 编译安装"></a>1，安装shadowsocks-libev，使用一键脚本来自<a href="https://www.xlovett.com/1288.html" target="_blank" rel="noopener">https://www.xlovett.com/1288.html</a> 编译安装</h4><p>使用root用户登录，运行以下命令：<br>适用于 CentOS 系统</p><div class="hljs"><pre><code class="hljs bsh">wget --no-check-certificate -O shadowsocks-libev.sh https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;xiechangan123&#x2F;shadowsocks_install&#x2F;master&#x2F;shadowsocks-libev.shchmod +x shadowsocks-libev.sh.&#x2F;shadowsocks-libev.sh 2&gt;&amp;1 | tee shadowsocks-libev.log</code></pre></div><p>适用于Debian/Ubuntu 系统</p><div class="hljs"><pre><code class="hljs bsh">wget --no-check-certificate -O shadowsocks-libev-debian.sh https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;xiechangan123&#x2F;shadowsocks_install&#x2F;master&#x2F;shadowsocks-libev-debian.shchmod +x shadowsocks-libev-debian.sh.&#x2F;shadowsocks-libev-debian.sh 2&gt;&amp;1 | tee shadowsocks-libev-debian.log</code></pre></div><p>如果出现Makefile:677: recipe for target ‘ss-local’ failed 等错误是由于libsodium-dev和mbedtls-dev事先装过dev再源码安装。需要</p><div class="hljs"><pre><code class="hljs q">apt-<span class="hljs-built_in">get</span> purge libsodium-<span class="hljs-built_in">dev</span>apt-<span class="hljs-built_in">get</span> purge mbedtls-<span class="hljs-built_in">dev</span></code></pre></div><p>安装完成后，脚本提示如下：</p><div class="hljs"><pre><code class="hljs bsh">Congratulations, Shadowsocks-libev server install completed!Your Server IP        :your_server_ipYour Server Port      :your_server_portYour Password         :your_passwordYour Encryption Method:your_encryption_methodWelcome to visit:https:&#x2F;&#x2F;www.xlovett.com&#x2F;1288.htmlEnjoy it!</code></pre></div><p><strong>卸载方法：</strong><br>使用 root 用户登录，运行以下命令：</p><div class="hljs"><pre><code class="hljs bsh">.&#x2F;shadowsocks-libev.sh uninstall</code></pre></div><p>Debian/Ubuntu 系统卸载应该是</p><div class="hljs"><pre><code class="hljs bsh">.&#x2F;shadowsocks-libev-debian.sh uninstall</code></pre></div><p>安装完成后即已后台启动 Shadowsocks-libev ，运行：</p><div class="hljs"><pre><code class="hljs bsh">&#x2F;etc&#x2F;init.d&#x2F;shadowsocks status</code></pre></div><p>可以查看进程是否启动。<br>本脚本安装完成后，会将 Shadowsocks-libev 加入开机自启动。</p><p><strong>使用命令：</strong><br>启动：/etc/init.d/shadowsocks start<br>停止：/etc/init.d/shadowsocks stop<br>重启：/etc/init.d/shadowsocks restart<br>查看状态：/etc/init.d/shadowsocks status</p><p>脚本设置位置在<code>/etc/shadowsocks-libev/config.json</code></p><div class="hljs"><pre><code class="hljs awk"><span class="hljs-comment">#修改配置文件</span>nano <span class="hljs-regexp">/etc/</span>shadowsocks-libev<span class="hljs-regexp">/config.json</span></code></pre></div><h4 id="保护shadowsocks，防止被嗅探（适合固定ip访问）"><a href="#保护shadowsocks，防止被嗅探（适合固定ip访问）" class="headerlink" title="保护shadowsocks，防止被嗅探（适合固定ip访问）"></a>保护shadowsocks，防止被嗅探（适合固定ip访问）</h4><p>设置理由：</p><p><a href="https://gfw.report/blog/gfw_shadowsocks/zh.html" target="_blank" rel="noopener">https://gfw.report/blog/gfw_shadowsocks/zh.html</a></p><p>具体操作方法你可以使用iptables命令：</p><p>禁止所有人访问你的ss 443端口</p><div class="hljs"><pre><code class="hljs brainfuck"><span class="hljs-comment">iptables</span> --<span class="hljs-comment">append</span> <span class="hljs-comment">INPUT</span> --<span class="hljs-comment">protocol</span> <span class="hljs-comment">tcp</span> --<span class="hljs-comment">dport</span> <span class="hljs-comment">443</span> --<span class="hljs-comment">jump</span> <span class="hljs-comment">DROP</span></code></pre></div><p>这条命令的意思是仅允许1.1.1.1访问你ss 443端口</p><div class="hljs"><pre><code class="hljs dsconfig"><span class="hljs-string">iptables </span><span class="hljs-built_in">--append</span> <span class="hljs-string">INPUT </span><span class="hljs-built_in">--protocol</span> <span class="hljs-string">tcp </span><span class="hljs-built_in">--src</span> 1.1.1.1 <span class="hljs-built_in">--dport</span> <span class="hljs-string">443 </span><span class="hljs-built_in">--jump</span> <span class="hljs-string">ACCEPT</span><span class="hljs-string"></span><span class="hljs-string">#</span>或者选择<span class="hljs-string">ip段</span>，<span class="hljs-string">http:</span>//<span class="hljs-string">ip.</span><span class="hljs-string">bczs.</span><span class="hljs-string">net/</span>和<span class="hljs-string">http:</span>//<span class="hljs-string">apps.</span><span class="hljs-string">neu.</span><span class="hljs-string">edu.</span><span class="hljs-string">cn/</span><span class="hljs-string">netaggr/</span><span class="hljs-string">iptables </span><span class="hljs-built_in">--append</span> <span class="hljs-string">INPUT </span><span class="hljs-built_in">--protocol</span> <span class="hljs-string">tcp </span><span class="hljs-built_in">--src</span> 0.0.0.0/<span class="hljs-string">10 </span><span class="hljs-built_in">--dport</span> <span class="hljs-string">443 </span><span class="hljs-built_in">--jump</span> <span class="hljs-string">ACCEPT</span></code></pre></div><p>查看iptables规则<br>命令后面的line-number为显示行号（将规则一则一则输出，并显示行号），可选，方便后文的删除指令。</p><div class="hljs"><pre><code class="hljs ada">iptables -L -n <span class="hljs-comment">--line-numbers</span></code></pre></div><p>清除已有iptables规则</p><div class="hljs"><pre><code class="hljs ebnf"><span class="hljs-attribute">iptables -F</span></code></pre></div><h4 id="2，替换锐速内核，来源https-github-com-ylx2016-Linux-NetSpeed-releases"><a href="#2，替换锐速内核，来源https-github-com-ylx2016-Linux-NetSpeed-releases" class="headerlink" title="2，替换锐速内核，来源https://github.com/ylx2016/Linux-NetSpeed/releases"></a>2，替换锐速内核，来源<a href="https://github.com/ylx2016/Linux-NetSpeed/releases" target="_blank" rel="noopener">https://github.com/ylx2016/Linux-NetSpeed/releases</a></h4><div class="hljs"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#方便国内使用 避免使用raw域名</span><span class="hljs-comment">#卸载内核</span>wget -N <span class="hljs-params">--no-check-certificate</span> <span class="hljs-string">"https://raw.githubusercontent.com/ylx2016/Linux-NetSpeed/master/tcp.sh"</span> &amp;&amp; chmod +x tcp.sh &amp;&amp; <span class="hljs-string">./tcp.sh</span></code></pre></div><p>需要重启一次，再进入脚本<code>./tcp.sh</code>开启锐速，然后选择优化系统，再重启。</p><h4 id="3，安装kcptun，来源于https-www-xooof-com-194-html"><a href="#3，安装kcptun，来源于https-www-xooof-com-194-html" class="headerlink" title="3，安装kcptun，来源于https://www.xooof.com/194.html"></a>3，安装kcptun，来源于<a href="https://www.xooof.com/194.html" target="_blank" rel="noopener">https://www.xooof.com/194.html</a></h4><p>先修改时区到中国时间</p><div class="hljs"><pre><code class="hljs awk">sudo cp <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/zoneinfo/</span>Asia<span class="hljs-regexp">/Shanghai  /</span>etc<span class="hljs-regexp">/localtime</span></code></pre></div><p>添加优化代码</p><div class="hljs"><pre><code class="hljs awk">nano <span class="hljs-regexp">/etc/</span>sysctl.conf</code></pre></div><p>写入</p><div class="hljs"><pre><code class="hljs ini"><span class="hljs-attr">net.core.rmem_max</span>=<span class="hljs-number">26214400</span> // BDP - bandwidth delay product<span class="hljs-attr">net.core.rmem_default</span>=<span class="hljs-number">26214400</span><span class="hljs-attr">net.core.wmem_max</span>=<span class="hljs-number">26214400</span><span class="hljs-attr">net.core.wmem_default</span>=<span class="hljs-number">26214400</span><span class="hljs-attr">net.core.netdev_max_backlog</span>=<span class="hljs-number">2048</span> // proportional to -rcvwnd</code></pre></div><p>保存后退出，运行<code>sysctl -p</code></p><h2 id="安装命令："><a href="#安装命令：" class="headerlink" title="安装命令："></a>安装命令：</h2><div class="hljs"><pre><code class="hljs vim">wget --<span class="hljs-keyword">no</span>-check-certificate http<span class="hljs-variable">s:</span>//github.<span class="hljs-keyword">com</span>/kuoruan/<span class="hljs-keyword">shell</span>-scripts/raw/master/kcptun/kcptun.<span class="hljs-keyword">sh</span><span class="hljs-keyword">sh</span> kcptun.<span class="hljs-keyword">sh</span></code></pre></div><p>kcptun可以选择不加密，其他参数可参考<a href="https://github.com/xtaci/kcptun" target="_blank" rel="noopener">https://github.com/xtaci/kcptun</a></p><div class="hljs"><pre><code class="hljs awk"><span class="hljs-comment">#手动修改代码</span>nano <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/kcptun/</span>server-config.json</code></pre></div><p>修改设置后<code>supervisorctl restart kcptun</code>重启服务</p><p>帮助信息</p><div class="hljs"><pre><code class="hljs gherkin">命令:service supervisord &#123;start|<span class="hljs-string">stop</span>|<span class="hljs-string">restart</span>|<span class="hljs-string">status&#125;&#123;启动</span>|<span class="hljs-string">关闭</span>|<span class="hljs-string">重启</span>|<span class="hljs-string">查看状态&#125;Kcptun </span><span class="hljs-string">相关命令:supervisorctl &#123;start</span>|<span class="hljs-string">stop</span>|<span class="hljs-string">restart</span>|<span class="hljs-string">status&#125; kcptun&#123;启动</span>|<span class="hljs-string">关闭</span>|<span class="hljs-string">重启</span>|<span class="hljs-string">查看状态&#125;</span></code></pre></div><p>lean 的openwrt shadowsocks-libev的端口要设置为12948</p><h4 id="4，如果你只使用pc客户端，可以进一步使用udp2raw，udpspeeder防止运营商可能的qos，教程可参考下面链接"><a href="#4，如果你只使用pc客户端，可以进一步使用udp2raw，udpspeeder防止运营商可能的qos，教程可参考下面链接" class="headerlink" title="4，如果你只使用pc客户端，可以进一步使用udp2raw，udpspeeder防止运营商可能的qos，教程可参考下面链接"></a>4，如果你只使用pc客户端，可以进一步使用udp2raw，udpspeeder防止运营商可能的qos，教程可参考下面链接</h4><p><a href="https://www.moerats.com/archives/662/" target="_blank" rel="noopener">https://www.moerats.com/archives/662/</a></p><p><a href="https://github.com/wangyu-/udp2raw-tunnel/blob/master/doc/kcptun_step_by_step.md" target="_blank" rel="noopener">https://github.com/wangyu-/udp2raw-tunnel/blob/master/doc/kcptun_step_by_step.md</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>安装trojan ssr 一键脚本</title>
    <link href="/posts/6517cf50.html"/>
    <url>/posts/6517cf50.html</url>
    
    <content type="html"><![CDATA[<div class="hljs"><pre><code class="hljs bash">sudo bash -c <span class="hljs-string">"<span class="hljs-variable">$(curl -fsSL https://raw.githubusercontent.com/johnrosen1/trojan-gfw-script/8cfa98443522eaff9bca0434bd1336dd1ec35bb3/trojangui.sh)</span>"</span></code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>安装vnStat</title>
    <link href="/posts/374daf28.html"/>
    <url>/posts/374daf28.html</url>
    
    <content type="html"><![CDATA[<h2 id="安装vnStat"><a href="#安装vnStat" class="headerlink" title="安装vnStat"></a>安装vnStat</h2><div class="hljs"><pre><code class="hljs crystal">apt-get install vnstat <span class="hljs-comment">#apt安装</span>vnstat -u -i eth0 <span class="hljs-comment">#生成流量统计数据库 'eth0'用'ip a'命令查看</span>systemctl stop vnstat <span class="hljs-comment">#停止 vnStat 服务</span>chown <span class="hljs-symbol">vnstat:</span>vnstat /var/<span class="hljs-class"><span class="hljs-keyword">lib</span>/<span class="hljs-title">vnstat</span>/.<span class="hljs-title">eth0</span> <span class="hljs-comment">#修改 .eth0 文件的权限</span></span>systemctl start vnstat <span class="hljs-comment">#启动 vnStat 服务</span></code></pre></div><h2 id="查看流量信息"><a href="#查看流量信息" class="headerlink" title="查看流量信息"></a>查看流量信息</h2><div class="hljs"><pre><code class="hljs nginx"><span class="hljs-attribute">vnstat</span> -l <span class="hljs-comment">#实时流量</span>vnstat -d <span class="hljs-comment">#日流量</span>vnstat -m <span class="hljs-comment">#月流量</span></code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hexo+Github+Netlify部署个人博客</title>
    <link href="/posts/eea01239.html"/>
    <url>/posts/eea01239.html</url>
    
    <content type="html"><![CDATA[<h3 id="1，按照-https-juejin-im-post-5cc17ed26fb9a032374f5200-方法建立blog"><a href="#1，按照-https-juejin-im-post-5cc17ed26fb9a032374f5200-方法建立blog" class="headerlink" title="1，按照    https://juejin.im/post/5cc17ed26fb9a032374f5200    方法建立blog"></a>1，按照 <a href="https://juejin.im/post/5cc17ed26fb9a032374f5200" target="_blank" rel="noopener">https://juejin.im/post/5cc17ed26fb9a032374f5200</a> 方法建立blog</h3><h3 id="2，以后写博客在本地文件目录下（-博客目录-source-posts-）建立markdown文件，写完保存"><a href="#2，以后写博客在本地文件目录下（-博客目录-source-posts-）建立markdown文件，写完保存" class="headerlink" title="2，以后写博客在本地文件目录下（ \博客目录\source\ _posts ）建立markdown文件，写完保存"></a>2，以后写博客在本地文件目录下（ \博客目录\source\ _posts ）建立markdown文件，写完保存</h3><h3 id="3，在-博客目录-建立deploy-sh-，保存以下内容"><a href="#3，在-博客目录-建立deploy-sh-，保存以下内容" class="headerlink" title="3，在     \博客目录     建立deploy.sh ，保存以下内容"></a>3，在 \博客目录 建立deploy.sh ，保存以下内容</h3><div class="hljs"><pre><code class="hljs verilog">hexo cleanhexo <span class="hljs-keyword">generate</span>hexo deploy</code></pre></div><p>然后写完blog后，cmd 运行 <code>bash deploy.sh</code></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>修改 RSSHUB docker 网址</title>
    <link href="/posts/fcc6fb2f.html"/>
    <url>/posts/fcc6fb2f.html</url>
    
    <content type="html"><![CDATA[<h6 id="1-通过两种方式查看-container-id-的ENV中关于URL的值，"><a href="#1-通过两种方式查看-container-id-的ENV中关于URL的值，" class="headerlink" title="1.通过两种方式查看[container-id]的ENV中关于URL的值，"></a>1.通过两种方式查看[container-id]的ENV中关于URL的值，</h6><div class="hljs"><pre><code class="hljs mel">docker <span class="hljs-keyword">exec</span> -it [<span class="hljs-keyword">container</span>-id] <span class="hljs-keyword">env</span></code></pre></div><div class="hljs"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> inspect<span class="hljs-meta"> [container-id]</span></code></pre></div><p>查看[container-id]可通过</p><div class="hljs"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker ps</span></code></pre></div><h6 id="2-首先关闭docker，service-docker-stop，修改-var-lib-docker-containers-container-id-config-v2-json里对应的环境变量URL，service-docker-start。"><a href="#2-首先关闭docker，service-docker-stop，修改-var-lib-docker-containers-container-id-config-v2-json里对应的环境变量URL，service-docker-start。" class="headerlink" title="2.首先关闭docker，service docker stop，修改/var/lib/docker/containers/[container-id]/config.v2.json里对应的环境变量URL，service docker start。"></a>2.首先关闭docker，<code>service docker stop</code>，修改<code>/var/lib/docker/containers/[container-id]/config.v2.json</code>里对应的环境变量URL，<code>service docker start</code>。</h6><h6 id="3-修改nginx，certbot-certonly-standalone-d-rss-example-com注册新地址。nano-etc-nginx-conf-d-ttrss-conf，将对应以前网址全部更换，包括-etc-letsencrypt-live-后面地址。然后使用-nginx-t-查看有无错误，没有错误后使用-nginx-s-reload-重启-Nginx-服务。"><a href="#3-修改nginx，certbot-certonly-standalone-d-rss-example-com注册新地址。nano-etc-nginx-conf-d-ttrss-conf，将对应以前网址全部更换，包括-etc-letsencrypt-live-后面地址。然后使用-nginx-t-查看有无错误，没有错误后使用-nginx-s-reload-重启-Nginx-服务。" class="headerlink" title="3.修改nginx，certbot certonly --standalone -d rss.example.com注册新地址。nano  /etc/nginx/conf.d/ttrss.conf，将对应以前网址全部更换，包括/etc/letsencrypt/live/后面地址。然后使用 nginx -t 查看有无错误，没有错误后使用 nginx -s reload 重启 Nginx 服务。"></a>3.修改nginx，<code>certbot certonly --standalone -d rss.example.com</code>注册新地址。<code>nano /etc/nginx/conf.d/ttrss.conf</code>，将对应以前网址全部更换，包括<code>/etc/letsencrypt/live/</code>后面地址。然后使用 <code>nginx -t</code> 查看有无错误，没有错误后使用 <code>nginx -s reload</code> 重启 Nginx 服务。</h6><h6 id="4-查看-Docker-内所有容器的-IP，更换ttrss内插件IP地址"><a href="#4-查看-Docker-内所有容器的-IP，更换ttrss内插件IP地址" class="headerlink" title="4.查看 Docker 内所有容器的 IP，更换ttrss内插件IP地址"></a>4.查看 Docker 内所有容器的 IP，更换ttrss内插件IP地址</h6><div class="hljs"><pre><code class="hljs reasonml">docker inspect --format='&#123;&#123;.Name&#125;&#125; - &#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;<span class="hljs-keyword">end</span>&#125;&#125;' <span class="hljs-constructor">$(<span class="hljs-params">docker</span> <span class="hljs-params">ps</span> -<span class="hljs-params">aq</span>)</span></code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>非docker下安装rsshub</title>
    <link href="/posts/c15df01.html"/>
    <url>/posts/c15df01.html</url>
    
    <content type="html"><![CDATA[<h4 id="先安装rsshub"><a href="#先安装rsshub" class="headerlink" title="先安装rsshub"></a>先安装rsshub</h4><ol><li><p>安装 git</p><div class="hljs"><pre><code class="hljs bash">apt-get update &amp;&amp; apt-get install git</code></pre></div><p>2.安装npm</p><p>添加最新npm最新源</p></li></ol><div class="hljs"><pre><code class="hljs vim">sudo apt-<span class="hljs-built_in">get</span> install curlcurl -sL http<span class="hljs-variable">s:</span>//<span class="hljs-keyword">deb</span>.nodesource.<span class="hljs-keyword">com</span>/setup_13.<span class="hljs-keyword">x</span> | sudo -E bash -</code></pre></div><p>​ 安装nodejs</p><div class="hljs"><pre><code class="hljs routeros">sudo apt-<span class="hljs-builtin-name">get</span> install nodejs</code></pre></div><p>3.下载 <code>RSSHub</code> 的源码</p><div class="hljs"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/DIYgod/RSSHub.git<span class="hljs-built_in">cd</span> RSSHub</code></pre></div><p>下载完成后，需要安装依赖</p><p>使用 <code>npm</code></p><div class="hljs"><pre><code class="hljs bash">npm installscreen -S rss <span class="hljs-comment">#新建控制台，执行完后按ctrl+a+d</span></code></pre></div><p>由于众所周知的原因，在中国使用 <code>npm</code> 下载依赖十分缓慢，建议挂一个代理或者考虑使用 <a href="https://npm.taobao.org/" target="_blank" rel="noopener">NPM 镜像</a></p><p>然后在 <code>RSSHub</code> 文件夹中运行下面的命令就可以启动</p><div class="hljs"><pre><code class="hljs bash">npm start</code></pre></div><p>详细使用说明参照 <a href="https://docs.rsshub.app/" target="_blank" rel="noopener">指南</a>，替换所有路由例子中的 <code>https://rsshub.app/</code> 为 <code>http://localhost:1200</code> 即可正常使用</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
